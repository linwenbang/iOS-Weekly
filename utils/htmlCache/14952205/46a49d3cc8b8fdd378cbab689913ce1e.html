<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Detailing the iOS Menu &#8211; Codea &amp; Shade</title>
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Codea &amp; Shade &raquo; Feed" href="https://codea.io/blog/feed/" />
<link rel="alternate" type="application/rss+xml" title="Codea &amp; Shade &raquo; Comments Feed" href="https://codea.io/blog/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Codea &amp; Shade &raquo; Detailing the iOS Menu Comments Feed" href="https://codea.io/blog/detailing-the-ios-menu/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/codea.io\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='https://codea.io/blog/wp-includes/css/dist/block-library/style.min.css?ver=5.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='slightly-flexboxgrid-css'  href='https://codea.io/blog/wp-content/themes/slightly/css/flexboxgrid.min.css?ver=5.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='slightly-style-css'  href='https://codea.io/blog/wp-content/themes/slightly/style.css?ver=5.1.1' type='text/css' media='all' />
<link rel='https://api.w.org/' href='https://codea.io/blog/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://codea.io/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://codea.io/blog/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='The iOS Menu' href='https://codea.io/blog/the-ios-menu/' />
<link rel='next' title='What&#8217;s Next for iPad Creativity' href='https://codea.io/blog/whats-next-for-ipad-creativity/' />
<meta name="generator" content="WordPress 5.1.1" />
<link rel="canonical" href="https://codea.io/blog/detailing-the-ios-menu/" />
<link rel='shortlink' href='https://codea.io/blog/?p=102' />
<link rel="alternate" type="application/json+oembed" href="https://codea.io/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcodea.io%2Fblog%2Fdetailing-the-ios-menu%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://codea.io/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcodea.io%2Fblog%2Fdetailing-the-ios-menu%2F&#038;format=xml" />
<link rel="pingback" href="https://codea.io/blog/xmlrpc.php">    <style>
        body, button, input, select, textarea, a { 
            color: #00363f;
        }
    </style>

    		<style type="text/css" id="wp-custom-css">
			.site-header {
	background-color: #f8fffb;
}

.site-title a {
	font-size: 1.8em;
}

.entry-footer .cat-links { display: none; }		</style>
		</head>

<body class="post-template-default single single-post postid-102 single-format-standard">

<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>


	<header id="masthead" class="site-header" role="banner">
  <div class="row">
    <div class="col-xs-12 site-header-col">
		<div class="site-branding">
			                    <p class="site-title"><a href="https://codea.io/blog/" rel="home">Codea &amp; Shade</a></p>
                		</div><!-- .site-branding -->
		<nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">Menu</button>
			<div id="primary-menu" class="menu"></div>
		</nav><!-- #site-navigation -->
      </div>
    </div>
	</header><!-- #masthead -->


	<div id="content" class="site-content">

  <div class="row row--index">
    <div class="col-xs-12">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
<article id="post-102" class="post-102 post type-post status-publish format-standard hentry category-dev category-ui">
    <div class="row no-pad">
      
                    <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad">
                <header class="entry-header">
                    <h1 class="entry-title">Detailing the iOS Menu</h1>                    <div class="entry-meta">
                        BY simeon | <span class="posted-on"><time class="entry-date published" datetime="2019-01-04T13:51:03+00:00">January 4, 2019</time><time class="updated" datetime="2019-01-05T03:24:57+00:00">January 5, 2019</time> </span>                    </div><!-- .entry-meta -->
                                    </header><!-- .entry-header -->
                <div class="entry-content">

                    
                    
<p>This continues my <a href="https://codea.io/blog/the-ios-menu">previous post</a> on building a Mac style menu for iOS.</p>



<p>In this post I&#8217;m going to walk you through all the other details that make this work.</p>



<h2>Navigating with Touch</h2>



<p>I&#8217;ve talked about how to make the menu look good, let&#8217;s talk about making it <em>feel good</em>.</p>



<p>I started by looking at how you interacted with the Mac menu. </p>



<ul><li>Click it to bring up a menu, then hover over the selections with your cursor</li><li>Click-and-drag on the menu title to open and select an item when you release your click</li></ul>



<p>I decided that the way to translate these to touch was to support two analogous methods of interaction.</p>



<ul><li>Tap the menu to open it, then tap to select an item</li><li>Drag on the menu to open it and select an item in a single gesture</li></ul>



<video width="100%" controls="controls" preload="none" poster="https://codea.io/media/menus/tap-drag-select.jpg">
    <source src="https://codea.io/media/menus/tap-drag-select.mp4" type="video/mp4">
</video>



<p></p>



<p>However, I wanted the first style of interaction to be convertible to the second. </p>



<p>What does that mean? Well, if you had tapped a menu to show its contents, I wanted you to be able to touch and slide your finger over it to select an item as if you had opened it with a single gesture.</p>



<video width="100%" controls="controls" preload="none" poster="https://codea.io/media/menus/tap-to-drag.jpg">
    <source src="https://codea.io/media/menus/tap-to-drag.mp4" type="video/mp4">
</video>



<p></p>



<p>The other interaction I really needed for this menu was something I first noticed in <a href="https://procreate.art">Procreate</a>, an iPad app for painting. It uses popover menus to allow the user to change tools and colours. Standard iOS popovers require the user to tap outside the popover to dismiss it before she can interact with the background. In Procreate, you can just start drawing and the popover dismisses.</p>



<p>This behaviour gives the menus their lightweight feel. They don&#8217;t stutter your interactions with the rest of the system. The clip below shows what happens when you scroll the editor with an open menu.<br></p>



<video width="100%" controls="controls" preload="none" poster="https://codea.io/media/menus/scroll-dismiss.jpg">
    <source src="https://codea.io/media/menus/scroll-dismiss.mp4" type="video/mp4">
</video>



<p></p>



<p>Menu dismissal follows from macOS. If you tap or drag outside a menu after opening it, it closes. One difference is that a tap outside the menu is sent through to the underlying view, where on macOS a click outside the menu will dismiss the menu but not be sent to the underlying window.</p>



<h2>Visual Selection</h2>



<p>I was excited when it came time to implement the selection animation. All the great iOS animation APIs were available to me. Maybe something with circular masking like Google&#8217;s material style button presses? Or maybe something involving a spring&#8230;</p>



<p>No. None of those were good ideas. The macOS menu animation has remained a flash for so long because you need <em>something</em>, and a flash is all you need.</p>



<p>If the menu disappears without a selection animation it feels like you haven&#8217;t done anything. With too complex an animation it feels like you&#8217;re getting interrupted.<br></p>



<p>So I set about replicating the flash. Starting by screen capturing macOS and stepping through the frames.</p>



<video autoplay="" muted="" playsinline="" loop="" width="100%" preload="auto">
    <source src="https://codea.io/media/menus/slow-select.mp4" type="video/mp4">
</video>



<p></p>



<p>Yeah, it&#8217;s literally just a flash.</p>



<p>I&#8217;m not convinced about the way I got the effect I wanted. It works, and it&#8217;s reasonably clean. I feel like there&#8217;s code smell when I use <code>DispatchQueue.main.asyncAfter</code> to delay some UI activity. But it seemed like the minimum functional thing in this case.</p>



<pre class="wp-block-code"><code>func startSelectionAnimation(completion: @escaping ()->()) {
    updateHighlightState(false)
        
    DispatchQueue.main.asyncAfter(deadline: .now() + 0.1) {
        self.updateHighlightState(true)
            
        completion()
    }
}</code></pre>



<h2>Small Screens, Big Menus</h2>



<p>The edge case I dreaded implementing was using these menus on iPhone in landscape mode, with a keyboard on screen. There&#8217;s like two pixels of usable vertical space on an iPhone in landscape mode. (Seriously, try scrolling through your iMessages in landscape with the keyboard open.)</p>



<p>The other use case was when you have so many menu items you can&#8217;t fit them on the screen. Such as using the menu to navigate your project in Codea.</p>



<p>Making the menus scrollable was what I needed. So I added the ability to specify a maximum height. Content exceeding the height led to a scroll view implementation.</p>



<p>This still had to work with both the tap and drag styles of interaction.</p>



<p>For tap it was easy. Open the menu then drag to slide the scroll view. It did introduce a slight delay on tapping menu items in order to distinguish whether the user intended a tap or a drag. I also wanted to be able to convert to the drag style interaction within a scroll view. So tapping for slightly longer, then dragging, will drag-select through the menu contents.</p>



<p>When dragging the menu I needed the entire interaction to take place in a single gesture. You open the menu, drag to the item (even if it&#8217;s initially off-view) and release. For this, I needed to check if the drag position was sitting at the bottom or top edge and use a timer to adjust the scroll position in the direction the user was intending so that they could reach their menu item.<br></p>



<video width="100%" controls="controls" preload="none" poster="https://codea.io/media/menus/scroll-dismiss.jpg">
    <source src="https://codea.io/media/menus/long-menus.mp4" type="video/mp4">
</video>



<p></p>



<h2>The Cut-off</h2>



<p>Of course, when you introduce scrolling into menus you have to deal with what happens <em>at&nbsp;the&nbsp;edge</em> of your scroll view. You could simply cut it off.<br></p>



<figure class="wp-block-image"><img src="https://codea.io/blog/wp-content/uploads/2019/01/IMG_FA9273D110B8-1-1024x373.jpeg" alt="" class="wp-image-116" srcset="https://codea.io/blog/wp-content/uploads/2019/01/IMG_FA9273D110B8-1-1024x373.jpeg 1024w, https://codea.io/blog/wp-content/uploads/2019/01/IMG_FA9273D110B8-1-300x109.jpeg 300w, https://codea.io/blog/wp-content/uploads/2019/01/IMG_FA9273D110B8-1-768x280.jpeg 768w, https://codea.io/blog/wp-content/uploads/2019/01/IMG_FA9273D110B8-1.jpeg 1125w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>Large titles in iOS nav bars do this and it still makes me wince every time I see it.</figcaption></figure>



<p>I wanted something more graceful.</p>



<p>I ended up using a <code>CAGradientLayer</code> as a layer mask at the top of the scroll view to ensure that the content faded instead of cutting off.</p>



<figure class="wp-block-image"><img src="https://codea.io/blog/wp-content/uploads/2019/01/IMG_776ED5845A1F-1-1024x999.jpeg" alt="" class="wp-image-117" srcset="https://codea.io/blog/wp-content/uploads/2019/01/IMG_776ED5845A1F-1-1024x999.jpeg 1024w, https://codea.io/blog/wp-content/uploads/2019/01/IMG_776ED5845A1F-1-300x293.jpeg 300w, https://codea.io/blog/wp-content/uploads/2019/01/IMG_776ED5845A1F-1-768x750.jpeg 768w, https://codea.io/blog/wp-content/uploads/2019/01/IMG_776ED5845A1F-1.jpeg 1125w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>The menu scrolls into nothingness</figcaption></figure>



<h2>Readability</h2>



<p>Codea seamlessly switches between using a menu for the tab bar in compact mode, or a real tab bar in regular mode.</p>



<video loop="" width="100%" controls="controls" preload="none" poster="https://codea.io/media/menus/compact-mode-codea.jpg">
    <source src="https://codea.io/media/menus/compact-mode-codea.mp4" type="video/mp4">
</video>



<p></p>



<p>When using the full-size tab bar with the light colour theme, I found the translucency on the menu was making text hard to read. Because selected tabs were pure white, and unselected tabs were quite dark. But the text on menu items was fixed.</p>



<p>I tried <code>UIVibrancyEffect</code> on the text and icons. That just made everything less readable.</p>



<p>What I ended up doing was choosing a light or dark tint for the menu title text and buttons based on the area of overlap with the underlying view, and the darkness of that view.</p>



<p>Basically, I computed the area of intersection between the menu item’s view and the underlying view. If the underlying view was dark I used the light tint colour, and if it was light I used the dark tint colour.</p>



<video loop="" width="100%" controls="controls" preload="none" poster="https://codea.io/media/menus/dynamic-tint.jpg">
    <source src="https://codea.io/media/menus/dynamic-tint.mp4" type="video/mp4">
</video>



<p></p>



<p>No one notices this, but I keep playing with it. It makes me happy.</p>



<h2>Shortcut Layout</h2>



<p>When I first implemented shortcut key rendering on menu items it looked off. And on checking macOS, I saw why. </p>



<p>macOS uses a column layout for shortcut keys. So all your ⌘ symbols line up. All your letters line up. It looks great.</p>



<figure class="wp-block-image"><img src="https://codea.io/blog/wp-content/uploads/2019/01/clipboard-2.png" alt="" class="wp-image-103" srcset="https://codea.io/blog/wp-content/uploads/2019/01/clipboard-2.png 862w, https://codea.io/blog/wp-content/uploads/2019/01/clipboard-2-300x130.png 300w, https://codea.io/blog/wp-content/uploads/2019/01/clipboard-2-768x333.png 768w" sizes="(max-width: 862px) 100vw, 862px" /><figcaption>Nicely aligned shortcut keys on macOS</figcaption></figure>



<p>What I needed for my shortcut menu items was a horizontal layout containing the modifiers and keys in equal(ish)-width boxes. But not all shortcuts are equal-width — we have one in Shade, &#8220;Space&#8221; to create a node. </p>



<p>I used a <code>UIStackView</code> on the right edge of shortcut menu items to render the key combinations. This works pretty well.</p>



<figure class="wp-block-image"><img src="https://codea.io/blog/wp-content/uploads/2019/01/clipboard-3.png" alt="" class="wp-image-123" srcset="https://codea.io/blog/wp-content/uploads/2019/01/clipboard-3.png 724w, https://codea.io/blog/wp-content/uploads/2019/01/clipboard-3-300x205.png 300w" sizes="(max-width: 724px) 100vw, 724px" /><figcaption>Lining up all the symbols</figcaption></figure>



<h2>Advanced Interactions</h2>



<p>There&#8217;s a few cool features that round-out the menu system, especially when used to navigate code files.</p>



<p>You can trigger standard iOS gestures on menu items in the tab list for renaming and deletion. These are hidden and will likely also be made available in the &#8220;Edit&#8221; menu, but it&#8217;s good to have them as a gestural shortcut.</p>



<video loop="" width="100%" controls="controls" preload="none" poster="https://codea.io/media/menus/swipes.jpg">
    <source src="https://codea.io/media/menus/swipes.mp4" type="video/mp4">
</video>



<p><br></p>



<p>You can also re-order your tabs using drag-and-drop directly in the menu. The awesome thing about iOS drag-and-drop is that it <em>automatically&nbsp;scrolls</em> underlying <code>UIScrollView</code>s when you drag something to the edge of a scroll view. So I didn&#8217;t need to re-implement the edge based scrolling logic, iOS gave it to me for free.</p>



<p>This also means you can drag your code out to another app as a plain text <code>.lua</code> file. And if you want to be tricky, you can also drag plain text straight into the menu to insert it as a tab in Codea. Because why not, right? We&#8217;ve come this far.</p>



<video width="100%" controls="controls" preload="none" poster="https://codea.io/media/menus/drag-and-drop.jpg">
    <source src="https://codea.io/media/menus/drag-and-drop.mp4" type="video/mp4">
</video>



<p></p>



<p>Thanks for reading. Let me know what you think <a href="https://twitter.com/twolivesleft">on twitter</a>.</p>



<h2>The Code</h2>



<p>Oh, and I&#8217;ve put the code <a href="https://github.com/TwoLivesLeft/Menu">on Github</a></p>


<script>(function() {
	if (!window.mc4wp) {
		window.mc4wp = {
			listeners: [],
			forms    : {
				on: function (event, callback) {
					window.mc4wp.listeners.push({
						event   : event,
						callback: callback
					});
				}
			}
		}
	}
})();
</script><!-- MailChimp for WordPress v4.3.3 - https://wordpress.org/plugins/mailchimp-for-wp/ --><form id="mc4wp-form-1" class="mc4wp-form mc4wp-form-142" method="post" data-id="142" data-name="Two Lives Left Updates" ><div class="mc4wp-form-fields"><p>
	<label>Get new posts in your inbox</label>
	<input type="email" name="EMAIL" placeholder="Your email address" required />
  	<p><em>You'll get new posts delivered to your inbox and the occasional update</em></p>
</p>

<p>
	<input type="submit" value="Add me" />
</p></div><label style="display: none !important;">Leave this field empty if you're human: <input type="text" name="_mc4wp_honeypot" value="" tabindex="-1" autocomplete="off" /></label><input type="hidden" name="_mc4wp_timestamp" value="1554227117" /><input type="hidden" name="_mc4wp_form_id" value="142" /><input type="hidden" name="_mc4wp_form_element_id" value="mc4wp-form-1" /><div class="mc4wp-response"></div></form><!-- / MailChimp for WordPress Plugin -->
                </div><!-- .entry-content -->
                <footer class="entry-footer">
                    <span class="cat-links">Posted in <a href="https://codea.io/blog/category/dev/" rel="category tag">dev</a>, <a href="https://codea.io/blog/category/ui/" rel="category tag">ui</a></span>                </footer><!-- .entry-footer -->
            </div>
                
        
    </div><!-- end .row-->
</article><!-- #post-## -->

		</main><!-- #main -->
	</div><!-- #primary -->
    </div>

    </div>


	</div><!-- #content -->

</div><!-- #page -->

<script>(function() {function addEventListener(element,event,handler) {
	if(element.addEventListener) {
		element.addEventListener(event,handler, false);
	} else if(element.attachEvent){
		element.attachEvent('on'+event,handler);
	}
}function maybePrefixUrlField() {
	if(this.value.trim() !== '' && this.value.indexOf('http') !== 0) {
		this.value = "http://" + this.value;
	}
}

var urlFields = document.querySelectorAll('.mc4wp-form input[type="url"]');
if( urlFields && urlFields.length > 0 ) {
	for( var j=0; j < urlFields.length; j++ ) {
		addEventListener(urlFields[j],'blur',maybePrefixUrlField);
	}
}/* test if browser supports date fields */
var testInput = document.createElement('input');
testInput.setAttribute('type', 'date');
if( testInput.type !== 'date') {

	/* add placeholder & pattern to all date fields */
	var dateFields = document.querySelectorAll('.mc4wp-form input[type="date"]');
	for(var i=0; i<dateFields.length; i++) {
		if(!dateFields[i].placeholder) {
			dateFields[i].placeholder = 'YYYY-MM-DD';
		}
		if(!dateFields[i].pattern) {
			dateFields[i].pattern = '[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])';
		}
	}
}

})();</script><script type='text/javascript' src='https://codea.io/blog/wp-content/themes/slightly/js/navigation.js?ver=20151215'></script>
<script type='text/javascript' src='https://codea.io/blog/wp-content/themes/slightly/js/skip-link-focus-fix.js?ver=20151215'></script>
<script type='text/javascript' src='https://codea.io/blog/wp-includes/js/wp-embed.min.js?ver=5.1.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var mc4wp_forms_config = [];
/* ]]> */
</script>
<script type='text/javascript' src='https://codea.io/blog/wp-content/plugins/mailchimp-for-wp/assets/js/forms-api.min.js?ver=4.3.3'></script>
<!--[if lte IE 9]>
<script type='text/javascript' src='https://codea.io/blog/wp-content/plugins/mailchimp-for-wp/assets/js/third-party/placeholders.min.js?ver=4.3.3'></script>
<![endif]-->

</body>
</html>
