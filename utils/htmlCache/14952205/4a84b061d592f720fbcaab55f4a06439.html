<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The iOS Menu &#8211; Codea &amp; Shade</title>
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Codea &amp; Shade &raquo; Feed" href="https://codea.io/blog/feed/" />
<link rel="alternate" type="application/rss+xml" title="Codea &amp; Shade &raquo; Comments Feed" href="https://codea.io/blog/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Codea &amp; Shade &raquo; The iOS Menu Comments Feed" href="https://codea.io/blog/the-ios-menu/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/codea.io\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='https://codea.io/blog/wp-includes/css/dist/block-library/style.min.css?ver=5.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='slightly-flexboxgrid-css'  href='https://codea.io/blog/wp-content/themes/slightly/css/flexboxgrid.min.css?ver=5.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='slightly-style-css'  href='https://codea.io/blog/wp-content/themes/slightly/style.css?ver=5.1.1' type='text/css' media='all' />
<link rel='https://api.w.org/' href='https://codea.io/blog/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://codea.io/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://codea.io/blog/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Codea 2.0 Released' href='https://codea.io/blog/codea-2-0-released/' />
<link rel='next' title='Detailing the iOS Menu' href='https://codea.io/blog/detailing-the-ios-menu/' />
<meta name="generator" content="WordPress 5.1.1" />
<link rel="canonical" href="https://codea.io/blog/the-ios-menu/" />
<link rel='shortlink' href='https://codea.io/blog/?p=61' />
<link rel="alternate" type="application/json+oembed" href="https://codea.io/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcodea.io%2Fblog%2Fthe-ios-menu%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://codea.io/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcodea.io%2Fblog%2Fthe-ios-menu%2F&#038;format=xml" />
<link rel="pingback" href="https://codea.io/blog/xmlrpc.php">    <style>
        body, button, input, select, textarea, a { 
            color: #00363f;
        }
    </style>

    		<style type="text/css" id="wp-custom-css">
			.site-header {
	background-color: #f8fffb;
}

.site-title a {
	font-size: 1.8em;
}

.entry-footer .cat-links { display: none; }		</style>
		</head>

<body class="post-template-default single single-post postid-61 single-format-standard">

<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>


	<header id="masthead" class="site-header" role="banner">
  <div class="row">
    <div class="col-xs-12 site-header-col">
		<div class="site-branding">
			                    <p class="site-title"><a href="https://codea.io/blog/" rel="home">Codea &amp; Shade</a></p>
                		</div><!-- .site-branding -->
		<nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">Menu</button>
			<div id="primary-menu" class="menu"></div>
		</nav><!-- #site-navigation -->
      </div>
    </div>
	</header><!-- #masthead -->


	<div id="content" class="site-content">

  <div class="row row--index">
    <div class="col-xs-12">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
<article id="post-61" class="post-61 post type-post status-publish format-standard hentry category-dev category-ui">
    <div class="row no-pad">
      
                    <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad">
                <header class="entry-header">
                    <h1 class="entry-title">The iOS Menu</h1>                    <div class="entry-meta">
                        BY simeon | <span class="posted-on"><time class="entry-date published" datetime="2019-01-03T12:48:17+00:00">January 3, 2019</time><time class="updated" datetime="2019-01-05T10:55:14+00:00">January 5, 2019</time> </span>                    </div><!-- .entry-meta -->
                                    </header><!-- .entry-header -->
                <div class="entry-content">

                    
                    
<p><a href="https://codea.io">Codea</a> is our iPad app for creative coding. I&#8217;ve been developing a universal version for some time.</p>



<p>It&#8217;s hard to take a complicated, eight-year-old iPad coding environment and bring it to iPhone. There&#8217;s so many damn features that need to work in so many damn configurations.</p>



<p>Autolayout takes care of many of these issues (thanks, <a href="https://snapkit.io">SnapKit</a>). But it doesn&#8217;t take care of the most important: <em>design</em>. I&#8217;ve been stuck on the design for a universal version of Codea&#8217;s code editor for over a year. It might even be two.</p>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://codea.io/blog/wp-content/uploads/2019/01/universal-mockups-1024x670.png" alt="" class="wp-image-62" srcset="https://codea.io/blog/wp-content/uploads/2019/01/universal-mockups-1024x670.png 1024w, https://codea.io/blog/wp-content/uploads/2019/01/universal-mockups-300x196.png 300w, https://codea.io/blog/wp-content/uploads/2019/01/universal-mockups-768x503.png 768w, https://codea.io/blog/wp-content/uploads/2019/01/universal-mockups.png 1415w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>One of many Sketch files with iterations of how the code editor should scale</figcaption></figure></div>



<p>I realised six months ago as I was using my Mac, using the menus, that I <em>need</em> these things — menus — in Codea. I was trying to solve a problem that has been solved for decades.</p>



<p>So I set out to make the best menus I could make for iOS.</p>



<figure class="wp-block-image alignwide"><img src="https://codea.io/blog/wp-content/uploads/2019/01/Image-2-1024x654.png" alt="" class="wp-image-64" srcset="https://codea.io/blog/wp-content/uploads/2019/01/Image-2-1024x654.png 1024w, https://codea.io/blog/wp-content/uploads/2019/01/Image-2-300x192.png 300w, https://codea.io/blog/wp-content/uploads/2019/01/Image-2-768x491.png 768w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>The code editor on iPhone</figcaption></figure>



<p>For simple apps, menus aren&#8217;t necessary, and that&#8217;s great.</p>



<p>But Codea isn&#8217;t a simple app and there&#8217;s nothing I can do about that. </p>



<p>What it can be is <em>discoverable</em>. Compared to all the options I considered, menus are exactly that, <em>discoverable</em>. You pull down a list of <em>named&nbsp;features</em> complete with shortcut keys (if a keyboard is attached). Then you activate that feature by tapping on it, or by dragging your finger and releasing.</p>



<p>Hamburger menus, side-drawers, whatever you want to call them, are a conventional way to bury additional and often unrelated functionality into an app. But they are much heavier than the good old-fashioned menu bar. They often pull out a whole modal side-thingy, maybe they slide all your content to the right. It&#8217;s a context switch for your brain.</p>



<p>Menus categorise items under common, plain-text headings, and they appear and disappear without fanfare. </p>



<p>I wanted menus that looked beautiful, looked like iOS, and felt great. </p>



<h2>Building the iOS Menu, Visually</h2>



<p>This part gets technical.</p>



<p>I knew what I wanted from the beginning: a rounded, translucent menu with a drop shadow. It had to have those things.</p>



<p>Translucency on iOS is easy. You use <code>UIVisualEffectView</code> with a light or dark blur effect and whatever is behind your view gets nice and blurry.</p>



<p>Rounding the menu was harder. You can use a layer&#8217;s <code>cornerRadius</code> property to round the corners, but I wanted the rounded part of the menu to pop out from the menu button itself. Like this.</p>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://codea.io/blog/wp-content/uploads/2019/01/clipboard.png" alt="" class="wp-image-66" srcset="https://codea.io/blog/wp-content/uploads/2019/01/clipboard.png 476w, https://codea.io/blog/wp-content/uploads/2019/01/clipboard-271x300.png 271w" sizes="(max-width: 476px) 100vw, 476px" /><figcaption>The bezier path used a clipping mask on the menu content<br>(<em>Note: I just QuickLooked the UIBezierPath in the Xcode debugger for this image. Seriously, how cool is QuickLook?</em>)</figcaption></figure></div>



<p>So that&#8217;s not too hard, you can generate your own <code>UIBezierPath</code>, create a <code>CAShapeLayer</code> with it then assign that as the <code>layer.mask</code> on the <code>UIVisualEffectView</code>. That will get us the rounding.</p>



<p>But what if your view casts a drop shadow?</p>



<p>Yeah, you get a nice blurred shadow. Gross.</p>



<figure class="wp-block-image"><img src="https://codea.io/blog/wp-content/uploads/2019/01/menu-unclipped.png" alt="" class="wp-image-69" srcset="https://codea.io/blog/wp-content/uploads/2019/01/menu-unclipped.png 990w, https://codea.io/blog/wp-content/uploads/2019/01/menu-unclipped-300x195.png 300w, https://codea.io/blog/wp-content/uploads/2019/01/menu-unclipped-768x500.png 768w" sizes="(max-width: 990px) 100vw, 990px" /><figcaption>Left: what happens when we put a shadow under a visual effect view<br>Right: the appearance we want </figcaption></figure>



<p>I was <em>sure</em> I had seen this problem solved before. By Apple in one of their apps. I remembered that the iOS Maps app has a cool draggable panel which uses a visual effect view and a drop shadow.<br></p>



<figure class="wp-block-image"><img src="https://codea.io/blog/wp-content/uploads/2019/01/IMG_EA6104B20720-1.jpeg" alt="" class="wp-image-68" srcset="https://codea.io/blog/wp-content/uploads/2019/01/IMG_EA6104B20720-1.jpeg 927w, https://codea.io/blog/wp-content/uploads/2019/01/IMG_EA6104B20720-1-300x142.jpeg 300w, https://codea.io/blog/wp-content/uploads/2019/01/IMG_EA6104B20720-1-768x363.jpeg 768w" sizes="(max-width: 927px) 100vw, 927px" /><figcaption>We want shadows like this</figcaption></figure>



<p>Surely if Apple solved this, we can just do what they did?</p>



<p><a href="https://briancoyner.github.io/xcode/2017/05/14/xcode-attach-debugger-to-apple-apps.html">Brian Coyner looked&nbsp;into</a> Apple&#8217;s implementation in Maps and found&#8230; a 9-patch image. </p>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://codea.io/blog/wp-content/uploads/2019/01/ShadowImage.png" alt="" class="wp-image-67" srcset="https://codea.io/blog/wp-content/uploads/2019/01/ShadowImage.png 224w, https://codea.io/blog/wp-content/uploads/2019/01/ShadowImage-150x150.png 150w" sizes="(max-width: 224px) 100vw, 224px" /><figcaption>Apple Maps 9-patch shadow, <a href="https://briancoyner.github.io/2017/05/15/uivisualeffectview-with-drop-shadow.html">source</a></figcaption></figure></div>



<p>A baked shadow image for the edges with a transparent middle. There&#8217;s a great piece on <a href="https://briancoyner.github.io/2017/05/15/uivisualeffectview-with-drop-shadow.html">how to create this effect</a>. But this wasn&#8217;t going to work for my menu. </p>



<p>My menus have more complex rounded shapes, and the relative sizes of those shapes changes based on text length. And if I wanted to vary things like the corner radius, shadow radius, or shadow offset I didn&#8217;t want to have to re-export static images.</p>



<p>So what do we do? We create an inverted shadow mask image and apply it as a layer mask to the rasterised drop shadow image.</p>



<p>Basically, we create a solid image that has a transparent region in the middle in the shape of the menu bezier path.</p>



<p>This turned out to be really easy to do, though it took a bit of experimenting. Here&#8217;s the key:</p>



<pre class="wp-block-code"><code>
let imageRenderer = UIGraphicsImageRenderer(size: shadowView.bounds.size)
        
let shadowMask = imageRenderer.image {
    context in
            
    UIColor.white.setFill()
    context.fill(shadowView.bounds)
    path.fill(with: .clear, alpha: 1.0)
}</code></pre>



<p>We create a shadow mask image by filling an image with white, then filling our bezier path (see above) with a clear colour. This gives us an image that looks like this.</p>



<div class="wp-block-image"><figure class="aligncenter"><img src="https://codea.io/blog/wp-content/uploads/2019/01/clipboard-1.png" alt="" class="wp-image-71" srcset="https://codea.io/blog/wp-content/uploads/2019/01/clipboard-1.png 437w, https://codea.io/blog/wp-content/uploads/2019/01/clipboard-1-236x300.png 236w" sizes="(max-width: 437px) 100vw, 437px" /><figcaption>Shadow mask. I kept the QuickLook chrome so you can see the transparent cut-out region in the middle</figcaption></figure></div>



<p>Then we apply that as a layer mask to the rasterised drop shadow, and we&#8217;ve done it: Menus with arbitrary shapes, drop shadows, and blurred backgrounds.</p>



<video muted="" loop="" width="100%" controls="controls" preload="none" poster="https://codea.io/media/dropdown.jpg">
    <source src="https://codea.io/media/dropdown.mp4" type="video/mp4">
</video>



<p></p>



<p>The video above is from our new app, Shade. Which is in <a href="https://twitter.com/twolivesleft/status/1075192271425826816">public beta</a> right now. Codea 3.0 and Shade 1.0 will both make use of these menus to some extent.</p>



<p>There are a ton of details not covered here. Let me know <a href="https://twitter.com/twolivesleft">on twitter</a> if you want to see a follow up about them. </p>



<p>You can now find part two here, in <a href="https://codea.io/blog/detailing-the-ios-menu/">Detailing the iOS Menu</a></p>


<script>(function() {
	if (!window.mc4wp) {
		window.mc4wp = {
			listeners: [],
			forms    : {
				on: function (event, callback) {
					window.mc4wp.listeners.push({
						event   : event,
						callback: callback
					});
				}
			}
		}
	}
})();
</script><!-- MailChimp for WordPress v4.3.3 - https://wordpress.org/plugins/mailchimp-for-wp/ --><form id="mc4wp-form-1" class="mc4wp-form mc4wp-form-142" method="post" data-id="142" data-name="Two Lives Left Updates" ><div class="mc4wp-form-fields"><p>
	<label>Get new posts in your inbox</label>
	<input type="email" name="EMAIL" placeholder="Your email address" required />
  	<p><em>You'll get new posts delivered to your inbox and the occasional update</em></p>
</p>

<p>
	<input type="submit" value="Add me" />
</p></div><label style="display: none !important;">Leave this field empty if you're human: <input type="text" name="_mc4wp_honeypot" value="" tabindex="-1" autocomplete="off" /></label><input type="hidden" name="_mc4wp_timestamp" value="1554227117" /><input type="hidden" name="_mc4wp_form_id" value="142" /><input type="hidden" name="_mc4wp_form_element_id" value="mc4wp-form-1" /><div class="mc4wp-response"></div></form><!-- / MailChimp for WordPress Plugin -->
                </div><!-- .entry-content -->
                <footer class="entry-footer">
                    <span class="cat-links">Posted in <a href="https://codea.io/blog/category/dev/" rel="category tag">dev</a>, <a href="https://codea.io/blog/category/ui/" rel="category tag">ui</a></span>                </footer><!-- .entry-footer -->
            </div>
                
        
    </div><!-- end .row-->
</article><!-- #post-## -->

		</main><!-- #main -->
	</div><!-- #primary -->
    </div>

    </div>


	</div><!-- #content -->

</div><!-- #page -->

<script>(function() {function addEventListener(element,event,handler) {
	if(element.addEventListener) {
		element.addEventListener(event,handler, false);
	} else if(element.attachEvent){
		element.attachEvent('on'+event,handler);
	}
}function maybePrefixUrlField() {
	if(this.value.trim() !== '' && this.value.indexOf('http') !== 0) {
		this.value = "http://" + this.value;
	}
}

var urlFields = document.querySelectorAll('.mc4wp-form input[type="url"]');
if( urlFields && urlFields.length > 0 ) {
	for( var j=0; j < urlFields.length; j++ ) {
		addEventListener(urlFields[j],'blur',maybePrefixUrlField);
	}
}/* test if browser supports date fields */
var testInput = document.createElement('input');
testInput.setAttribute('type', 'date');
if( testInput.type !== 'date') {

	/* add placeholder & pattern to all date fields */
	var dateFields = document.querySelectorAll('.mc4wp-form input[type="date"]');
	for(var i=0; i<dateFields.length; i++) {
		if(!dateFields[i].placeholder) {
			dateFields[i].placeholder = 'YYYY-MM-DD';
		}
		if(!dateFields[i].pattern) {
			dateFields[i].pattern = '[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])';
		}
	}
}

})();</script><script type='text/javascript' src='https://codea.io/blog/wp-content/themes/slightly/js/navigation.js?ver=20151215'></script>
<script type='text/javascript' src='https://codea.io/blog/wp-content/themes/slightly/js/skip-link-focus-fix.js?ver=20151215'></script>
<script type='text/javascript' src='https://codea.io/blog/wp-includes/js/wp-embed.min.js?ver=5.1.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var mc4wp_forms_config = [];
/* ]]> */
</script>
<script type='text/javascript' src='https://codea.io/blog/wp-content/plugins/mailchimp-for-wp/assets/js/forms-api.min.js?ver=4.3.3'></script>
<!--[if lte IE 9]>
<script type='text/javascript' src='https://codea.io/blog/wp-content/plugins/mailchimp-for-wp/assets/js/third-party/placeholders.min.js?ver=4.3.3'></script>
<![endif]-->

</body>
</html>
