<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/0.83c84941c112953c694f.css">code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#073642}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.0.12"/><style id="glamor-styles">.css-eqrg2l,[data-css-eqrg2l]{color:black;font-weight:normal;text-decoration:none;}.css-eqrg2l:hover,[data-css-eqrg2l]:hover{text-decoration:underline;}.css-e9dldh,[data-css-e9dldh]{margin-left:1em;color:black;font-weight:normal;text-decoration:none;}.css-e9dldh:hover,[data-css-e9dldh]:hover{text-decoration:underline;}.css-n73iwk,[data-css-n73iwk]{margin-left:1em;color:black;font-weight:normal;text-decoration:none;}.css-n73iwk:hover,[data-css-n73iwk]:hover{text-decoration:underline;color:red;}</style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = ["eqrg2l","e9dldh","n73iwk"]
        // ]]>
        </script><title data-react-helmet="true">A RunLoop for your Swift script - Alejandro Martinez</title><meta data-react-helmet="true" name="description" content="In the past few days the Swift community has been awoken again with the promise of a better way of using Swift for scripting, all thanks to…"/><meta data-react-helmet="true" name="keywords" content="Scripting,Swift,Tips and Tricks"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:131.25%/1.38 'Yrsa','georgia',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Yrsa','georgia',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;color:inherit;font-family:'Exo',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;color:inherit;font-family:'Exo',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.27542rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;color:inherit;font-family:'Exo',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.17608rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;color:inherit;font-family:'Exo',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;color:inherit;font-family:'Exo',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.92211rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;color:inherit;font-family:'Exo',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.88547rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}ul{margin-left:1.38rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.38rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;font-size:0.85rem;line-height:1.38rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;font-size:0.92211rem;line-height:1.38rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:1.035rem;padding-right:0;padding-top:0;margin-bottom:1.38rem;font-size:1.08447rem;line-height:1.38rem;color:hsla(0,0%,0%,0.7);border-left:0.345rem solid hsla(0,0%,0%,0.87);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.38rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.38rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.38rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.38rem;margin-bottom:calc(1.38rem / 2);margin-top:calc(1.38rem / 2);}li > ul{margin-left:1.38rem;margin-bottom:calc(1.38rem / 2);margin-top:calc(1.38rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.38rem / 2);}code{font-size:0.85rem;line-height:1.38rem;}kbd{font-size:0.85rem;line-height:1.38rem;}samp{font-size:0.85rem;line-height:1.38rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.92rem;padding-right:0.92rem;padding-top:0.69rem;padding-bottom:calc(0.69rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:hsla(0,0%,0%,0.8);}a:hover{color:#3498DB;}h3,h4,h5,h6{margin-bottom:0.69rem;}@media only screen and (max-width:768px){blockquote{margin-left:-1.035rem;margin-right:0;padding-left:0.69rem;}}</style><link href="//fonts.googleapis.com/css?family=Exo:700|Yrsa:400,700" rel="stylesheet" type="text/css"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" href="/blog/feed.xml"/><link as="script" rel="preload" href="/1-28d6f6ee3c14d25076da.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-e9b74c09b28ce1f8c93a.js"/><link as="script" rel="preload" href="/app-a51e027daa1702f25cd4.js"/><link as="script" rel="preload" href="/0-58db3cdbc7cc87ec59fb.js"/><link as="script" rel="preload" href="/webpack-runtime-d461885828439a392d6a.js"/><link rel="preload" href="/static/d/518/path---blog-2019-01-19-a-runloop-for-your-swift-script-b-49-53d-IwSSTdUjkVfxCacjnLRsjv4O2c.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><div style="margin-bottom:1.5rem;border-bottom:1px solid #e8e8e8"><div style="display:flex;justify-content:space-between;align-items:baseline;margin:0 auto;max-width:960px;padding:1rem 1.0875rem"><h1 style="margin:0"><a class="css-eqrg2l" href="/">Alejandro Martinez</a></h1><div><a class="css-e9dldh" href="/blog">Blog</a><a class="css-e9dldh" href="/tags">Tags</a><a class="css-e9dldh" href="/el-mundo-exterior-podcast">Podcast</a><a class="css-e9dldh" href="/projects">Portfolio</a><a href="https://www.youtube.com/channel/UCfiBFlVY8s-tmJGDMNCd26w" target="_blank" rel="noopener noreferrer" class="css-n73iwk"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" style="color:red;margin-top:-2px" height="1em" width="1em"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg> <!-- -->Youtube</a></div></div></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><div><header><p style="border-bottom:5px solid #EEF;border-radius:5px;padding:2px 10px;display:flex;justify-content:space-between;flex-wrap:wrap"><span>19 January, 2019</span><span><a style="text-decoration:none" href="/tags/scripting"><span style="margin-right:0.5em;margin-left:0.5em">Scripting</span></a><a style="text-decoration:none" href="/tags/swift"><span style="margin-right:0.5em;margin-left:0.5em">Swift</span></a><a style="text-decoration:none" href="/tags/tips-and-tricks"><span style="margin-right:0.5em;margin-left:0.5em">Tips and Tricks</span></a></span><span style="text-align:right">🕐 <!-- -->3<sup>min</sup> read</span></p><h1 style="margin-bottom:0.55em">A RunLoop for your Swift script</h1></header><article><div><p>In the past few days the Swift community has been awoken again with the promise of a better way of using Swift for scripting, all thanks to <a href="https://github.com/mxcl/swift-sh">swift-sh</a>.</p>
<blockquote class="twitter-tweet" data-lang="es"><p lang="en" dir="ltr">I made a new thing, Swift-scripting with dependencies, no additional files, just your script: <a href="https://t.co/JVRbqVkWm2">https://t.co/JVRbqVkWm2</a> <a href="https://t.co/XOOE77b2oM">pic.twitter.com/XOOE77b2oM</a></p>&mdash; Max Howell (@mxcl) <a href="https://twitter.com/mxcl/status/1083942251003297794?ref_src=twsrc%5Etfw">12 de enero de 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
<p>As you may remember <a href="/tags/scripting/">from other posts</a> I've always been keeping an eye on the state of improvements of Swift for scripting. I've recently been using <a href="https://github.com/JohnSundell/Marathon">Marathon</a> which is a great tool that does everything I need. I think swift-sh has made a big splash in the community because, once installed, feels like part of the swift compiler: <code class="language-text">$ swift sh foo.swift</code></p>
<p>But today's tip applies to Swift scripting <strong>no matter the tool you use</strong>. </p>
<h2 id="scripts-with-async-operations"><a href="#scripts-with-async-operations" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scripts with async operations</h2>
<p>Unless your script is really simple and just entails some synchronous manipulation of data, it's likely that you've found yourself with the impossibility of running asynchronous code.</p>
<p>The usual case is when you want to use some networking API to fetch some data and manipulate it. When you do this in an application environment it just works, but if you try it in a script you will be really disappointed.</p>
<div class="gatsby-highlight" data-language="swift"><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token builtin">Foundation</span>

<span class="token builtin">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTask</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">,</span> completionHandler<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token number">_</span><span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token number">_</span> <span class="token keyword">in</span>
	<span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>If you run a script with this code you will see how there is no output at all. </p>
<p>If you think about it that's expected: you're performing an asynchronous operation but by the time that finished the script already reached the last line and terminated itself. </p>
<h2 id="runloop-to-the-rescue"><a href="#runloop-to-the-rescue" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RunLoop to the rescue</h2>
<p>When you are doing this in, for example, an iOS application it works because the asynchronous operation can be awaited thanks to the runloop. The RunLoop is an infinite loop that takes care of handling inputs and interruptions to your program, it keeps it alive indefinitely so asynchronous operations can be finalised.  This is what happens when you use  <a href="https://developer.apple.com/documentation/uikit/1622933-uiapplicationmain"><code class="language-text">UIApplicationMain(_:_:_:_:)</code></a> on iOS or <a href="https://developer.apple.com/documentation/appkit/1428499-nsapplicationmain"><code class="language-text">NSApplicationMain(_:_:)</code></a> on macOS.</p>
<p>For our script to work, <strong>we need to use a RunLoop so the network request has a chance to finish</strong>. </p>
<p>You could try to use the platform specific "ApplicationMain" methods, but it's much better to use the RunLoop API directly. It's quite simple, you just need to add the following line at the end of your script.</p>
<div class="gatsby-highlight" data-language="swift"><pre class="language-swift"><code class="language-swift"><span class="token builtin">RunLoop</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>With this addition you will see the output of the network request printed. Mission accomplished!</p>
<p>But wait, now the script doesn't terminate.</p>
<h2 id="exit"><a href="#exit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exit</h2>
<p>Now our script can run asynchronous operations but it hangs for ever, it behaves like if we had an infinite loop at the end of the file, because that's what we have. We need to manually terminate the script ourselves.</p>
<p>For that we can use the <code class="language-text">exit()</code> function. This function accepts an integer parameter that indicates the exit status of the application:  <code class="language-text">exit(EXIT_SUCCESS)</code> or <code class="language-text">exit(EXIT_FAILURE)</code>. We can use this to indicate to the operative system if the script succeeded or not. This may seem useless if you just run the script manually, but I always recommend using it properly as it becomes really useful if eventually you use this script as part of a bigger system.</p>
<p>With this our script will work as intended, it will have a chance to perform the network request and when the work is done it will finish the script.</p>
<div class="gatsby-highlight" data-language="swift"><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token builtin">Foundation</span>

<span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token builtin">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTask</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">,</span> completionHandler<span class="token punctuation">:</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> response<span class="token punctuation">,</span> error <span class="token keyword">in</span>
   <span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
   <span class="token function">exit</span><span class="token punctuation">(</span><span class="token constant">EXIT_SUCCESS</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token builtin">RunLoop</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<h2 id="using-gcd"><a href="#using-gcd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using GCD</h2>
<p>As an alternative to <code class="language-text">RunLoop.main.run()</code> you can use <code class="language-text">dispatchMain()</code>, a GCD API that has the same effects.</p>
<h2 id="conclusion"><a href="#conclusion" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>If you're starting to write scripts in Swift it's likely that you want to fetch some data from the network. To accomplish that you will need a RunLoop and, luckily for us, Swift's Foundation makes it really easy. </p></div></article><footer style="background-color:#EEF;border-radius:5px;padding:10px"><p style="padding:0;margin:0">👉🏻 If you have any feedback you can reach me at <span><svg style="display:inline - block;width:16px;height:16px;vertical-align:middle;margin-right:2px" viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809 c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg><a href="https://twitter.com/alexito4">alexito4</a></span></p></footer><div style="overflow:auto;margin-top:20px"><a style="float:left" href="/blog/2018/12/24/12-books-in-2018/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" height="1em" width="1em"><path d="M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"></path></svg>12 books in 2018</a><a style="float:right" href="/blog/2019/02/07/speed-up-your-prs-by-splitting-danger-in-two/">Speed up your PRs by splitting Danger in two<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" height="1em" width="1em"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"></path></svg></a></div></div></div><div style="border-top:1px solid #e8e8e8"><div style="display:flex;justify-content:space-between;align-items:center;margin:0 auto;max-width:960px;padding:1rem"><div><p style="padding:0;margin:0">Alejandro Martinez<br/><a href="mailto:alexito4@gmail.com">alexito4@gmail.com</a></p></div><a style="position:relative;bottom:-20px;opacity:0.03;text-decoration:none" href="https://www.youtube.com/watch?v=jAhbMWAO_vk">Buka pintu</a><div><p style="padding:0;margin:0"><span><svg style="display:inline - block;width:16px;height:16px;vertical-align:middle;margin-right:2px" viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809 c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg><a href="https://twitter.com/alexito4">alexito4</a></span><br/><span><svg style="display:inline - block;width:16px;height:16px;vertical-align:middle;margin-right:2px" viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg><a href="https://github.com/alexito4">alexito4</a></span></p></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-js","jsonName":"blog-2019-01-19-a-runloop-for-your-swift-script-b49","path":"/blog/2019/01/19/a-runloop-for-your-swift-script/"};window.dataPath="518/path---blog-2019-01-19-a-runloop-for-your-swift-script-b-49-53d-IwSSTdUjkVfxCacjnLRsjv4O2c";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a51e027daa1702f25cd4.js"],"component---src-templates-post-js":["/component---src-templates-post-js-e9b74c09b28ce1f8c93a.js"],"component---src-templates-tag-js":["/component---src-templates-tag-js-997ac10d7ec61f79de0a.js"],"component---src-templates-project-js":["/component---src-templates-project-js-f718d1854a268da675de.js"],"component---src-templates-eme-post-js":["/component---src-templates-eme-post-js-2580cbb5b3f9da4819cd.js"],"component---src-pages-404-js":["/component---src-pages-404-js-df5368194fc7dbf9f616.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-63ea15ce12a2efbc65cb.js"],"component---src-pages-el-mundo-exterior-podcast-js":["/component---src-pages-el-mundo-exterior-podcast-js-ec7a9c5c4ea3cbcfc82e.js"],"component---src-pages-index-js":["/component---src-pages-index-js-e2b5f02769301d5c819a.js"],"component---src-pages-my-files-js":["/component---src-pages-my-files-js-9f11d185509f3772d6b8.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-1dc3ec83d92deb59794c.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-461debe0e7146073030f.js"]};/*]]>*/</script><script src="/webpack-runtime-d461885828439a392d6a.js" async=""></script><script src="/0-58db3cdbc7cc87ec59fb.js" async=""></script><script src="/app-a51e027daa1702f25cd4.js" async=""></script><script src="/component---src-templates-post-js-e9b74c09b28ce1f8c93a.js" async=""></script><script src="/1-28d6f6ee3c14d25076da.js" async=""></script></body></html>