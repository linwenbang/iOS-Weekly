<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<link rel="shortcut icon" type="image/x-icon" href="//res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico">
<link rel="mask-icon" href="//res.wx.qq.com/a/wx_fed/assets/res/MjliNWVm.svg" color="#4C4C4C">
<link rel="apple-touch-icon-precomposed" href="//res.wx.qq.com/a/wx_fed/assets/res/OTE0YTAw.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">


        <script nonce="1019499655" type="text/javascript">
            window.logs = {
                pagetime: {}
            };
            window.logs.pagetime['html_begin'] = (+new Date());
        </script>
        <title>
 支付宝客户端架构解析：iOS 客户端启动性能优化初探
</title>
        
<style>.radius_avatar{display:inline-block;background-color:#fff;padding:3px;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;overflow:hidden;vertical-align:middle}.radius_avatar img{display:block;width:100%;height:100%;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;background-color:#eee}.rich_media_inner{word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}.rich_media_area_primary.voice{padding-top:66px}.rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{color:rgba(0,0,0,0.3);background-color:#fafafa}.rich_media_area_extra{padding:0 16px 24px}.rich_media_extra{padding-top:30px}.mpda_bottom_container .rich_media_extra{padding-top:24px}.mpda_bottom_container .rich_media_extra .mpad_more_list{right:-10px}.code-snippet{margin:10px 0;display:block;overflow-x:auto;font-size:14px;padding:1em 1em 1em 3em;color:#333;position:relative;background-color:#fafafa;border:1px solid #f0f0f0;border-radius:2px;counter-reset:line;white-space:normal;-webkit-overflow-scrolling:touch}.code-snippet code{text-align:left;font-size:14px;display:block;white-space:pre-wrap;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet code::before{position:absolute;min-width:1.5em;text-align:right;left:-2.5em;counter-increment:line;content:counter(line);display:inline;margin-right:12px;color:rgba(0,0,0,0.15)}.code-snippet_nowrap code{white-space:pre;display:flex}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:flex;line-height:26px}.code-snippet__fix pre{overflow-x:auto;padding:1em;padding-left:0;white-space:normal;flex:1;-webkit-overflow-scrolling:touch}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__fix .code-snippet__line-index{counter-reset:line;flex-shrink:0;height:100%;padding:1em;list-style-type:none}.code-snippet__fix .code-snippet__line-index li{list-style-type:none;text-align:right}.code-snippet__fix .code-snippet__line-index li::before{min-width:1.5em;text-align:right;left:-2.5em;counter-increment:line;content:counter(line);display:inline;color:rgba(0,0,0,0.15)}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}body{-webkit-touch-callout:none;font-family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;background-color:#f2f2f2;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}*{margin:0;padding:0}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:14px}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta_list{margin-bottom:22px;line-height:20px;font-size:0;word-wrap:break-word;word-break:break-all}.rich_media_meta_list em{font-style:normal}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_primary{display:block;margin-bottom:10px;font-size:15px}.meta_original_tag{padding:0 .5em;font-size:12px;line-height:1.4;background-color:#f2f2f2;color:#888}.meta_enterprise_tag img{width:30px;height:30px!important;display:block;position:relative;margin-top:-3px;border:0}.rich_media_meta_link{color:#576b95}.rich_media_meta_text{color:rgba(0,0,0,0.3)}.rich_media_meta_text.rich_media_meta_split{padding-left:10px}.rich_media_meta_text.rich_media_meta_split:before{position:absolute;top:50%;left:0;margin-top:-6px;content:' ';display:block;border-left:1px solid #888;width:200%;height:130%;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;-webkit-transform:scale(0.5);transform:scale(0.5);-webkit-transform-origin:0 0;transform-origin:0 0}.rich_media_meta_text.article_modify_tag{position:relative}.rich_media_meta_nickname{position:relative}.rich_media_thumb_wrp{margin-bottom:6px}.rich_media_thumb_wrp .original_img_wrp{display:block}.rich_media_thumb{display:block;width:100%}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}img{height:auto!important}@media only screen and (device-width:375px) and (device-height:812px) and (-webkit-device-pixel-ratio:3) and (orientation:portrait){.rich_media_area_extra{padding-bottom:34px}}@media only screen and (device-width:375px) and (device-height:812px) and (-webkit-device-pixel-ratio:3) and (orientation:landscape){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}blockquote{padding-left:10px;border-left:3px solid #dbdbdb;color:rgba(0,0,0,0.5);font-size:15px;padding-top:4px;margin:1em 0}.blockquote_info{color:rgba(0,0,0,0.3);margin-top:1.1764705882352942em;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.blockquote_article{display:block}.appmsg_share_notice{font-size:16px;color:#888;position:relative;padding:1.25em 0;margin-bottom:1.75em}.appmsg_share_notice:before{content:" ";position:absolute;left:0;top:0;right:0;height:1px;border-top:1px solid #dfdfdf;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:scaleY(0.5);transform:scaleY(0.5)}.appmsg_share_notice:after{content:" ";position:absolute;left:0;bottom:0;right:0;height:1px;border-bottom:1px solid #dfdfdf;-webkit-transform-origin:0 100%;transform-origin:0 100%;-webkit-transform:scaleY(0.5);transform:scaleY(0.5)}.appmsg_share_notice_hd{font-weight:700;padding-bottom:.2em}.cell{padding:.8em 0;display:block;position:relative}.cell_hd,.cell_bd,.cell_ft{display:table-cell;vertical-align:middle;word-wrap:break-word;word-break:break-all;white-space:nowrap}.cell_primary{width:2000px;white-space:normal}.flex_cell{padding:10px 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.flex_cell_primary{width:100%;-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;box-flex:1;flex:1}.original_tool_area{display:block;padding:.75em 1em 0;-webkit-tap-highlight-color:rgba(0,0,0,0);color:#333;border:1px solid #eaeaea;margin:20px 0}.original_tool_area .tips_global{position:relative;padding-bottom:.5em;font-size:15px}.original_tool_area .tips_global:after{content:" ";position:absolute;left:0;bottom:0;right:0;height:1px;border-bottom:1px solid #dbdbdb;-webkit-transform-origin:0 100%;transform-origin:0 100%;-webkit-transform:scaleY(0.5);transform:scaleY(0.5)}.original_tool_area .radius_avatar{width:27px;height:27px;padding:0;margin-right:.5em}.original_tool_area .radius_avatar img{height:100%!important}.original_tool_area .flex_cell_bd{width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal}.original_tool_area .flex_cell_ft{font-size:14px;color:#888;padding-left:1em;white-space:nowrap}.original_tool_area .icon_access:after{content:" ";display:inline-block;height:8px;width:8px;border-width:1px 1px 0 0;border-color:#cbcad0;border-style:solid;transform:matrix(0.71,0.71,-0.71,0.71,0,0);-ms-transform:matrix(0.71,0.71,-0.71,0.71,0,0);-webkit-transform:matrix(0.71,0.71,-0.71,0.71,0,0);position:relative;top:-2px;top:-1px}.rich_media_global_msg{position:fixed;top:0;left:0;right:0;padding:.85em 35px .85em 15px;z-index:2;background-color:#c6e0f8;color:#888;font-size:12px}.rich_media_global_msg .icon_closed{position:absolute;right:15px;top:50%;margin-top:-5px;line-height:300px;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0);background:transparent url(//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg/icon_appmsg_msg_closed_sprite.2x42f400.png) no-repeat 0 0;width:11px;height:11px;vertical-align:middle;display:inline-block;-webkit-background-size:100% auto;background-size:100% auto}.rich_media_global_msg .icon_closed:active{background-position:0 -17px}.rich_media_global_msg.voice{color:#1aad19;background-color:#e8f6e8;padding-left:43.3px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rich_media_global_msg.voice .ic_voice{position:absolute;top:50%;margin-top:-10px;left:15px;display:inline-block;width:13.3px;height:18.3px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAA3CAYAAAB+fggjAAAAAXNSR0IArs4c6QAACb9JREFUaAW9WX9wVMUd3917d5cf/Agp1OTuQgIlQqUoI1JI1Noojg2I+VU7hVrtDDpadRypgzKjU52x09KOdsS20ypSO/WPWttcAqhTOlSoU4FIoRUn0wEZIMndBUkwGEhyv97bfvaS97L77t3lHYUuc+z3935397vf/e4LJZfQnuPPsW0d25ZQzr9mELKSUnIVzHxB/Dh+lBOKf4OEk0FOyQAl/CyltIt5tL29d/V2FzIkLUQ4FA7dwon+KCF0Fee8rBBdS5aSs/D+PUrYbyKtkb9b9BzAlA7CERrqDN1DOH8C8HU57FwSGat6kBGypbcluhMwFj+75XWwemf1vHQqtZ0T3pCtelkp73uJ79s9bT39dqs5HQyFK79jcPIKFErtSgLHjPvQHQB0EFt2hDE2QHU6RMvpkODrw3o50Uk5p3w2N/SlUKhHTNZjskHBz2pi6ylbH22J/k3mOToYCAceIYT/AgYVPhxJQTkMQ792Ez/yQCY8d0fgRl0nj8J2G5z1mvSJ3qCMrYOTb5l0xQFBDIUDjxmcbzUFJnu621/kf/DUmlM9k7RLh4LtwRChxquck0bFCqWjxENuijXF/iXoioNVnZU36wZ5D7PTTCWsWhyp4uFYa+x1k3Y5ezj6oNgtdTVpL0Lo+mhr9BwO0Xib+/bcWYZB35Sdg/sXsOSNV8o5MXK0LfoKYXQDxpJOMZ8L1g8E33JQT6aeQRoJCOJEMxjxfCvSEtlnEq5Uj5h7Ayv2I8U+5w9du/va0oyD896ZV004RQKebIzQ53EQ/jJJubJQhUa2YBXPmqNgy8vPjZ67N+NgMh6/HwSfyURgniwqLvmJif8/+sNrY6O4XV5WxjKMuvHDQOl9uCksHmX0xydWn0hYBJfAgncXzBhNjjZSnX8Fq3ENdmWWUMUhS2Ebv5HrtjDNg/+B5IY4wos0cVukUskqUwj9xfKS2W9GSEwi5QdxFS5BMn54dGzkHkhOy0x18j9COY1O5VxmhGJylIxMjgUTC7WUkfrqJAkQpfuP3nFUElO4WUgwHHza0HU1wG1SGOi0jeSI+kf92hgZlXg0yajBV0gUwri4vqZud/O7PbhxkGiNvM5NWHKV3NN8LGQbuVdDsYIVzOzHOI+ygzYhR/RAxwdbELcPZDEp+Q+2YQcS2L+Zwc4gdSUQS7Oz5BwIKUqWyq5ApEdDsVmhBKaHnHDQVUg1uwKLkkm+USEScsbjId/ra+7fbaMThMHVdpoTjuyxXloqcUg+Eqe4WBb26/5hGXeCkynyfdA9Fo/SQeZlN/StjUQtmgQUFxVnKhyJlAUGOgP13OC3ygxGWZhhSYtkYqIicUHGnWCUluoFz8mzkRzOCf14Wfyikx2ThvQ0B6XZdvhi1QaoAfZHmiMf40xMJmih4BvxWQnbNCD3i/cunoYab4FMQwr5o4zb4Uh9ZMxOM3Fsf91YfPQfOAeLTJrouYc8K3rEII0ikBcKRLTEhUQNuo8E7NSGh4dnyDOFzIioOpxkZdqyXYGSAV2rMYjhIUamkL2ZcANvG+MWWS4DU/parDm2R8AiBj/Bz3IQe14DPKeDRho1hNyonFplhgp/mmaNhpH6s0VVToNFxR7TPcVFJVZdgMG4cNBq0LvRQhyA2vLaMyDrFouTL169KzBlGkEofdnScQYMXBI/raiuXC1fs4wz2iXLI+U0y7gd3tewL41IVhLvmM6X2eWycM7nZ9EEAXWgWDWPpjWg7tx8+IbD4llhNTadTn8XcWgVBphprbhbLQkngJK/ymTdoE/IuDPME5jYSYx1HLn3EH6/B77Rq/m+FG2L3d7X1Pe+kx5kCBJp4G0clDWmAJTD0db+NhO398GO4G3cMDJBbPIY9bShfgyb+OXqMwGPV9rrskFsc6t4fck0GRZPQ5GnZBpO4x/wvrAmKfP+FzjjYF9zn5i58s0ET8MX8hnGc+BxOGnFi8innBg7UUBsFaV6Pt1CeBMrKD73qG8CbPnKUHvg/lzG+tr6DlGWufJkEWQp/tjgyMBJPF+fWrhj4XSZeSlwJgaFIhyioY7gHvS3moYyK6TRO6JN0b0mzd6HOgIbEBK/gp7fzsOBGMLUX2Z+bWvvnb1T3sd2fYFbDgoET8/56UTqKEBrizDIeY1463tae1BGObeq9qrlBtXb4aRcmVvCmOjneFq+UFZW9lJ3Q3fee9lSmgAUBwUNd+N9CPjfTfDHO0pO+z1FK081nfpUoUuIuKPPD322Gav5OMjWBCURRBGN4GH0QCGvxSwHhcFguPLnGEip97AKXd5y39dPN5yOy4PaYXGrjKToRsTMIzg4M+38cZz+LNYWe8qZp1Izh0QlEVLfctMmzNb6gCP4GGxFcij5W7usHT++NjaI4uHpadr0KkbpZvAH7DKw9iRi98lsejbFcQWF2LJ/LvOe6Yl14m5eLavhU8gqkQdlWj5YnOSL+sXNWNFNmKT1NQsLkGAez3zcIHmfj44rKAYUd2Jxcek6HCP1cHD+Ig5DzonZnT3WdOyCWFGukRUIwkGTL069kdYz319MmlOf00EhjKpiWKPku7IiDF9X3RHMecvIsjIsPqdh1ewO3SXLOMF5HRQKvS39h5GNOmVlnZP1Mu4W9pZ5/4TDZh0ybHkt3iKOqcm0OaWDQpB52DZTQfQo+Vtl3C08kQGO2OStYtlGz6CuHJxZO3MPYnHYMsDJVSKpW3ghAOXKsxaPoup86q4c7F7cncSyHZANGen0Shl3C+PSPy/L4qmZ97525aAwiMLgQ8Uwp8tl3C2MASff00KJMRW3GXLtIFbwY1kXp/kaGXcL42AoDqHit6p5JxuuHfQwj1IvIhFO9QhyGk/QpskM/C3Gyo0y3YRdOzgnNOcTHJS0qYgVrBIfLE28gF75ToN3bySfrmsHM68tTo7JxuKJ+PUyPhWcqbQ5XarI+TRlZxQeENcOjitS5dMc5/oqu8F8+ODI4FrEoPVpBTfL8akK2YIc9DCiFAkoyTbUdNSU5XPK5Im/MQPeZOKZnpNdCu6AFOTgrJLZO2FDrogrUjyxPbQ/VOxgWyG9Fn71h6hoJkMC8exlvl8qQg6I66rE1A22Vz6PEuwZExe92CrQtmmU72U+fzQ9K/15XV1dsuudrhlc50t0XX8Izq1TdAh5I9rWf69Mc4ILdlCU9kNDn32ICvZS0wySAY2W+shSUdw6OSXTCtpioSgePZrPeydWTUncstF8MPRw1dFvunFO2CnYQaGEk3cSn8iWYyVeBGoImqtG6RHxQsQfEJVskE+34C22GxOfb8fiY40owtaAJ0qnciTxcvSlE7VfBPX3IQ8lb/U2R3dgBRGu7tt/AYJkZEGv/oaXAAAAAElFTkSuQmCC) no-repeat center;background-size:contain}.rich_media_global_msg.voice .icon_more{position:absolute;right:15px;top:50%;margin-top:-6.5px;width:8px;height:13px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAmCAYAAADeB1slAAAAAXNSR0IArs4c6QAAA49JREFUSA2tVk1IVFEUPveOmhQk1ibfvLFZSJtACqJIIpCIoB+imcFV2Z9ZUVnRomgRGFn2i6mFf5XVotCZMYmgIMhlq6BFENFiwjfPAosgFzXOvNu5o3fmeue98Y16F3PP+c453/fu/xCQmvZSWwwJaC0G6P8WND9IoTmbVFRycpqAdgBWkwRo94V960RsPn1aoPpN9RI6CR0WsDWcjAErtUiqTR/S18+HnNcSTv5zYrwDSatVMgLkH6aciwfj79WYW5+OT4xfsyPnBIgvwt872qBW45ZQzaMlJXCfMPJbDQgfRUoIhduVUW2TwArpaWyX+bnYU9JAAH44FaJIccqCW76Ib7NTjhOOvFPN/8q/IvE3cR+npFJgao9rkiSUXjD2GCNqzMnPbNPYjth3mqINlJAvTsk4kiJmWa3eQe8WpxwVzwjwgFFn/CorL29EkY9qovC5CFDrKq7JVoHl6zNTJCf53/lLk78SN/FcbJRx2cZCixC4ZATGXsu4as8YgQjGamN/q5atOotn4K3A1J4BUMbgsh7Wt6sx2bcV4AkjtSPJxkDjRQL0hVwg21zEglSzN+rdKeOybTtFcgK39ajWZDFWr+IZHxfGQ8mV0YA5nMGmDVcCPNcb8R5gYJ1UCWQfp6PFCI4NyZhrAV6EIiHGrPOAB0ImkW2c0la8u8ICc0wUCWrvC1dsw+3TnN6uanDaJ4zeiIfiA9wtWIAX8XspxeA6iuBlaN88hNzCNXk+JwFOuXJYW5tMQmc+EcqgzXGb2n9XFk1NstX5yKczl89JAF+6vRaBM1m5XAu//qkRGrtb8BThTtqH2/V0LmUWwbvsiREw8X0vcJHxxNbjNm3KUuVaMjmPFuWm2CPesHc/kp+yj06hFMhj/PIOOcfVFLk6xZT0G3vMTpmc27MusityZk/OBfKOwA05MPLIDJn3OJldcxTQotpBYOyEXVEWIw/NoInvuHOznSJfVDs0GzneNw9mI+eyOSPQI9phfCqPO38TFhHaFw/Eu/LliNiMESB5w6zkzD05F8mMYJr8mFC263Fa+vAadvXloj4toEcrjlgMjgrQrseHpBcfkm67WD6M6MN6lTWZeoZjyYxGLcB57MGnsEfF3fjU2G189QBpcUqmBLrnSs4504s8GjLxrwm5qYrg3dKFf6x6VbwQ3yOS/wz8+bS0ruwfELaBY2nyoNkn4gvW65GKRn4WForwP+dONHDaOHeZAAAAAElFTkSuQmCC) no-repeat center;background-size:contain}.preview_appmsg .rich_media_title{margin-top:2.3em}@media screen and (min-width:1024px){.rich_media_global_msg{position:relative;margin-bottom:32px}.preview_appmsg .rich_media_title.rich_media_title{margin-top:0}}.pages_reset{color:#333;line-height:1.6;font-size:16px;font-weight:400;font-style:normal;text-indent:0;letter-spacing:normal;text-align:left;text-decoration:none;white-space:normal}.weapp_element,.weapp_display_element,.mp-miniprogram{display:block;margin:1em 0}.share_audio_context{margin:16px 0}.weapp_text_link{font-size:17px}.weapp_text_link:before{content:'';display:inline-block;line-height:1;background-size:contain;background-repeat:no-repeat;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAB4RJREFUWAm1WUuMFGUQnn7szL5mdvbh7GwgEQUlS1weiagxxpigiUZeJgY1cMMDcDCGG8GLCWZvxHjh4BWUeDEsejBBEzWYKBBEiHAABBfCMOwsuzvszrvb+v6Zb7amt1ce0Up6qv6q+qq+/rv778dYkUeUqamp5dFodJPv++ts205blpX2PG8I5cTOiLol44zYZ8vl8vFkMnnlUVpZDwPK5/MpIbWrVqttFlLD0jwiBEHIaNbCGKJjQvai+I9Xq9VD8Xg8y9z76QcimM1mu3t6ej4UYh84jtOFxhBNJGxskhp5xIielZ37bHp6+tNUKnWPOYvp+xKcm5t7S4gclKIpFNGzsmjRkBnUOwNbZjQrtfZ2dnZ+vVgd+O1/CVqlUukjIXZYCqZADBuEJIllc4xh61zmaB9s7LDkHkYPwJgX1KEEx8fHO2TmjkjyPgLQmERIAjHajGnyjDGPOfQ3xvvQCz3ZS+sw5hYAsodbWBhNw4SNGCMBnR/MYS60jskhPyaHe7u4W5otmEGZ8v0gx2YsyDE0bc4Wx8glOe2Dn2No2hqPnuiNXC0tM9i4IA5LcksjNm0BNs417aMNAsRom3HoMD8wsu3QF06TIJaSRCJxXrDmamUBrVEYRejDmDY0JEgsLE4f8mkTj6tb1tsRLkEukiBY56Q4rizThI2okaNtjFlUx+Cr1vzIyTMz7uW/ik4mV7Yd24oMDrR5q1Z01Nav6a5yVsLwcvRS4CI1D5ge+MEdQhbgC1yECSQhjMNsYCGMQ2dzFeuLYxOxibuVBec3cpekY7XtWwZK8a75sMajj2yzcsd5BnccM4PCeg/JoQjJwAY4TFgUMeRjXK54kS/H6uR6e1xvw4vJyuNLYh5yrt8s2d//MtV2M1Nyvvo2F9u5LVUSJEJNPPtKrS7XdXdL6GOzG+LYqIJNUiShYyRDjRw2OXnmnntnsmInE663e3u6uHZVZy2ZsH1sa4Y7ant2DBURu3aj6Jz9c9YBVuNRhz6pvwlju1gsPikzaG78CKIxNgh1sAj91MhFztXrRQf2C+vi1Y721tMC/vZYPQb78rWCE8Tr/uCEJyZbrprNAAST4QOAIGj6qBnDGPjZgmeS0gNRc1jD8D1xx+y978/XJh4awl54nHOl8Do6STKoDarxg5gmxpj2yTEwbtZhDvSlKwUzy+lU1NPxFvz8EcSzpnnYXDCD3AtqFtOFGNM+kMBYx+DzPD/y86m8e+7SnBON2v7qlR01ncP6Gg9uriSlGSSAYyTDhl/7bmTK9tXxkj3ydFetL4lTqT5jyIdgTB/0qT9m3R9/zbvT+Yottfw3XuktJxP1Q61rh/QfcuUcHBKmzcIwdCILQE/crVpHj9+JZe7U17hSyau89lJPxYDVD3KJm5qpWWMnJqMIY+nZvKGv/NQT7ebwcicI5RhYiHBLYx30WQxObWNMyQm5Q0cy7ULK6up0/PUj3dWXn48bckEMGrGZkPJ3bhssunLmLR2qXzyIacxitvT2XZm9jABWMEmD6QPJYzILILdyeWf13Y39ZTSEMAeaQpuxZUujHn26fhCPmI6Dmy0OvIE1AyyqfYWiH7n6d9GJxWz/7df7FpBjLjQETag1Me1HPKxXwJfByXeLRViUYGiI3F/NSYr1raPdNoXh594S75nVT1Z/mUz6kAfhGJp2EI887gRy5Bw0M/g7ndQI0gZISJkpyU6WbTm7m8RYELnFkh+ZnK4/qCTiWF4XXtk6X5NkLjX7iz4rh9keAxBODaKNWKrf9Qd627yC3Cm++2m6DbHWYpHI2Im7UfFZqf6oN9DrmAsPWIquH8QjR8dRG2O88JszW56kTwvRYSayOYtD37xdsT8/ejtWq/nWsqXttdXDHdW+RNTHY9Vv5/IuTgPHtfxd7w0V04/V1ziND5IiCeTofsyTw3tRnqyfNY9b8qg1JkktXwo0EKAlg23eO2/2l7/5YaoNTyPYNIFEt6xxr/aVQQ75QTxJkEBYnDFocEKOqYQHVnn+uiCBLji1IBnCBiVZ+U6fv+dmshV7cqpq9fY4/tBg1HtudXe1zeyuRs9fHMRrEvQBQT9smb1Z+YphHljr3cWJF2gB7NOENAhAjrWGP9iIPuZhDOFYa/hD8KOxWOyAweAHEnxpqnvrvyyofbQZg4boZsEcjrUO4mX2Wl6a6jdhQeAtSoJ70YDNoIMFwmJoqImF5Wgf8jHGRhx0Y9vLNzrkNQligPdRuZpHgyDEKIixMPMQow82/dC04YdgzFwdg0+2Uf1OjPzmOYhBQ6xCoYCX9626WDOo9pqNqHUO7IfBy0XxYJ8+UHdiYuJ9AHQT2GGiycHmmLNDkmFY+JCPXrlcbqcMW28/iCNpEcHnt/3SwHzhQiEIG5JAGDYsN8yHGjil5Ir9BKVDa4U5ta/xveagNDCfRBhDQ5JczEaujhHb0FlclMFzLpDTepEEgxijAL6VSCNcPLPw6aa0oSEgTZsx+GFjwyIsenRmZmbkfuQMDj8PKrjjyCHZIw02im7eGokHAQhnFjZ8GAux/+8jOhoFhX9DCIG1EsPfD9jMC5j4/rO/If4BCiyOk7IAfLMAAAAASUVORK5CYII=');vertical-align:middle;font-size:11px;color:#888;margin-right:6px;margin-top:-3px;background-position:center;height:20px;width:20px}.flex_context{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.flex_bd{-webkit-box-flex:1;-webkit-flex:1;flex:1;word-wrap:break-word;word-break:break-all}.original_page{background-color:#fff;font-size:16px}.account_info{padding:0 0 20px}.account_info .flex_bd{padding-left:.85em}.radius_avatar.account_avatar{width:40px;height:40px;padding:0}.account_nickname{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;line-height:1.2;color:#576b95;font-size:14px}.account_nickname_inner{font-weight:400;vertical-align:top}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:#b2b2b2;font-size:13px;line-height:1.2;padding-top:.3em}.account_desc_inner{display:inline;vertical-align:top}.share_notice{margin-bottom:20px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.share_media{padding-bottom:18px}.original_panel{padding:20px;background-color:#fcfcfc;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;position:relative}.original_panel:after{content:" ";border:1px solid #d8d8d8;border-radius:4px;-moz-border-radius:4px;-webkit-border-radius:4px;position:absolute;top:0;left:0;width:200%;height:200%;-webkit-transform:scale(0.5);transform:scale(0.5);-webkit-transform-origin:0 0;transform-origin:0 0;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}.original_panel .original_account{margin-bottom:18px;position:relative;z-index:1}.original_panel .original_account_avatar{width:28px;height:28px;padding:0}.original_panel .original_account_nickname{padding-left:.85em;font-size:15px;color:#576b95}.original_panel_title{font-size:23px;color:#000;margin:0 0 16px}.original_panel_content{color:#333}.original_panel_tool{padding-top:20px;position:relative;z-index:1}.original_tool_area.disabled{padding:0}.original_tool_area.disabled .flex_cell_bd{-webkit-box-flex:initial;-webkit-flex:initial;-ms-flex:initial;box-flex:initial;flex:initial}.original_tool_area.disabled .flex_cell_ft{-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;box-flex:1;flex:1;padding:0}.original_tool_area.disabled .original_tool_tips:after{content:"："}.original_tool_area.disabled .original_cell_nickname{color:rgba(0,0,0,0.3);overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;white-space:normal;max-width:none;min-height:1.6em}.original_tool_area.disabled:before,.original_tool_area.disabled:after,.original_tool_area.disabled .radius_avatar,.original_tool_area.disabled .icon_access:after{display:none}.original_cell_nickname{display:inline-block;vertical-align:middle;font-weight:400;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal;max-width:8em;color:#000}.original_tool_area{padding:1.17em 0;border-width:0;position:relative}.original_tool_area:before{content:" ";position:absolute;left:0;top:0;right:0;height:1px;border-top:1px solid #dfdfdf;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:scaleY(0.5);transform:scaleY(0.5)}.original_tool_area:after{content:" ";position:absolute;left:0;bottom:0;right:0;height:1px;border-bottom:1px solid #dfdfdf;-webkit-transform-origin:0 100%;transform-origin:0 100%;-webkit-transform:scaleY(0.5);transform:scaleY(0.5)}.original_tool_area .radius_avatar{width:20px;height:20px;margin-right:.2em}.original_tool_area .flex_cell{padding:0;font-size:14px}.original_tool_area .icon_access:after{margin-right:4px;top:0}.preview_appmsg .rich_media_title{margin-top:1.5em}.preview_appmsg .account_info{padding-top:3em}.original_page{background-color:transparent}.account_info{-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0;padding-bottom:20px;font-size:14px}.account_info.appmsg_account_info{padding-bottom:32px}.account_info .radius_avatar img{background-color:transparent}.share_notice{font-size:16px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.original_panel{background-color:#fafafa}.original_panel:after{border-color:#e6e6e6}.original_panel .original_account_avatar{width:30px;height:30px}.original_panel_tool{font-size:14px}.original_panel_tool a{color:#576b95}.original_panel_content{font-size:17px}.share_media{padding-bottom:30px}.icon_appmsg_tag{display:inline-block;vertical-align:middle;padding:0 .5em;font-size:12px;line-height:1.5;background-color:#c3c3c3;color:#fff;border-radius:2px;-moz-border-radius:2px;-webkit-border-radius:2px;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal;max-width:70%}.icon_appmsg_tag.primary{color:#3bb638;padding:4px .78em;background-color:rgba(9,187,7,0.08);font-size:12px;border-top-left-radius:.95em 50%;-moz-border-radius-topleft:.95em 50%;-webkit-border-top-left-radius:.95em 50%;border-top-right-radius:.95em 50%;-moz-border-radius-topright:.95em 50%;-webkit-border-top-right-radius:.95em 50%;border-bottom-left-radius:.95em 50%;-moz-border-radius-bottomleft:.95em 50%;-webkit-border-bottom-left-radius:.95em 50%;border-bottom-right-radius:.95em 50%;-moz-border-radius-bottomright:.95em 50%;-webkit-border-bottom-right-radius:.95em 50%}.icon_appmsg_tag.default{border:1px solid rgba(0,0,0,0.1);color:rgba(0,0,0,0.3);background-color:transparent;padding:0 .54em;font-size:15px;line-height:1.3;border-top-left-radius:.67em 50%;-moz-border-radius-topleft:.67em 50%;-webkit-border-top-left-radius:.67em 50%;border-top-right-radius:.67em 50%;-moz-border-radius-topright:.67em 50%;-webkit-border-top-right-radius:.67em 50%;border-bottom-left-radius:.67em 50%;-moz-border-radius-bottomleft:.67em 50%;-webkit-border-bottom-left-radius:.67em 50%;border-bottom-right-radius:.67em 50%;-moz-border-radius-bottomright:.67em 50%;-webkit-border-bottom-right-radius:.67em 50%}.rich_media_meta_list .icon_appmsg_tag.default{margin-top:-1px}.icon_appmsg_tag.title_tag{background-color:#d04b4e}.icon_global_tag_wrp{text-align:right;padding-bottom:12px}.icon_global_tag{background-color:rgba(118,118,118,0.16);color:rgba(0,0,0,0.41);line-height:2.2;border-top-left-radius:1em 50%;-moz-border-radius-topleft:1em 50%;-webkit-border-top-left-radius:1em 50%;border-bottom-left-radius:1em 50%;-moz-border-radius-bottomleft:1em 50%;-webkit-border-bottom-left-radius:1em 50%;padding:0 1.8em 0 1.34em;font-size:12px;margin-right:-24px;display:inline-block;vertical-align:top}.global_plain_btn{display:inline-block;vertical-align:middle;padding:0 1em;line-height:2;font-size:14px;-webkit-tap-highlight-color:rgba(0,0,0,0);border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px}.global_plain_btn.primary{color:#1aad19;border:1px solid currentColor}.global_plain_btn.primary:active{color:rgba(26,173,25,0.6)}.wx_video_context{color:#fefefe;position:relative;background-color:#000}.wx_video_thumb,.wx_video_thumb_primary{position:absolute;left:0;width:100%;height:100%!important;top:0}.wx_video_thumb_primary{-webkit-background-size:cover;background-size:cover;background-position:50% 50%;background-repeat:no-repeat}.wx_video_play_btn{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);margin-top:-2px;font-size:0;border-width:0;background-color:transparent;padding:0;outline:0;z-index:2}.wx_video_play_btn:before{content:" ";display:inline-block;width:0;height:0;border-width:14px 0 14px 25px;border-color:transparent transparent transparent #fff;border-style:dotted dotted dotted solid}.wx_video_mask{position:absolute;top:0;left:0;right:0;bottom:0;z-index:1;background-color:rgba(0,0,0,0.5)}.place_audio_area{min-height:100px;background-color:#fdfdfd;display:block;margin:16px 0}.place_music_area{min-height:68px;background-color:#fdfdfd;display:block;margin:17px 0 16px}.rich_media_empty_extra{background-color:#fafafa}.appmsg_skin_default.rich_media_empty_extra{background-color:#fff}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.appmsg_style_default .rich_media_tool{padding-top:15px}.rich_media_title_ios{font-weight:700}.read-more__area{margin:30px 0}.read-more__desc{margin-bottom:10px}.read-more__article__extra{font-size:14px;color:rgba(0,0,0,0.5)}.read-more__article__item{margin-bottom:10px}</style>
<style>
        </style>
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/pc435ee6.css">
<![endif]-->

    </head>
    <body id="activity-detail" class="zh_CN mm_appmsg  appmsg_skin_default appmsg_style_default">
        
<script nonce="1019499655" type="text/javascript">
    var biz = ""||"MzUyMDk2MzUzMQ==";
    var sn = "" || ""|| "941ef69ac5f9813a2e5bfdfa6209fb9f";
    var mid = "" || ""|| "2247483834";
    var idx = "" || "" || "1";
    window.__allowLoadResFromMp = true; 
    
        
</script>
<script nonce="1019499655" type="text/javascript">
var page_begintime=+new Date,is_rumor="",norumor="";
1*is_rumor&&!(1*norumor)&&biz&&mid&&(document.referrer&&-1!=document.referrer.indexOf("mp.weixin.qq.com/mp/rumor")||(location.href="http://mp.weixin.qq.com/mp/rumor?action=info&__biz="+biz+"&mid="+mid+"&idx="+idx+"&sn="+sn+"#wechat_redirect"));
</script>
<script nonce="1019499655" type="text/javascript">
var MutationObserver=window.WebKitMutationObserver||window.MutationObserver||window.MozMutationObserver,isDangerSrc=function(t){
if(t){
var e=t.match(/http(?:s)?:\/\/([^\/]+?)(\/|$)/);
if(e&&!/qq\.com(\:8080)?$/.test(e[1])&&!/weishi\.com$/.test(e[1]))return!0;
}
return!1;
},ishttp=0==location.href.indexOf("http://");
-1==location.href.indexOf("safe=0")&&ishttp&&"function"==typeof MutationObserver&&"mp.weixin.qq.com"==location.host&&(window.__observer_data={
count:0,
exec_time:0,
list:[]
},window.__observer=new MutationObserver(function(t){
window.__observer_data.count++;
var e=new Date,r=[];
t.forEach(function(t){
for(var e=t.addedNodes,o=0;o<e.length;o++){
var n=e[o];
if("SCRIPT"===n.tagName){
var i=n.src;
isDangerSrc(i)&&(window.__observer_data.list.push(i),r.push(n)),!i&&window.__nonce_str&&n.getAttribute("nonce")!=window.__nonce_str&&(window.__observer_data.list.push("inlinescript_without_nonce"),
r.push(n));
}
}
});
for(var o=0;o<r.length;o++){
var n=r[o];
n.parentNode&&n.parentNode.removeChild(n);
}
window.__observer_data.exec_time+=new Date-e;
}),window.__observer.observe(document,{
subtree:!0,
childList:!0
})),function(){
if(-1==location.href.indexOf("safe=0")&&Math.random()<.01&&ishttp&&HTMLScriptElement.prototype.__lookupSetter__&&"undefined"!=typeof Object.defineProperty){
window.__danger_src={
xmlhttprequest:[],
script_src:[],
script_setAttribute:[]
};
var t="$"+Math.random();
HTMLScriptElement.prototype.__old_method_script_src=HTMLScriptElement.prototype.__lookupSetter__("src"),
HTMLScriptElement.prototype.__defineSetter__("src",function(t){
t&&isDangerSrc(t)&&window.__danger_src.script_src.push(t),this.__old_method_script_src(t);
});
var e="element_setAttribute"+t;
Object.defineProperty(Element.prototype,e,{
value:Element.prototype.setAttribute,
enumerable:!1
}),Element.prototype.setAttribute=function(t,r){
"SCRIPT"==this.tagName&&"src"==t&&isDangerSrc(r)&&window.__danger_src.script_setAttribute.push(r),
this[e](t,r);
};
}
}();
</script>

        <link rel="dns-prefetch" href="//res.wx.qq.com">
<link rel="dns-prefetch" href="//mmbiz.qpic.cn">
<link rel="shortcut icon" type="image/x-icon" href="//res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico">
<link rel="mask-icon" href="//res.wx.qq.com/a/wx_fed/assets/res/MjliNWVm.svg" color="#4C4C4C">
<link rel="apple-touch-icon-precomposed" href="//res.wx.qq.com/a/wx_fed/assets/res/OTE0YTAw.png">
<script nonce="1019499655" type="text/javascript">
    String.prototype.html = function(encode) {
        var replace =["&#39;", "'", "&quot;", '"', "&nbsp;", " ", "&gt;", ">", "&lt;", "<", "&yen;", "¥", "&amp;", "&"];
        
		
		
		
		
        
        var replaceReverse = ["&", "&amp;", "¥", "&yen;", "<", "&lt;", ">", "&gt;", " ", "&nbsp;", '"', "&quot;", "'", "&#39;"];
	    var target;
	    if (encode) {
	    	target = replaceReverse;
	    } else {
	    	target = replace;
	    }
        for (var i=0,str=this;i< target.length;i+= 2) {
             str=str.replace(new RegExp(target[i],'g'),target[i+1]);
        }
        return str;
    };

    window.isInWeixinApp = function() {
        return /MicroMessenger/.test(navigator.userAgent);
    };

    window.getQueryFromURL = function(url) {
        url = url || 'http://qq.com/s?a=b#rd'; 
        var tmp = url.split('?'),
            query = (tmp[1] || "").split('#')[0].split('&'),
            params = {};
        for (var i=0; i<query.length; i++) {
            var arg = query[i].split('=');
            params[arg[0]] = arg[1];
        }
        if (params['pass_ticket']) {
        	params['pass_ticket'] = encodeURIComponent(params['pass_ticket'].html(false).html(false).replace(/\s/g,"+"));
        }
        return params;
    };

    (function() {
	    var params = getQueryFromURL(location.href);
        window.uin = params['uin'] || "" || '';
        window.key = params['key'] || "" || '';
        window.wxtoken = params['wxtoken'] || '';
        window.pass_ticket = params['pass_ticket'] || '';
        window.appmsg_token = "";
    })();

    function wx_loaderror() {
        if (location.pathname === '/bizmall/reward') {
            new Image().src = '/mp/jsreport?key=96&content=reward_res_load_err&r=' + Math.random();
        }
    }

</script>

<script nonce="1019499655" type="text/javascript">
        window.__moon_report_uin = "0";
            window.no_moon_ls = 0;
    </script>

        
<script nonce="1019499655" type="text/javascript">
    var write_sceen_time = (+new Date());
</script>

<div id="js_article" class="rich_media">
    
    <div id="js_top_ad_area" class="top_banner"></div>
    
    <div class="rich_media_inner">

        
        
        <div id="page-content" class="rich_media_area_primary">
          <div class="rich_media_area_primary_inner">
                                    
                        

            <div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">
                    
                    
                    支付宝客户端架构解析：iOS 客户端启动性能优化初探

                                                                                </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                            <span class="rich_media_meta rich_media_meta_text">
                                                石扉
                                            </span>
                                        
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" id="js_name">
                        mPaaS                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">mPaaS</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">ant_mpaas</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">mPaaS (https://tech.antfin.com/mobile-service) 源于蚂蚁金服金融科技，致力于提供高效、灵活、稳定的移动研发、管理平台。</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text"></em>





                </div>
                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <section class="RankEditor" style="white-space: normal;border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box;"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="display: inline-block;width: 32px;height: 32px;border-radius: 32px;vertical-align: top;text-align: center;border-color: rgb(0, 162, 255);background-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table;width: 32px;border-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table-cell;vertical-align: middle;border-color: rgb(0, 162, 255);box-sizing: border-box;"><p><span style="color: rgb(255, 255, 255);font-size: 14px;font-weight: bold;">1</span><br  /></p></section></section></section><section style="margin-left: 16px;display: inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">前言</p></section></section></section><p><span style="font-size: 14px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;">《支付宝客户端架构解析》系列将从支付宝客户端的架构设计方案入手，细分拆解客户端在“</span><strong style="font-size: 14px;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;box-sizing: border-box;">容器化框架设计</strong><span style="font-size: 14px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;">”、“</span><strong style="font-size: 14px;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;box-sizing: border-box;">网络优化</strong><span style="font-size: 14px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;">”、“</span><strong style="font-size: 14px;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;box-sizing: border-box;">性能启动优化</strong><span style="font-size: 14px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;">”、“</span><strong style="font-size: 14px;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;box-sizing: border-box;">自动化日志收集</strong><span style="font-size: 14px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;">”、“</span><strong style="font-size: 14px;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;box-sizing: border-box;">RPC 组件设计</strong><span style="font-size: 14px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;">”、“</span><strong style="font-size: 14px;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;box-sizing: border-box;">移动应用监控、诊断、定位</strong><span style="font-size: 14px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: pre-line;">”等具体实现，带领大家进一步了解支付宝在客户端架构上的迭代与优化历程。</span><br  /></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">启动应用是用户使用任何一款应用最必不可少的操作，从点击 App 图标到首页展示，整个启动过程的性能，严重影响着用户的体验。支付宝客户端作为一个超级 App，启动性能当然是我们关注的重要指标之一，下文将从三方面来介绍支付宝在 iOS 端启动性能优化的具体设计思路。</span></p><section class="RankEditor" style="white-space: normal;border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box;"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="display: inline-block;width: 32px;height: 32px;border-radius: 32px;vertical-align: top;text-align: center;border-color: rgb(0, 162, 255);background-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table;width: 32px;border-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table-cell;vertical-align: middle;border-color: rgb(0, 162, 255);box-sizing: border-box;"><p class="count white" style="color: rgb(255, 255, 255);min-width: 1px;font-weight: bold;font-size: 14px;">2</p></section></section></section><section style="margin-left: 16px;display: inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">启动时间优化</p></section></section></section><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">分析启动时间之前，先看一下 App 启动的两种方式。</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">热启动：启动应用时，应用的进程和数据已经存在于系统内存中，系统只是将应用的状态从后台切换到前台。</span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">冷启动：启动应用时，应用不存在于系统内核的 buffer cache 中，比如应用首次启动或者重启设备之后的启动。</span></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">相比而言，冷启动比较重要，通常我们分析启动时间，都是指的冷启动。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">要想分析启动时间，还需要了解启动的过程，iOS应用的启动大概分以下几个阶段：</span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.905982905982906" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVWkWS5lX2wz0SXfciaBibW6uDYvT6gsyPsek8o8s2A01XWTKIMJyqzfIug/640?wx_fmt=png" data-type="png" data-w="468" style="width: 380px;height: 344px;"  /></p><p style="text-align: center;"><br  /></p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="text-align: left;"><span style="text-align: left;color: rgb(74, 74, 74);font-size: 14px;">针对&nbsp;</span><code class="prettyprint code-in-text prettyprinted" style="text-align: left;box-sizing: border-box;background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size: 16px;line-height: 18px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="pln" style="color: rgb(74, 74, 74);font-size: 14px;box-sizing: border-box;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;">pre-main()</span></code><span style="text-align: left;color: rgb(74, 74, 74);font-size: 14px;">&nbsp;：</span></p><p style="text-align: left;"><span style="text-align: left;color: rgb(74, 74, 74);font-size: 14px;"></span></p></li></ul><p style="text-align: left;"><span style="text-align: left;color: rgb(74, 74, 74);font-size: 14px;"></span></p><p style="text-align: left;"><span style="text-align: left;color: rgb(74, 74, 74);font-size: 14px;">整个&nbsp;</span><code class="prettyprint code-in-text prettyprinted" style="text-align: left;box-sizing: border-box;background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size: 16px;line-height: 18px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="pln" style="color: rgb(74, 74, 74);font-size: 14px;box-sizing: border-box;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;">pre-main()</span></code><span style="text-align: left;color: rgb(74, 74, 74);font-size: 14px;">&nbsp;阶段的耗时可以通过添加环境变量&nbsp;</span><code class="prettyprint code-in-text prettyprinted" style="text-align: left;box-sizing: border-box;background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size: 16px;line-height: 18px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="pln" style="color: rgb(74, 74, 74);font-size: 14px;box-sizing: border-box;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;">DYLD_PRINT_STATISTICS=1</span></code><span style="text-align: left;color: rgb(74, 74, 74);font-size: 14px;">&nbsp;来获取，如下图所示：</span><br  /></p><p style="text-align: left;"><span style="text-align: left;color: rgb(74, 74, 74);font-size: 14px;"><br  /></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5785536159600998" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVWMmCZx1sbUBicRT7EQy1ibv52UVOibBic9U0k30bwUT0cFBoZ0MwT1RXUEw/640?wx_fmt=png" data-type="png" data-w="1604" style=""  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3635334088335221" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVW3tPplSx9EqGxJkibd1nhuM375VUPosYrubKzI7FbiaspUcqkRuk8XRkA/640?wx_fmt=png" data-type="png" data-w="1766" style=""  /></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">这些阶段都是系统进行管控，具体在这些阶段内如何进行优化，可以参照 WWDC2013 Session（文章尾部附地址）中提供的方案进行，这里不详细说明。</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">针对&nbsp;<code class="prettyprint code-in-text prettyprinted" style="box-sizing: border-box;background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size: 16px;line-height: 18px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="pln" style="color: rgb(74, 74, 74);font-size: 14px;box-sizing: border-box;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;">post-main()</span></code>&nbsp;:</span></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">这部分主要是启动的框架初始化，首页数据获取，首页渲染等业务逻辑，这一部分我们只把必要的初始化操作保留，尽量把逻辑后置或者放在 background 线程执行。
这里的优化方案需要结合实际的业务场景和应用的架构来进行分析，采取对应的策略。</span></p><section class="RankEditor" data-indent="0" style="margin-right: 0em;margin-left: 0em;white-space: normal;border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box;"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="display: inline-block;width: 32px;height: 32px;border-radius: 32px;vertical-align: top;text-align: center;border-color: rgb(0, 162, 255);background-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table;width: 32px;border-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table-cell;vertical-align: middle;border-color: rgb(0, 162, 255);box-sizing: border-box;"><p class="count white" style="color: rgb(255, 255, 255);min-width: 1px;font-weight: bold;font-size: 14px;">3</p></section></section></section><section style="margin-left: 16px;display: inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">Background Fetch</p></section></section></section><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">除了这些通用的优化方案之外，我们也探索了一些创新的方式。
在介绍 Background Fetch 之前，我们先看这样一个案例：</span></p><blockquote style="box-sizing: border-box;margin-top: 1em;margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(220, 230, 240);font-size: 14px;line-height: 22px;background: rgb(242, 247, 251);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: normal;"><p style="box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><strong><span style="font-size: 14px;">操作：</span></strong></p><p style="box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><span style="font-size: 14px;">首先，启动支付宝，按 Home 键切入后台。然后，重新启动手机，进入桌面。放置 10-30 秒。</span></p><p style="box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><span style="font-size: 14px;"><strong>现象：</strong></span></p><p style="box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><span style="font-size: 14px;">此时，点击桌面的支付宝（以及淘宝等几乎所有 App）都与平时的冷启动一样，整个启动过程至少1秒以上。</span></p></blockquote><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">虽然对冷启动的时间已经进行了优化，但是能不能每次启动都做到“秒起”呢？（秒起定义为：启动时显示 LaunchScreen 约 500ms 后马上进入首页）
我们发现系统提供了这样一个 Background Fetch 特性，决定在这个上面做一些尝试。</span></p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><section class="RankEditor" data-indent="0" style="margin-right: 0em;margin-left: 0em;white-space: normal;border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box;"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="margin-left: 16px;display: inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">Background Fetch 简介</p></section></section></section></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">Background Fetch 类似一种智能的轮询机制，系统会根据用户的使用习惯进行适应，在用户真正启动应用之前，触发后台更新，来获取数据并且更新页面。</span></p><blockquote style="box-sizing: border-box;margin-top: 1em;margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(220, 230, 240);font-size: 14px;line-height: 22px;background: rgb(242, 247, 251);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: normal;"><p style="box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><strong><span style="font-size: 14px;">摘自苹果官方文档：</span></strong></p><p style="box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><span style="font-size: 14px;">Background Fetch lets your app run periodically in the background so that it can update its content. Apps that update their content frequently, such as news apps or social media apps, can use this feature to ensure that their content is always up to date. Downloading data in the background before it is needed minimizes the lag time in displaying that data when the user launches the app.</span></p></blockquote><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">Background Fetch 具有下面几个特性：</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">系统调度</span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">适应设备上各应用的实际使用模式</span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">对电量和数据的使用敏感</span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">与应用实际的运行状态无关</span></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">举个例子，比如用户习惯在下午1点使用某新闻类app，系统就会学习并且适应这个习惯，在用户使用之前，后台进行调度来启动应用并执行数据更新。下图比较清晰的说明了系统是如何学习用户的使用模式的。</span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5304428044280443" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVWWaLoyr6WbS0wTpSSgYR6bibQdO0ziaT6e53PLSibYwzNibwC11YvbibicWyg/640?wx_fmt=png" data-type="png" data-w="2168" style=""  /></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">针对这样的策略，大家可能会有疑虑，这种频繁的后台启动会不会增加耗电量？</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">当然不会，系统会根据设备的电量和数据使用情况来调用频率控制，避免在非活跃时间频繁的获取数据。而且，进程启动后后存活的时间很短，多数情况下会立即 suspend，对电量影响很少（相比压后台后很多 app 还要存活接近3分钟的情况很少）。</span></p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><section class="RankEditor" data-indent="0" style="margin-right: 0em;margin-left: 0em;white-space: normal;border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box;"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="margin-left: 16px;display: inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">Background Fetch 使用</p></section></section></section></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">按照官方资料，Background Fetch 的用法很简单，整体流程如下图所示。</span></p><p style="text-align: left;"><img class="" data-copyright="0" data-ratio="0.5819964349376114" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVWaylL6ux3CHSTH8AiaBfNtFgFjqAPeIlN7VWO4lmw0giamZhotVvoiaB1Q/640?wx_fmt=png" data-type="png" data-w="2244" style=""  /></p><p style="text-align: left;"><strong><span style="color: rgb(74, 74, 74);font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;1. </span></strong><span style="color: rgb(74, 74, 74);font-size: 14px;">Info.plist 中 UIBackgroundModes 节点配置 fetch 数值</span></p><p><strong><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;2. </span></strong><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">didFinishLaunching 时配置</span></p><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;"></span></p><pre class="prettyprint linenums prettyprinted" style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(0, 36, 81);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="linenums list-paddingleft-2" style="list-style-type: none;"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">[[</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIApplication</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> sharedApplication] setMinimumBackgroundFetchInterval:</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIApplicationBackgroundFetchIntervalMinimum</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">];</span></code></span></p></li></ol></pre><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">这一步配置的minimum interval，单位是秒，只是给系统的建议，系统并不会按照给定的时间间隔按规律的唤醒进程。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><strong><span style="font-size: 14px;"><span style="font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">&nbsp; &nbsp; 3.&nbsp;</span></span></strong><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;">实现下面的回调，并调用 completionHandler</span></p><pre class="prettyprint linenums prettyprinted" style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(0, 36, 81);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="linenums list-paddingleft-2" style="list-style-type: none;"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">- (</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">void</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">)application:(</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIApplication</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> *)application performFetchWithCompletionHandler:(</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">void</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> (^)(</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIBackgroundFetchResult</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">))completionHandler</span></code></span></p></li></ol></pre><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">由于 Background Fetch 机制是为了让App在后台拉取准备数据，但支付宝只是为了实现”秒起“。调用 completionHandler 后系统将把 App 进程挂起。且系统必须在30秒内调用 completionHandler，否则进程将被杀死。此外根据文档，系统会根据后台调用 completionHandler 的时间来决定后台唤起App的频率。因此，认为可以“伪造“1秒的延迟时间，即1秒后调用 completionHandler。类似下面的代码：</span></p><pre class="prettyprint linenums prettyprinted" style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(0, 36, 81);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="linenums list-paddingleft-2" style="list-style-type: none;"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">- (</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">void</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">)application:(</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIApplication</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> *)application performFetchWithCompletionHandler:(</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">void</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> (^)(</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIBackgroundFetchResult</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">))completionHandler{</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp;dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">int64_t</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">)(</span><span class="lit" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 197, 143);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">1</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp;completionHandler(</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIBackgroundFetchResultNewData</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">);</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp;});</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">}</span></code></span></p></li></ol></pre><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><section class="RankEditor" data-indent="0" style="margin-right: 0em;margin-left: 0em;white-space: normal;border-width: 0px;border-style: initial;border-color: initial;box-sizing: border-box;"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="margin-left: 16px;display: inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">Background Fetch 实践</p></section></section></section></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">苹果推出这种特性的动机在于，后台触发获取数据并更新页面，确保用户使用时看到的永远是最新的内容。然而，支付宝只是为了实现“秒起”，所以看似简单的实现，却隐藏着巨大的风险。
在测试过程中就发现了这些问题：</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><span style="color: rgb(68, 165, 227);"><strong><span style="font-size: 14px;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp;1、</span><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;">进程快速挂起导致 Sync 成功率下降</span></strong></span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">灰度期间，开发同学发现同步服务 Sync 成功率下降很多，找来找去发现原因：由于进程唤醒后，网络长连接线程被激活并马上建立长连接，而1秒后调用completionHandler，进程又被挂起。服务器端的sync消息则发送超时。</span></p><p><span style="color: rgb(68, 165, 227);"><strong><span style="box-sizing: border-box;line-height: 22px;font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;2、进程频繁挂起、唤醒导致网络建连次数增加</span></strong></span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">系统预测用户使用 App 的时间，并在用户实现 App 前唤醒 App，给予 App 后台准备数据的机会。再加上预测的准确性问题，这样进程被唤醒的次数远大于用户使用的次数。进程唤醒后，网络长连接会立即建立。因此导致网络建连次数大增，甚至翻倍。</span></p><p><span style="color: rgb(68, 165, 227);"><strong><span style="box-sizing: border-box;line-height: 22px;font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;3、由于进程挂起，导致定时器、延迟调用等时间“与预想的时间不同”</span></strong></span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">例如，一个间隔间隔时间为60秒的定时器，由于进程挂起时间超过60秒，则下次进程唤醒时会立刻触发到时。（延迟调用dispatch_after等类似）。对于进程自身来说，可能定时器有点不正常，需要排查所有的定时器逻辑，是否会因为挂起导致“业务层面的异常”。</span></p><p><span style="color: rgb(68, 165, 227);"><strong><span style="box-sizing: border-box;line-height: 22px;font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;4、获取时间戳</span></strong></span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">由于进程挂起，导致前后获取的时间戳间隔很大。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">为解决以上遇到的、以及预测到的问题，经过讨论，决定在 Background Fetch 后台唤醒的时候，不建立长连接。</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><strong><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">延后 10 秒调用 completionHandler</span></strong></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">后台唤醒存在两种情况：进程从无到有，进程从挂起到恢复。前者需要有充足的时间完成 App 的后台冷启动过程，因此定义了 10 秒的时间。</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><strong><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">后台 Background Fetch 的时间内不建立长连接</span></strong></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">”后台 Background Fetch 的时间“定义为：performFetchWithCompletionHandler 被回调并一直到 completionHandler 调用的时间内。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">我们维护了一个全局变量 underBackgroundFetch 用于标识这段时间。处于这段时间的所有网络请求都被阻塞，并增加重试判断。App 进入前台（willEnterForeground）时主动重新建立长连接。在一些其他后台需要建立长连接的情况下（例如 WatchApp 的连接、PUSH 快速回复），也主动修改标记，并通知网络层建立长连接。underBackgroundFetc 的修改是在主线程执行，但网络长连接的建立是在子线程，且进程被唤醒后早于 underBackgroundFetch 的修改。目前首次回调 performFetchWithCompletionHandler 时，仍然会存在这个“间隙”导致网络长连接建立，但后续的 Background Fetch 时状态是准确的。（这个间隙如何更加准确，必要性及方案在讨论中，目前还没有带来无法解决的问题）</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><strong><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">后台不建连导致的网络请求阻塞异常，避免产生 Toast 等弹窗</span></strong></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">为获取所有在后台 Background Fetch 时间内被拦截的 RPC，拦截操作增加了埋点。灰度期间收集出所有的 RPC，并逐个找到 Owner，让大家评估影响、以及避免产生 Toast 等弹窗提示。确保所有 RPC 异常的最外层异常捕获处，不因 RPC 拦截的异常而 Toast。</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><strong><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">超时判断</span></strong></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">由于进程挂起导致的定时器、延迟调用的超时判断，需要修改业务逻辑。不能过度依赖假想的时序，进程运行在操作系统上，不能受进程的挂起与恢复影响。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">虽然使用这么多的方案来保证应用的稳定性，但是实际上线也避免不了一些奇怪的问题：</span></p><p><span style="color: rgb(68, 165, 227);"><strong><span style="box-sizing: border-box;line-height: 22px;font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;1、completionHandler 调用两次</span></strong></span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">灰度期间发现少量用户存在 completionHandler 调用两次导致闪退。捞取用户日志发现 performFetchWithCompletionHandler 在1秒内连续被系统回调了两次。而 completionHandler 被存储为 AppDelegate 的成员变量，在10秒超时到期后，同一个 completionHandler 被调用了两次。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">为避免此问题，可以避免采用成员变量存储 completionHandler ，而采用 dispatch_after 来直接让 block 捕获 completionHandler，但这样又会带来另一个 libdispatch 中 block 为空的极小概率的闪退。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">因此采用成员变量存储 completionHandler，而在 performFetchWithCompletionHandler 的首行判断存储的 completionHandler 与传入的 completionHandler 是否相同。大致代码如下：</span></p><pre class="prettyprint linenums prettyprinted" style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(0, 36, 81);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="linenums list-paddingleft-2" style="list-style-type: none;"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">- (</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">void</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">)application:(</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIApplication</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> *)application performFetchWithCompletionHandler:(</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">void</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> (^)(</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIBackgroundFetchResult</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">))completionHandler</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">{</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp;</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">if</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">(_backgroundFetchCompletionHandler &amp;&amp; _backgroundFetchCompletionHandler != completionHandler){</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(114, 133, 183);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">// 避免performFetch被快速重复调用，如果completionHandler不同，则先完成上一个completionHandler；如果相同，则避免调用两次。</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp;[</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">self</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> callBackgroundFetchCompletionHandler]; </span><span class="com" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(114, 133, 183);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">// 内部调用completionHandler</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp;}</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp;_backgroundFetchCompletionHandler = completionHandler; </span><span class="com" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(114, 133, 183);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">// 复制给成员变量</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp;</span><span class="com" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(114, 133, 183);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">//...</span></code></span></p></li></ol></pre><p><span style="color: rgb(68, 165, 227);"><strong><span style="box-sizing: border-box;line-height: 22px;font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;2、iOS7 闪退</span></strong></span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">这个闪退 StackOverflow 上有人遇到，但点赞最多的答案实际上也没解决问题，( http://stackoverflow.com/questions/18974251/app-crashes-after-executing-background-fetch-completionhandler )。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">这个闪退仅在 iOS7 上产生，经过各方资料认为是 iOS7 系统的 bug。那么在 iOS7 设备上则不再启用 BackgroundFetch。</span></p><pre class="prettyprint linenums prettyprinted" style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(0, 36, 81);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="linenums list-paddingleft-2" style="list-style-type: none;"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">if</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> ios </span><span class="lit" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 197, 143);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">7</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> : </span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">[[</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIApplication</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> sharedApplication] setMinimumBackgroundFetchInterval:</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIApplicationBackgroundFetchIntervalNever</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">];</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">else</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> ...</span></code></span></p></li></ol></pre><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">Background Fetch 机制让 iOS App 也能做到“热启动”，但带来的进程挂起、唤醒次数大量增加，给已经稳定运行很久的代码带来一种”不稳定“的运行方式，必须要认真考虑每一个细节。</span></p><section class="RankEditor" style="white-space: normal;border-width: 0px;border-style: initial;border-color: initial;margin-left: 0em;margin-right: 0em;box-sizing: border-box;" data-indent="0"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="display: inline-block;width: 32px;height: 32px;border-radius: 32px;vertical-align: top;text-align: center;border-color: rgb(0, 162, 255);background-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table;width: 32px;border-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table-cell;vertical-align: middle;border-color: rgb(0, 162, 255);box-sizing: border-box;"><p class="count white" style="color: rgb(255, 255, 255);min-width: 1px;font-weight: bold;font-size: 14px;">4</p></section></section></section><section style="margin-left: 16px;display:inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">图片预加载</p></section></section></section><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><code class="prettyprint code-in-text prettyprinted" style="box-sizing: border-box;background: rgb(243, 241, 241);color: rgb(88, 88, 88);line-height: 18px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="font-size: 14px;box-sizing: border-box;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;">[UIImageimageNamed:@"xxx"]</span></code><span style="font-size: 14px;"> 是 iOS 中加载图片的 API，它的使用频率是比较高的，那么它的性能如何呢。我们在分析启动性能的过程中，发现这个方法的耗时很多，iPhone5S 下每个耗时都在 20ms 到 50ms 之间，首页加载过程中有10多张这种方式加载的图片。针对整个现象，在支付宝中，我们使用了一种图片预加载的方式来进行优化。</span></p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><section class="RankEditor" style="white-space: normal;border-width: 0px;border-style: initial;border-color: initial;margin-left: 0em;margin-right: 0em;box-sizing: border-box;" data-indent="0"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="margin-left: 16px;display:inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">设计思想</p></section></section></section></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">在看 </span><code class="prettyprint code-in-text prettyprinted" style="box-sizing: border-box;background: rgb(243, 241, 241);color: rgb(88, 88, 88);line-height: 18px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="font-size: 14px;box-sizing: border-box;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;">[UIImageimageNamed:]</span></code><span style="font-size: 14px;"> 文档时发现一句话</span></p><blockquote style="box-sizing: border-box;margin-top: 1em;margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(220, 230, 240);font-size: 14px;line-height: 22px;background: rgb(242, 247, 251);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: normal;"><p style="box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><span style="font-size: 14px;">In iOS 9 and later, this method is thread safe.</span></p></blockquote><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">看到它之后立刻想到，能否在进程启动早期通过子线程预先加载首页图片。为什么在早期呢？通过 Instruments 分析可看到在支付宝启动早期，CPU 占用是不那么满的，为了让启动过程中充分利用 CPU，就尽量在早期启动子线程。</span></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">首先通过 hook 方式，获取首页的所有 imageNamed 加载的图片，然后，大致代码如下：</span></p><pre class="prettyprint linenums prettyprinted" style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(0, 36, 81);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="linenums list-paddingleft-2" style="list-style-type: none;"><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">int</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> main(){</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp;</span><span class="lit" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 197, 143);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">@autoreleasepool</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">{</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(114, 133, 183);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">//if &gt;= iOS9</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp;dispatch_async(dispatch_get_global_queue(</span><span class="lit" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 197, 143);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">0</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">, </span><span class="lit" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 197, 143);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">0</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">), ^{</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">NSArray</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">&lt;</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">NSString</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">*&gt; *images = @[</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(114, 133, 183);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">// 10.0</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="str" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(209, 241, 169);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">"Launcher.bundle/TabBar_BG"</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">,</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="str" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(209, 241, 169);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">"Launcher.bundle/TabBar_HomeBar"</span><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">,</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(114, 133, 183);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">//.... 省略10多个图片</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ];</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">for</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> (</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">NSString</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> *name </span><span class="kwd" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(235, 187, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">in</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> images) {</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[</span><span class="typ" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(187, 218, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">UIImage</span><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> imageNamed:name];</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(114, 133, 183);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">// AppDelegate....</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pln" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;"> &nbsp; &nbsp;}</span></code></span></p></li><li><p><span style="box-sizing: border-box;color: rgb(74, 74, 74);display: block;line-height: 22px;font-size: 14px;word-break: inherit !important;"><code style="box-sizing: border-box;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size: 10px;font-family: inherit !important;white-space: pre !important;"><span class="pun" style="display: block;font-size: 14px;box-sizing: border-box;color: rgb(255, 255, 255);line-height: 20px;word-break: inherit !important;white-space: inherit !important;">}</span></code></span></p></li></ol></pre><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><section class="RankEditor" style="white-space: normal;border-width: 0px;border-style: initial;border-color: initial;margin-left: 0em;margin-right: 0em;box-sizing: border-box;" data-indent="0"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="margin-left: 16px;display:inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">问题与解决</p></section></section></section></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">在优化之后，也伴随而来一些不稳定的问题：</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><strong><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">App 启动会有小概率的 Crash</span></strong></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">根据分析，我们决定把这段代码移到 AppDelegate 的 didFinishLaunching 中，并且增加开关。</span></p><ul style="list-style-type: square;" class=" list-paddingleft-2"><li><p><strong><span style="box-sizing: border-box;color: rgb(74, 74, 74);line-height: 22px;font-size: 14px;">iPhone7 不需要预加载</span></strong></p></li></ul><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">在 iPhone7 设备出来后，我们发现 iPhone7 的启动性能反而不如 iPhone6S。分析后发现，在性能更好的 iPhone7 上，由于启动很快，导致子线程的 imageNamed 与 主线程的 imageNamed 相互穿插调用，而 imageNamed 内部的线程安全锁的粒度很小，导致锁的消耗过大。如下图：</span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.367612293144208" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVWhQjNyAZc1AicpfUqCKIpeyx6WUcjq1ygWYGvdicfzg0icBnsSJQj0xmPA/640?wx_fmt=jpeg" data-type="jpeg" data-w="846" style=""  /></p><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">因此，在性能更好的 iPhone7 上不再启用预加载。</span><br  /><span style="font-size: 14px;"></span></p><section class="RankEditor" style="white-space: normal;border-width: 0px;border-style: initial;border-color: initial;margin-left: 0em;margin-right: 0em;box-sizing: border-box;" data-indent="0"><section style="margin-top: 0.8em;margin-bottom: 0.5em;line-height: 32px;"><section style="display: inline-block;width: 32px;height: 32px;border-radius: 32px;vertical-align: top;text-align: center;border-color: rgb(0, 162, 255);background-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table;width: 32px;border-color: rgb(0, 162, 255);box-sizing: border-box;"><section style="display: table-cell;vertical-align: middle;border-color: rgb(0, 162, 255);box-sizing: border-box;"><p class="count white" style="color: rgb(255, 255, 255);min-width: 1px;font-weight: bold;font-size: 14px;">5</p></section></section></section><section style="margin-left: 16px;display:inline-block;"><p class="active title" style="color: rgb(0, 162, 255);min-width: 1px;font-weight: bold;font-size: 16px;">小结</p></section></section></section><p style="box-sizing: border-box;margin-top: 15px;margin-bottom: 15px;font-size: 16px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">通过 Background Fetch 和图片预加载这两种方式对启动性能进行优化，给我们提供了另外一种思路，对于优化不要仅限制在条框内，需要适当的创新。但是，对于这种有点“创新”的代码，一定要有“开关”，增强风险意识。当然，性能优化不是一蹴而就的，它是一个持续的课题，值得我们时刻来关注。</span><br  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size: 16px;box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">由于篇幅限制，很多技术要点我们无法一一展开。而相应的技术内核，我们同样应用在了 mPaaS 并对外输出，</span><span style="font-size: 14px;">欢迎大家上手体验：</span></p><p style="margin-top: 15px;margin-bottom: 15px;font-size: 16px;box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">https://tech.antfin.com/docs/2/49549</span></p><p style="margin-top: 15px;margin-bottom: 15px;font-size: 16px;box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">关于 iOS 端启动性能优化的设计思路和具体实践，同样期待你们的反馈，欢迎一起探讨交流。</span></p><p style="margin-top: 15px;margin-bottom: 15px;font-size: 16px;box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><br  /></p><p style="margin-top: 15px;margin-bottom: 15px;box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;">附注：<span style="color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;font-size: 14px;white-space: pre-line;">WWDC2013 Session</span></span></p><p style="margin-top: 15px;margin-bottom: 15px;box-sizing: border-box;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="font-size: 14px;"><span style="color: rgb(74, 74, 74);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;font-size: 14px;white-space: pre-line;">https://developer.apple.com/videos/play/wwdc2013/204/</span></span></p><section class="RankEditor" style="margin: 1em auto;white-space: normal;border-width: 0px;border-style: none;border-color: initial;text-align: center;width: 558px;box-sizing: border-box;"><span class="color" style="width: 558px;border-bottom: 1px solid rgb(0, 162, 255);display: inline-block;"><section class="active" style="margin-bottom: -3px;padding-top: 5px;padding-right: 10px;padding-left: 10px;min-height: 32px;display: inline-block;border-bottom: 5px solid rgb(0, 162, 255);font-size: 20px;color: rgb(0, 162, 255);box-sizing: border-box;"><p class="brush" style="min-width: 1em;"><strong><span style="font-size: 16px;">往期阅读</span></strong></p></section></span></section><p style="white-space: normal;"><br  /></p><ul class=" list-paddingleft-2" style=""><li><p><span style="font-size: 14px;">《</span><a href="http://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&amp;mid=2247483672&amp;idx=1&amp;sn=249447e402bd41e455f3990d210d9c03&amp;chksm=f9e315bcce949caa64a48aeef0489e2c60809e8ddf600f098e04697d9e712beb4083ecf51738&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 14px;">开篇 | 模块化与解耦式开发在蚂蚁金服 mPaaS 深度实践探讨</a><span style="font-size: 14px;">》</span></p></li><li><p><span style="font-size: 14px;">《</span><a href="http://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&amp;mid=2247483778&amp;idx=1&amp;sn=f92263372e3c1705be8556ab30fdd649&amp;chksm=f9e31526ce949c30a47d26d046addf4f12337463e8da215497a4c1464bd11e17d06b98698c86&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 14px;">支付宝客户端架构解析：iOS 容器化框架初探</a><span style="font-size: 14px;">》</span><br  /></p></li><li><p><span style="font-size: 14px;">《</span><a href="http://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&amp;mid=2247483765&amp;idx=1&amp;sn=563f6ed65a408c63fcdc4ac7b35d77e4&amp;chksm=f9e315d1ce949cc7bc9df9d5e70519482b8acefe07cb20d63b2fcb52eb21d2c162af0d49a805&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 14px;">支付宝客户端架构解析：Android 容器化框架初探</a><span style="font-size: 14px;">》</span></p></li><li><p><span style="font-size: 14px;">《</span><a href="http://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&amp;mid=2247483789&amp;idx=1&amp;sn=f3843b9ce282ab7d4e3c6225d780f9cd&amp;chksm=f9e31529ce949c3f8c5d1ef7b96a3c09d358fec8c3d891c6640129152dbb3529b338f81b901f&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 14px;">支付宝客户端架构解析：Android 客户端启动速度优化之「垃圾回收」</a><span style="font-size: 14px;">》</span></p></li></ul><p style="white-space: normal;"><span style="font-size: 14px;"><br  /></span></p><section class="RankEditor" style="margin-top: 20px;white-space: normal;border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;"><section style="padding-bottom: 27.8906px;text-align: center;box-sizing: border-box;"><section style="margin-left: 223.188px;width: 15px;height: 15px;border-radius: 100%;opacity: 0.5;background: rgb(0, 162, 255);box-sizing: border-box;"></section><section style="margin-top: -15px;margin-left: 379.438px;width: 60px;height: 60px;border-radius: 100%;background: rgb(0, 162, 255);box-sizing: border-box;"></section><section style="margin-top: -36px;width: 150px;height: 150px;display: inline-block;"><img class="" data-copyright="0" data-cropselx1="0" data-cropselx2="150" data-cropsely1="0" data-cropsely2="150" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Ly9fQtHVgNlmVnP0azZdbxeSN5tUHbOnvibMNynYoK4CCAQX9ROV4OhG8vz1QA36JQJH5IOBLEs1eFiaia7dEv7dg/640?wx_fmt=jpeg" data-type="jpeg" data-w="258" style="height: 150px;width: 150px;vertical-align: middle;"  /></section><section style="margin-top: -60px;margin-left: 94.8594px;width: 50px;height: 50px;border-radius: 100%;background: rgb(0, 162, 255);box-sizing: border-box;"></section><section style="margin-top: -125px;margin-right: 66.9531px;width: 30px;height: 30px;border-radius: 100%;opacity: 0.5;background: rgb(0, 162, 255);float: right;box-sizing: border-box;"></section></section><section style="text-align: center;"><p class="brush active" style="font-size: 18px;color: rgb(0, 162, 255);min-width: 1px;"><strong><span style="font-size: 15px;">长按识别二维码关注我们！</span></strong></p><p><br  /></p></section></section><p style="white-space: normal;width: 1px;height: 1px;overflow: hidden;left: -1000px;top: 4007px;"><span style="font-size: 14px;">7z a -tzip archive.z</span></p>
                </div>
                <script nonce="1019499655" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx435ee6.css";
                            head.appendChild(link);
                        }
                    })();
                </script>

                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name">石扉</div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p>
                        <a class="reward_button" id='js_preview_reward_author_link' href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                                
                
                            </div>
                                    
                        


                        
            <ul id="js_hotspot_area" class="article_extend_area"></ul>


            

            


<div class="rich_media_tool" id="js_toobar3">

        <div id="js_read_area3" class="media_tool_meta tips_global_primary meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

    <span style="display:none;" class="media_tool_meta meta_extra meta_praise" id="like_old">
        <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum_old"></span>
    </span>

    <span style="display:none;" class="media_tool_meta meta_extra meta_like" id="like3">
        <button class="like_btn" id="js_like_btn"> 
          <span id="js_like_wording"> 在看</span><span class="like_num" id="likeNum3"></span>
        </button>
    </span>

    <div id="js_like_educate" style="display:none">
        <div class="weui-mask"></div>
        <div class="weui-dialog weui-dialog_haokan">
        <div class="weui-dialog__hd"><strong class="weui-dialog__title" id="educate_title">已同步到看一看</strong></div>
        <div class="weui-dialog__bd">
          <img class="pic_haokan" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_haokan42f400.png">
            你的朋友会在“发现-看一看”看到你点击“在看”的内容        </div>
        <div class="weui-dialog__ft" id="educate_btn" style="display: none">
          <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default" id="js_cancel">取消</a>
          <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="js_confirm">发送</a>
        </div>
        <div class="weui-dialog__ft" id="educate_btn2" style="display: none">
          <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="js_acknowledge">我知道了</a>
        </div>
        </div>
    </div>

    <div id="js_unlike_educate" style="display:none">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
        
        <div class="weui-dialog__bd">
            已取消，想法已同步删除        </div>
        <div class="weui-dialog__ft">
          <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="js_unlike_know">知道了</a>
        </div>
        </div>
    </div>

    
    </div>


<div class="like_comment_wrp" id="js_a_like_comment" style="display: none;">
  <div class="like_comment_inner">
    <div class="like_comment_hd" style="display:none" id="js_like_title"></div>
    <div class="like_comment_bd">
      <div class="tips_global_primary like_comment_tips">
        <i class="weui-icon-success"></i>已同步到看一看<a href="javascript:;" class="like_comment_share_link" id="js_a_like_comment_share">写下你的想法</a>
      </div>
    </div>
    <div class="like_comment_ft">
      <span id="js_a_like_comment_msg" class="like_comment_msg" style="visibility:hidden">最多200字，当前共<span id="js_a_like_current_cnt"></span>字</span>
      <button class="like_comment_btn" disabled="disabled" id="js_a_like_confirm">发送</button>
    </div>
  </div>
</div>

<div id="js_like_toast" style="display: none;">
  <div class="weui-mask_transparent"></div>
  <div class="weui-toast">
    <i class="weui-icon-success-no-circle weui-icon_toast"></i>
    <p class="weui-toast__content" id="js_toast_msg">已发送</p>
  </div>
</div>


<div style="display: none;" id="js_b_comment_panel" class="like_comment_primary_pop">
  <div class="like_comment_primary_wrp" id="js_b_wrp">
    <div class="like_comment_primary_inner">
      <div class="like_comment_primary_hd">
        <h4 class="like_comment_primary_title">
          朋友将在看一看看到        </h4>
        <button id="js_b_like_confirm" class="like_comment_primary_btn">确定</button>
      </div>
      <div id='js_b_comment_text_first' class="like_comment_primary_bd">
        <span class="tips_global_primary">
          写下你的想法...        </span>
      </div>
    </div>
  </div>
  <div class="like_comment_primary_mask" id="js_mask_1"></div>
</div>

<div style="display: none;" id="js_b_comment_final">
  <div class="like_comment_primary_wrp editing" id="js_comment_wrp">
    <div class="like_comment_primary_inner">
      <div class="like_comment_primary_hd">
        <button class="like_comment_primary_cancel" id="js_b_comment_cancel">取消</button>
        <h4 class="like_comment_primary_title"> 发布到看一看 </h4>
        <button class="like_comment_primary_btn" id="js_b_comment_confirm">确定</button>
      </div>
      <div class="like_comment_primary_bd">
        <textarea class="like_comment_textarea weui-textarea" placeholder="写下你的想法..." id="js_b_comment_text_second"></textarea>
      </div>
      <span class="like_comment_msg" id="js_b_like_comment_msg" style="visibility: hidden;">最多200字，当前共<span id="js_b_like_current_cnt"></span>字</span>
    </div>
  </div>
  <div class="like_comment_primary_mask" id="js_mask_2"></div>
</div>

<div id="js_loading" style=" display: none;">
    <div class="weui-mask_transparent"></div>
    <div class="weui-toast">
        <i class="weui-loading weui-icon_toast"></i>
        <p class="weui-toast__content">发送中</p>
    </div>
</div>

<div id="js_fail" style="display:none">
    <div class="weui-mask"></div>
    <div class="weui-dialog">
    <div class="weui-dialog__bd">
        网络异常，请稍后重试    </div>
    <div class="weui-dialog__ft">
      <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="js_fail_inform">知道了</a>
    </div>
    </div>
</div>



                      </div>
        </div>

        <div class="rich_media_area_primary sougou" id="sg_tj" style="display:none"></div>


        
        <div class="rich_media_area_extra">
          <div class="rich_media_area_extra_inner">
              
              <div id="js_share_appmsg">
              </div>

              
                            <div class="mpda_bottom_container" id="js_bottom_ad_area"></div>
                            
              <div id="js_iframetest" style="display:none;"></div>
                            
              <div class="rich_media_extra rich_media_extra_discuss" id="js_cmt_container" style="display:none">
                

                
                <div class="discuss_mod" id="js_friend_cmt_area" style="display:none">
                  
                  
                  
                </div>

                                <div class="discuss_mod" id="js_preview_cmt" style="display:none">
                  <div class="discuss_container">
                    <div class="mod_title_context">
                        <p class="discuss_icon_tips tc">
                            <a href="javascript:;" id="js_preview_cmt_write">留言</a>
                        </p>
                    </div>
                  </div>
                </div>
                              </div>
          </div>
        </div>

        
        <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
            <div class="qr_code_pc_inner">
                <div class="qr_code_pc">
                    <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                    <p>微信扫一扫<br>关注该公众号</p>
                </div>
            </div>
        </div>
    </div>
</div>



<div id="js_pc_weapp_code" class="weui-desktop-popover weui-desktop-popover_pos-up-center weui-desktop-popover_img-text" style="display: none;">
    <div class="weui-desktop-popover__content">
        <div class="weui-desktop-popover__desc">
            <img id="js_pc_weapp_code_img">
            微信扫一扫<br>使用小程序<span id="js_pc_weapp_code_des"></span>        </div>
    </div>
</div>
<div id="js_minipro_dialog" style="display:none;">
    <div class="weui-mask"></div>
    <div class="weui-dialog">
        <div class="weui-dialog__bd">即将打开"<span id="js_minipro_dialog_name"></span>"小程序</div>
        <div class="weui-dialog__ft">
            <a id="js_minipro_dialog_cancel" href="javascript:void(0);" class="weui-dialog__btn weui-dialog__btn_default">取消</a>
            <a id="js_minipro_dialog_ok" href="javascript:void(0);" class="weui-dialog__btn weui-dialog__btn_primary">打开</a>
        </div>
    </div>
</div>

        
        <script nonce="1019499655">
    var __DEBUGINFO = {
        debug_js : "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/debug/console42f400.js",
        safe_js : "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/safe/moonsafe42f400.js",
        res_list: []
    };
</script>

<script nonce="1019499655" type="text/javascript">
(function() {
	var totalCount = 0,
			finishCount = 0;

	function _loadVConsolePlugin() {
		window.vConsole = new window.VConsole();
		while (window.vConsolePlugins.length > 0) {
			var p = window.vConsolePlugins.shift();
			window.vConsole.addPlugin(p);
		}
	}
	
	function _addVConsole(uri, cb) {
		totalCount++;
		var node = document.createElement('SCRIPT');
		node.type = 'text/javascript';
		node.src = uri;
		node.setAttribute('nonce', '1019499655');
		if (cb) {
			node.onload = cb;
		}
		document.getElementsByTagName('head')[0].appendChild(node);
	}
	if (
		(document.cookie && document.cookie.indexOf('vconsole_open=1') > -1)
		|| location.href.indexOf('vconsole=1') > -1
	) {
		window.vConsolePlugins = [];
		_addVConsole('//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/vconsole/3.2.2/vconsole.min440203.js', function() {
			
			_addVConsole('//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/vconsole/plugin/vconsole-mpopt/1.0.1/vconsole-mpopt42f400.js', _loadVConsolePlugin);
		});
	}
})();
</script>
        
<script nonce="1019499655" type="text/javascript">
if (location.href.match(/fontScale=\d+/) && /(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {

    var m=location.href.match(/fontScale=(\d*)/);
    var map={
        "94":1,
        "100":2,
        "109":3,
        "119":4,
        "131":5,
    }
    if(m&&m[1]&&map[m[1]]){
        document.getElementsByTagName("body")[0].className+=" appmsg_skin_fontscale_"+map[m[1]];
        console.log("appmsg_skin_fontscale_:"+map[m[1]]);
    }
}


(function(){
    if (window.__second_open__) return; 

    

    var first_js_time = +new Date();

    var showDate="";
    var svrDate=new Date("1554224597"*1000);
    var createDate=new Date("1542335156"*1000);
    var ct="1542335156"*1;
    var publish_time = "2018-11-16" || "";
    var cD={
      year:createDate.getYear(),
      month:createDate.getMonth()+1,
      date:createDate.getDate()
    };
    
    svrDate.setHours(0);
    svrDate.setMinutes(0);
    svrDate.setSeconds(0);
    var todayDate=svrDate.getTime()/1000;
    svrDate.setDate(1);
    svrDate.setMonth(0);
    var yearDate=svrDate.getTime()/1000;
    
    if(ct>=todayDate){
      showDate="今天";
    
    }else if(ct>=todayDate-60*60*24){
       showDate="昨天";
    
    }else if(ct>=todayDate-2*60*60*24){
      showDate="前天";
    }else if(ct>=todayDate-3*60*60*24){
      showDate="3天前";
    }else if(ct>=todayDate-4*60*60*24){
      showDate="4天前";
    }else if(ct>=todayDate-5*60*60*24){
      showDate="5天前";
    }else if(ct>=todayDate-6*60*60*24){
      showDate="6天前";
    }else if(ct>=todayDate-2*7*60*60*24){
      showDate="1周前";
    }else if(ct>=yearDate){
      
      
      
      showDate="%s月%s日".replace("%s",cD.month).replace("%s",cD.date);
    }else{
      showDate=publish_time;
    };
    if(document.getElementById("publish_time")){
      document.getElementById("publish_time").innerText=showDate;
    }
})();
</script>
<script nonce="1019499655" type="text/javascript">

if (!window.console) window.console = { log: function() {} };

if (typeof getComputedStyle == 'undefined') {
    if (document.body.currentStyle) {
        window.getComputedStyle = function(el) {
            return el.currentStyle;
        }
    } else {
        window.getComputedStyle = {};
    }
}
(function(){
    window.__zoom = 1;
    
    (function(){
        var validArr = ","+([0.875, 1, 1.125, 1.25, 1.375]).join(",")+",";
        var match = window.location.href.match(/winzoom=(\d+(?:\.\d+)?)/);
        if (match && match[1]) {
            var winzoom = parseFloat(match[1]);
            if (validArr.indexOf(","+winzoom+",")>=0) {
                window.__zoom = winzoom;
            }
        }
    })();

    var ua = navigator.userAgent.toLowerCase();
    var re = new RegExp("msie ([0-9]+[\.0-9]*)");
    var version;
    if (re.exec(ua) != null) {
        version = parseInt(RegExp.$1);
    }
    var isIE = false;
    if (typeof version != 'undefined' && version >= 6 && version <= 9) {
        isIE = true;
    }
    var getMaxWith=function(){
        var container = document.getElementById('img-content');
        var max_width = container.offsetWidth;
        var container_padding = 0;
        var container_style = getComputedStyle(container);
        container_padding = parseFloat(container_style.paddingLeft) + parseFloat(container_style.paddingRight);
        max_width -= container_padding;
        if (!max_width) {
            max_width = window.innerWidth - 30;      
        }
        return max_width;
    };
    var getParentWidth = function(dom){
        var parent_width = 0;
        var parent = dom.parentNode;
        var outerWidth = 0;
        while (true) {
            if(!parent||parent.nodeType!=1) break;
            var parent_style = getComputedStyle(parent);
            if (!parent_style) break;
            parent_width = parent.clientWidth - parseFloat(parent_style.paddingLeft) - parseFloat(parent_style.paddingRight) - outerWidth;
            if (parent_width > 0) break;
            outerWidth += parseFloat(parent_style.paddingLeft) + parseFloat(parent_style.paddingRight) + parseFloat(parent_style.marginLeft) + parseFloat(parent_style.marginRight) + parseFloat(parent_style.borderLeftWidth) + parseFloat(parent_style.borderRightWidth);
            parent = parent.parentNode;
        }
        return parent_width;
    }
    var getOuterW=function(dom){
        var style=getComputedStyle(dom),
            w=0;
        if(!!style){
            w = parseFloat(style.paddingLeft) + parseFloat(style.paddingRight) + parseFloat(style.borderLeftWidth) + parseFloat(style.borderRightWidth);
        }
        return w;
    };
    var getOuterH =function(dom){
        var style=getComputedStyle(dom),
            h=0;
        if(!!style){
            h = parseFloat(style.paddingTop) + parseFloat(style.paddingBottom) + parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);
        }
        return h;
    };
    var insertAfter = function(dom,afterDom){
        var _p = afterDom.parentNode;
        if(!_p){
            return;
        }
        if(_p.lastChild === afterDom){
            _p.appendChild(dom);
        }else{
            _p.insertBefore(dom,afterDom.nextSibling);
        }
    };
    var getQuery = function(name,url){
        
        var u  = arguments[1] || window.location.search,
            reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)"),
            r = u.substr(u.indexOf("\?")+1).match(reg);
        return r!=null?r[2]:"";
    };

    
    function setImgSize(item, widthNum, widthUnit, ratio, breakParentWidth) {
        setTimeout(function () {
            var img_padding_border = getOuterW(item) || 0;
            var img_padding_border_top_bottom = getOuterH(item) || 0;
            
            if (widthNum > getParentWidth(item) && !breakParentWidth) {
                widthNum = getParentWidth(item);
            }

            height = (widthNum - img_padding_border) * ratio + img_padding_border_top_bottom;

            if (isIE) {
                var url = item.getAttribute('data-src');
                item.src = url;
            } else {
                if(parseFloat(widthNum, 10) > 40 && height > 40 && breakParentWidth) {
                    item.className += ' img_loading';
                }
                item.src = "data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==";
            }
            item.style.cssText += ";width: " + widthNum + widthUnit + " !important;";
            item.style.cssText += ";height: " + height + widthUnit + " !important;";
        }, 10);
    }

    (function(){
        var images = document.getElementsByTagName('img');
        var length = images.length;
        var max_width = getMaxWith();
        for (var i = 0; i < length; ++i) {
            if (window.__second_open__ && images[i].getAttribute('__sec_open_place_holder__')) {
                continue;
            }
            var imageItem = images[i];
            var src_ = imageItem.getAttribute('data-src');
            var realSrc = imageItem.getAttribute('src');
            if (!src_ || realSrc) continue;
            
            var originWidth = imageItem.getAttribute('data-w');
            var ratio_ = 1 * imageItem.getAttribute('data-ratio');

            var height = 100;
            if (ratio_ && ratio_ > 0) {
                var parent_width = getParentWidth(imageItem) || max_width;
                var initWidth = imageItem.style.width || imageItem.getAttribute('width') || originWidth || parent_width;
                initWidth = parseFloat(initWidth, 10) > max_width ? max_width : initWidth;
                
                if (initWidth) {
                    imageItem.setAttribute('_width', !isNaN(initWidth * 1) ? initWidth + 'px' : initWidth);
                }
                
                if (typeof initWidth === 'string' && initWidth.indexOf('%') !== -1) {
                    initWidth = parseFloat(initWidth.replace('%', ''), 10) / 100 * parent_width;
                }
                
                if (initWidth === 'auto') {
                    initWidth = originWidth;
                }

                var res = /^(\d+(?:\.\d+)?)([a-zA-Z%]+)?$/.exec(initWidth);
                var widthNum = res && res.length >= 2 ? res[1] : 0;
                var widthUnit = res && res.length >= 3 && res[2] ? res[2] : 'px';

                
                setImgSize(imageItem, widthNum, widthUnit, ratio_, true);
                
                (function (item, widthNumber, unit, ratio) {
                    setTimeout(function () {
                        setImgSize(item, widthNumber, unit, ratio, false);
                    });
                })(imageItem, widthNum, widthUnit, ratio_);
            } else {
                imageItem.style.cssText += ";visibility: hidden !important;";
            }

        }
    })();
    window.__videoDefaultRatio=16/9;
    window.__getVideoWh = function(dom){
        var max_width = getMaxWith(),
            width = max_width,
            ratio_ = dom.getAttribute('data-ratio')*1,
            arr = [4/3, 16/9],
            ret = arr[0],
            abs = Math.abs(ret - ratio_);
        if (!ratio_) { 
            if (dom.getAttribute("data-mpvid")) { 
                ratio_ = 16/9;
            } else { 
                ratio_ = 4/3;
            }
        } else { 
            for (var j = 1, jl = arr.length; j < jl; j++) {
                var _abs = Math.abs(arr[j] - ratio_);
                if (_abs < abs) {
                    abs = _abs;
                    ret = arr[j];
                }
            }
            ratio_ = ret;
        }

        var parent_width = getParentWidth(dom)||max_width,
            width = width > parent_width ? parent_width : width,
            outerW = getOuterW(dom)||0,
            outerH = getOuterH(dom)||0,
            videoW = width - outerW,
            videoH = videoW/ratio_,
            height = videoH + outerH;
        return {w:Math.ceil(width),h:Math.ceil(height),vh:videoH,vw:videoW,ratio:ratio_};
    };


    (function(){
        var iframe = document.getElementsByTagName('iframe');
        for (var i=0,il=iframe.length;i<il;i++) {
            if (window.__second_open__ && iframe[i].getAttribute('__sec_open_place_holder__')) {
                continue;
            }
            var a = iframe[i];
            var src_ = a.getAttribute('src')||a.getAttribute('data-src')||"";
            if(!/^http(s)*\:\/\/v\.qq\.com\/iframe\/(preview|player)\.html\?/.test(src_)
                && !/^http(s)*\:\/\/mp\.weixin\.qq\.com\/mp\/readtemplate\?t=pages\/video_player_tmpl/.test(src_)
            ){
                continue;
            }
            var vid = getQuery("vid",src_);
            if(!vid){
                continue;
            }
            vid=vid.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");
            a.removeAttribute('src');
            a.style.display = "none";
            var obj = window.__getVideoWh(a),
                videoPlaceHolderSpan = document.createElement('span'),
                videoPlayerIconSpan = document.createElement('span'),
                mydiv = document.createElement('img');

            videoPlaceHolderSpan.className = "js_img_loading db";
            videoPlaceHolderSpan.setAttribute("data-vid", vid);
            

            videoPlayerIconSpan.className = 'wx_video_context db'; 
            videoPlayerIconSpan.style.display = 'none';
            videoPlayerIconSpan.innerHTML = '<span class="wx_video_thumb_primary"></span><button class="wx_video_play_btn">播放</button><span class="wx_video_mask"></span>'; 

            mydiv.className = "img_loading";

            mydiv.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==";
            
            
            videoPlaceHolderSpan.style.cssText = "width: " + obj.w + "px !important;";
            mydiv.style.cssText += ";width: " + obj.w + "px";
            videoPlaceHolderSpan.appendChild(videoPlayerIconSpan);
            videoPlaceHolderSpan.appendChild(mydiv);
            insertAfter(videoPlaceHolderSpan, a); 

            a.style.cssText += ";width: " + obj.w + "px !important;";
            a.setAttribute("width",obj.w);
            if(window.__zoom!=1){
                a.style.display = "block";
                videoPlaceHolderSpan.style.display = "none";
                a.setAttribute("_ratio",obj.ratio);
                a.setAttribute("_vid",vid);
            }else{
                videoPlaceHolderSpan.style.cssText += "height: " + obj.h + "px !important;";
                mydiv.style.cssText += "height: " + obj.h + "px !important;";
                a.style.cssText += "height: " + obj.h + "px !important;";
                a.setAttribute("height",obj.h);
            }
            a.setAttribute("data-vh",obj.vh);
            a.setAttribute("data-vw",obj.vw);
            if(a.getAttribute("data-mpvid")){
                a.setAttribute("data-src",location.protocol+"//mp.weixin.qq.com/mp/readtemplate?t=pages/video_player_tmpl&auto=0&vid="+vid);
            }else{
                a.setAttribute("data-src",location.protocol+"//v.qq.com/iframe/player.html?vid="+ vid + "&width="+obj.vw+"&height="+obj.vh+"&auto=0");
            }
        }
    })();

    (function(){
        if(window.__zoom!=1){
            if (!window.__second_open__) {
                document.getElementById('page-content').style.zoom = window.__zoom;
                var a = document.getElementById('activity-name');
                var b = document.getElementById('meta_content');
                if(!!a){
                    a.style.zoom = 1/window.__zoom;
                }
                if(!!b){
                    b.style.zoom = 1/window.__zoom;
                }
            }
            var images = document.getElementsByTagName('img');
            for (var i = 0,il=images.length;i<il;i++) {
                if (window.__second_open__ && images[i].getAttribute('__sec_open_place_holder__')) {
                    continue;
                }
                images[i].style.zoom = 1/window.__zoom;
            }
            var iframe = document.getElementsByTagName('iframe');
            for (var i = 0,il=iframe.length;i<il;i++) {
                if (window.__second_open__ && iframe[i].getAttribute('__sec_open_place_holder__')) {
                    continue;
                }
                var a = iframe[i];
                a.style.zoom = 1/window.__zoom;
                var src_ = a.getAttribute('data-src')||"";
                if(!/http(s)*\:\/\/v\.qq\.com\/iframe\/(preview|player)\.html\?/.test(src_)){
                    continue;
                }
                var ratio = a.getAttribute("_ratio");
                var vid = a.getAttribute("_vid");
                a.removeAttribute("_ratio");
                a.removeAttribute("_vid");
                var vw = a.offsetWidth - (getOuterW(a)||0);
                var vh = vw/ratio;
                var h = vh + (getOuterH(a)||0)
                a.style.cssText += "height: " + h + "px !important;"
                a.setAttribute("height",h);
                a.setAttribute("data-src",location.protocol+"//v.qq.com/iframe/player.html?vid="+ vid + "&width="+vw+"&height="+vh+"&auto=0");
                a.style.display = "none";
                var parent = a.parentNode;
                if(!parent){
                    continue;
                }
                for(var j=0,jl=parent.children.length;j<jl;j++){
                    var child = parent.children[j];
                    if(child.className.indexOf("img_loading")>=0 && child.getAttribute("data-vid")==vid){
                        child.style.cssText += "height: " + h + "px !important;";
                        child.style.display = "";
                    }
                }
            }
        }
    })();
})();
</script>
<script nonce="1019499655" type="text/javascript">
    var new_appmsg = 1;
    var item_show_type = "0";
    var can_see_complaint = "0";
    var not_in_mm_css = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/not_in_mm435ee6.css";
    var windowwx_css = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx435ee6.css";
    var article_improve_combo_css = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/combo44c130.css";
    var tid = "";
    var aid = "";
    var clientversion = "";
    var appuin = ""||"MzUyMDk2MzUzMQ==";

    var source = "";
    var ascene = "";
    var subscene = "";
    var sessionid = ""||"svr_c9c1410b91f";
    var abtest_cookie = "";

    var scene = 75;

    var itemidx = "";
    var appmsg_token   = "";
    var _copyright_stat = "1";
    var _ori_article_type = "科技互联网";

    var is_follow = "";
    var nickname = "mPaaS";
    var appmsg_type = "9";
    var ct = "1542335156";
    var publish_time = "2018-11-16" || "";
    var user_name = "gh_e7c89aa791f0";
    var user_name_new = "";
    var fakeid   = "";
    var version   = "";
    var is_limit_user   = "0";
    var round_head_img = "http://mmbiz.qpic.cn/mmbiz_png/Ly9fQtHVgNmOcHJqN5k9woPac0g41QjQ6XI4RibYfsCasrCljou4GY4XUYxeEvicpHhO2wbgE6PFkonaKibCicYZPQ/0?wx_fmt=png";
    var hd_head_img = "http://wx.qlogo.cn/mmhead/Q3auHgzwzM6BicS67ZnaOTVPia3XEq2mUznoiapw578aH1M5stWxYnTDw/0"||"";
    var ori_head_img_url = "http://wx.qlogo.cn/mmhead/Q3auHgzwzM6BicS67ZnaOTVPia3XEq2mUznoiapw578aH1M5stWxYnTDw/132";
    var msg_title = "支付宝客户端架构解析：iOS 客户端启动性能优化初探";
    var msg_desc = "支付宝客户端作为一个超级 App，启动性能当然是我们关注的重要指标之一，本文将从三个方面拆解支付宝在 iOS 端启动性能的优化设计。";
    var msg_cdn_url = "http://mmbiz.qpic.cn/mmbiz_jpg/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVWCabe30HMcqC7p3gTcKdSfn4UqK8WKaTkZpoHcB5hrw8p7sUK1ia6tEg/0?wx_fmt=jpeg"; 
    var cdn_url_1_1  = "https://mmbiz.qlogo.cn/mmbiz_jpg/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVWXicAloIOM9H3cdJFNUg85DhicZUl39WiaxrMm6xoiayjaYetQMJCYLWhVg/0?wx_fmt=jpeg"; 
    var cdn_url_235_1 = "https://mmbiz.qlogo.cn/mmbiz_jpg/Ly9fQtHVgNlkzzEJ0pGkzUAvkmYqpWVWCabe30HMcqC7p3gTcKdSfn4UqK8WKaTkZpoHcB5hrw8p7sUK1ia6tEg/0?wx_fmt=jpeg"; 
    
    var msg_link = "http://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&amp;mid=2247483834&amp;idx=1&amp;sn=941ef69ac5f9813a2e5bfdfa6209fb9f&amp;chksm=f9e3151ece949c083ce4c22c72a125809aaf6e94f002f1dc30c9eb1503530adfd9c36212a11e#rd"; 
    var user_uin = "0"*1;
    var msg_source_url = '';
    var img_format = 'jpeg';
    var srcid = '';
    var req_id = '0301x3jYKvjEDG8cuelVs1mN';
    var networkType;
    var appmsgid = '' || ''|| "2247483834";
    var comment_id = "0" || "0" * 1;
    var comment_enabled = "" * 1;
    var is_need_reward = "0" * 1;
    var is_https_res = ("" * 1) && (location.protocol == "https:");
    var msg_daily_idx = "1" || "";
    var profileReportInfo = "" || "";

    var devicetype = "";
    var source_encode_biz = "";
    var source_username = "";
    
    var reprint_ticket = "";
    var source_mid = "";
    var source_idx = "";
    var source_biz = "";
    var author_id = "";

    
    var optimizing_flag = "0" * 1;
    var ad_abtest_padding = "0" * 1;

    var show_comment = "";
    var __appmsgCgiData = {
        wxa_product : ""*1,
        wxa_cps : ""*1,
        show_msg_voice: "0"*1,
        can_use_page : "0"*1,
        is_wxg_stuff_uin : "0"*1,
        card_pos : "",
        copyright_stat : "1",
        source_biz : "",
        hd_head_img : "http://wx.qlogo.cn/mmhead/Q3auHgzwzM6BicS67ZnaOTVPia3XEq2mUznoiapw578aH1M5stWxYnTDw/0"||(window.location.protocol+"//"+window.location.host + "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_rumor_link.2x42f400.jpg")
    };
    var _empty_v = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/pages/voice/empty42f400.mp3";

    var copyright_stat = "1" * 1;

    var pay_fee = "" * 1;
    var pay_timestamp = "";
    var need_pay = "" * 1;

    var need_report_cost = "0" * 1;
    var use_tx_video_player = "0" * 1;
    var appmsg_fe_filter = "contenteditable";

    var friend_read_source = "" || "";
    var friend_read_version = "" || "";
    var friend_read_class_id = "" || "";

    var is_only_read = "1" * 1;
    var read_num = "" * 1;
    var like_num = "" * 1;
    var liked = "" == 'true' ? true : false;
    var is_temp_url = "" ? 1 : 0;
    var send_time = "";
    var icon_emotion_switch = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg/emotion/icon_emotion_switch.2x42f400.png";
    var icon_emotion_switch_active = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg/emotion/icon_emotion_switch_active.2x42f400.png";
    var icon_loading_white = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/common/icon_loading_white42f400.gif";
    var icon_audio_unread = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg/audio/icon_audio_unread42f400.png";
    var icon_qqmusic_default = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg/qqmusic/icon_qqmusic_default.2x42f400.png";
    var icon_qqmusic_source = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg/qqmusic/icon_qqmusic_source42f400.png";
    var icon_kugou_source = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg/kugou/icon_kugou_source42f400.png";

    var topic_default_img = '//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg/topic/pic_book_thumb.2x42f400.png';
    var comment_edit_icon = '//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/appmsg_new/icon_edit42f400.png';
    var comment_loading_img = '//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/common/icon_loading_white42f400.gif';

    var voice_in_appmsg = {
        "1":"1"
            };

    var reprint_style = ''*1;
    var wxa_img_alert = "" != 'false';

    
    var more_read_type = '0'*1;

    
    
    
    

    
    var weapp_sn_arr_json = "" || "";

    
    var ban_scene = "0" * 1;

    var svr_time = "1554224597" * 1;
    
    var is_transfer_msg = ""*1||0;

    var malicious_title_reason_id = "0" * 1; 
    var malicious_content_type = "0" * 1; 

    
    var modify_time = "";

    
    var isprofileblock = "0";

    
    var hotspotInfoList = [
                    ];

        window.wxtoken = "777";
        
    
    
    
    
    window.is_login = '0' * 1; 

    window.__moon_initcallback = function(){
        if(!!window.__initCatch){
            window.__initCatch({
                idkey : 27611+2,
                startKey : 0,
                limit : 128,
                badjsId: 43,
                reportOpt : {
                    uin : uin,
                    biz : biz,
                    mid : mid,
                    idx : idx,
                    sn  : sn
                },
                extInfo : {
                    network_rate : 0.01,    
                    badjs_rate: 0.1 
                }
            });
        }
    }
        
    var title ="mPaaS";

    var is_new_msg=true;
    
    

    var is_wash = '' * 1;
</script>

<script nonce="1019499655" type="text/javascript">
(function(_g){
    _g.appmsg_like_type = "2" * 1 ? "2" * 1 : 1;
    
    _g.clientversion = "";
    _g.passparam = ""; 
    if(!_g.msg_link) {
      _g.msg_link = "http://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&amp;mid=2247483834&amp;idx=1&amp;sn=941ef69ac5f9813a2e5bfdfa6209fb9f&amp;chksm=f9e3151ece949c083ce4c22c72a125809aaf6e94f002f1dc30c9eb1503530adfd9c36212a11e#rd";
    }
    _g.appmsg_type = "9"; 
    _g.devicetype = ""; 
})(window);

</script>


        <script nonce="1019499655">window.__moon_host = 'res.wx.qq.com';window.__moon_mainjs = 'appmsg/index.js';window.moon_map = {"pages/iframe_communicate.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/iframe_communicate42f400.js","new_video/player.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/new_video/player.html433882.js","biz_wap/zepto/touch.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/zepto/touch42f400.js","biz_wap/zepto/event.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/zepto/event42f400.js","biz_wap/zepto/zepto.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/zepto/zepto440203.js","page/pages/video.css":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/pages/video.css435ee6.js","a/tpl/smallbanner_msg_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/smallbanner_msg_tpl.html42f400.js","a/tpl/smallbanner_info_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/smallbanner_info_tpl.html44c2e3.js","a/tpl/banner_info_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/banner_info_tpl.html42f400.js","a/tpl/promote_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/promote_tpl.html42f400.js","a/tpl/smallcard_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/smallcard_tpl.html42f400.js","a/tpl/info_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/info_tpl.html42f400.js","a/tpl/cardticket_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/cardticket_tpl.html42f400.js","a/tpl/banner_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/banner_tpl.html44c2e3.js","a/tpl/sponsor_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/sponsor_tpl.html42f400.js","a/tpl/new_cpc_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/new_cpc_tpl.html44c2e3.js","appmsg/emotion/caret.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/emotion/caret42f400.js","pages/audition_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/audition_tpl.html44ccb4.js","biz_wap/utils/localstorage.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/localstorage42f400.js","appmsg/friend_comment_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/friend_comment_tpl.html42f400.js","appmsg/comment_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/comment_tpl.html42f400.js","biz_wap/utils/fakehash.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/fakehash42f400.js","appmsg/comment_report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/comment_report42f400.js","a/appdialog_confirm.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/appdialog_confirm.html42f400.js","widget/wx_profile_dialog_primary.css":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/widget/wx_profile_dialog_primary.css42f400.js","new_video/player.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/new_video/player44cddd.js","a/tpl/mpda_bottom_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/mpda_bottom_tpl.html42f400.js","a/tpl/crt_size_map.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/crt_size_map42f400.js","biz_wap/jsapi/cardticket.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/jsapi/cardticket42f400.js","biz_common/jquery.md5.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/jquery.md542f400.js","biz_common/utils/emoji_panel_data.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/emoji_panel_data42f400.js","biz_common/utils/emoji_data.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/emoji_data42f400.js","appmsg/emotion/textarea.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/emotion/textarea42f400.js","appmsg/emotion/nav.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/emotion/nav42f400.js","appmsg/emotion/common.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/emotion/common42f400.js","appmsg/emotion/slide.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/emotion/slide42f400.js","appmsg/emotion/dom.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/emotion/dom42f400.js","pages/player_tips.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/player_tips44ccb4.js","pages/music_report_conf.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/music_report_conf42f400.js","pages/report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/report4306fd.js","pages/player_adaptor.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/player_adaptor42f400.js","pages/music_player.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/music_player42f400.js","appmsg/more_read_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/more_read_tpl.html42f400.js","appmsg/retry_ajax.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/retry_ajax42f400.js","complain/tips.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/complain/tips42f400.js","pages/loadscript.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/loadscript42f400.js","biz_wap/utils/ajax_load_js.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/ajax_load_js42f400.js","appmsg/comment.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/comment445789.js","a/ios.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/ios42f400.js","a/android.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/android42f400.js","a/profile.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/profile42f400.js","a/app_card.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/app_card44c2e3.js","a/sponsor.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/sponsor42f400.js","a/tpl/cpc_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/cpc_tpl.html42f400.js","a/appdialog_confirm.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/appdialog_confirm44c2e3.js","biz_common/dom/offset.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/dom/offset4402ec.js","a/video.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/video42f400.js","a/tpl/crt_tpl_manager.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/tpl/crt_tpl_manager42f400.js","a/cpc_a_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/cpc_a_tpl.html42f400.js","a/sponsor_a_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/sponsor_a_tpl.html42f400.js","a/a_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/a_tpl.html42f400.js","a/mpshop.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/mpshop42f400.js","a/wxopen_card.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/wxopen_card42f400.js","a/card.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/card42f400.js","biz_wap/utils/position.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/position42f400.js","a/a_report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/a_report4402ec.js","biz_wap/utils/show_time.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/show_time445789.js","biz_common/utils/get_para_list.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/get_para_list42f400.js","biz_wap/utils/openUrl.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/openUrl4402ec.js","a/a_sign.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/a_sign438181.js","appmsg/my_comment_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/my_comment_tpl.html42f400.js","appmsg/cmt_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/cmt_tpl.html42f400.js","sougou/a_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/sougou/a_tpl.html42f400.js","appmsg/emotion/emotion.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/emotion/emotion42f400.js","biz_common/base64.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/base6442f400.js","biz_common/utils/report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/report42f400.js","appmsg/articleReport.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/articleReport42f400.js","biz_wap/utils/hand_up_state.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/hand_up_state42f400.js","biz_common/utils/http.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/http42f400.js","biz_common/utils/cookie.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/cookie42f400.js","appmsg/topic_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/topic_tpl.html42f400.js","pages/weapp_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/weapp_tpl.html42f400.js","biz_common/utils/monitor.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/monitor42f400.js","pages/voice_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/voice_tpl.html42f400.js","pages/kugoumusic_ctrl.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/kugoumusic_ctrl42f400.js","pages/qqmusic_ctrl.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/qqmusic_ctrl44df7a.js","pages/voice_component.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/voice_component44df7a.js","pages/qqmusic_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/qqmusic_tpl.html42f400.js","new_video/ctl.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/new_video/ctl444d40.js","appmsg/open_url_with_webview.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/open_url_with_webview440203.js","appmsg/more_read.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/more_read42f400.js","appmsg/reward_entry.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/reward_entry42f400.js","appmsg/like.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/like44c2e3.js","pages/version4video.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/version4video42f400.js","biz_wap/utils/storage.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/storage42f400.js","appmsg/share_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/share_tpl.html42f400.js","appmsg/appmsgext.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/appmsgext430b95.js","appmsg/img_copyright_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/img_copyright_tpl.html42f400.js","pages/video_ctrl.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/video_ctrl42f400.js","pages/create_txv.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/create_txv42f400.js","appmsg/comment_utils.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/comment_utils42f400.js","biz_common/ui/imgonepx.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/ui/imgonepx42f400.js","appmsg/malicious_wording.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/malicious_wording42f400.js","biz_common/utils/wxgspeedsdk.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/wxgspeedsdk42f400.js","a/a_config.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/a_config44c130.js","a/a_utils.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/a_utils44dfba.js","a/a.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/a44cddd.js","rt/appmsg/getappmsgext.rt.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/rt/appmsg/getappmsgext.rt42f400.js","pages/video_communicate_adaptor.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/pages/video_communicate_adaptor433882.js","biz_wap/utils/ajax_wx.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/ajax_wx42f400.js","biz_common/utils/respTypes.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/respTypes42f400.js","biz_wap/utils/log.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/log42f400.js","sougou/index.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/sougou/index42f400.js","biz_wap/safe/mutation_observer_report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/safe/mutation_observer_report42f400.js","appmsg/fereport.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/fereport438bee.js","appmsg/fereport_without_localstorage.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/fereport_without_localstorage438bee.js","appmsg/report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/report42f400.js","appmsg/report_and_source.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/report_and_source4380a9.js","appmsg/page_pos.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/page_pos44c130.js","appmsg/cdn_speed_report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/cdn_speed_report42f400.js","appmsg/wxtopic.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/wxtopic42f400.js","appmsg/weapp.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/weapp433882.js","appmsg/weproduct.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/weproduct42f400.js","appmsg/voicemsg.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/voicemsg42f400.js","appmsg/autoread.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/autoread42f400.js","appmsg/voice.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/voice42f400.js","appmsg/qqmusic.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/qqmusic43440b.js","appmsg/iframe.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/iframe433882.js","appmsg/product.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/product42f400.js","appmsg/review_image.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/review_image435a90.js","appmsg/outer_link.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/outer_link44c2e3.js","appmsg/copyright_report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/copyright_report42f400.js","appmsg/async.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/async4402ec.js","biz_wap/ui/lazyload_img.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/ui/lazyload_img42f400.js","biz_common/log/jserr.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/log/jserr42f400.js","appmsg/share.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/share42f50a.js","appmsg/cdn_img_lib.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/cdn_img_lib42f400.js","appmsg/finance_communicate.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/finance_communicate440906.js","page/appmsg_new/not_in_mm.css":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/not_in_mm.css435ee6.js","page/appmsg_new/combo.css":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/combo.css44c130.js","biz_wap/utils/wapsdk.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/wapsdk44c130.js","a/mpAdAsync.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/mpAdAsync44dfba.js","biz_common/utils/url/parse.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/url/parse440451.js","appmsg/appmsg_report.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/appmsg_report435ac2.js","biz_common/moment.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/moment42f400.js","biz_wap/jsapi/core.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/jsapi/core42f400.js","biz_common/dom/event.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/dom/event445789.js","appmsg/test.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/test42f400.js","biz_wap/utils/mmversion.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/mmversion42f400.js","appmsg/max_age.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/max_age42f400.js","biz_common/dom/attr.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/dom/attr42f400.js","biz_wap/utils/ajax.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/ajax42f400.js","appmsg/log.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/log42f400.js","biz_common/dom/class.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/dom/class42f400.js","biz_wap/utils/device.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/device42f400.js","appmsg/weapp_common.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/weapp_common42f400.js","biz_common/utils/string/html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/string/html42f400.js","cps/tpl/list_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/cps/tpl/list_tpl.html42f400.js","cps/tpl/card_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/cps/tpl/card_tpl.html42f400.js","cps/tpl/banner_tpl.html.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/cps/tpl/banner_tpl.html42f400.js","biz_common/tmpl.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/tmpl42f400.js","appmsg/index.js":"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/index44c130.js"};</script><script nonce="1019499655" type="text/javascript" id="moon_inline" > window.__mooninline=1; window.setTimeout(function() {  function __moonf__(){
if(!window.__moonhasinit){
window.__moonhasinit=!0,window.__moonclientlog=[],window.__wxgspeeds&&(window.__wxgspeeds.moonloadedtime=+new Date),
"object"!=typeof JSON&&(window.JSON={
stringify:function(){
return"";
},
parse:function(){
return{};
}
});
var e=function(){
function e(e){
try{
var o;
/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)?o="writeLog":/(Android)/i.test(navigator.userAgent)&&(o="log"),
o&&t(o,e);
}catch(n){
throw console.error(n),n;
}
}
function t(e,o){
var n,r,i={};
n=top!=window?top.window:window;
try{
r=n.WeixinJSBridge,i=n.document;
}catch(a){}
e&&r&&r.invoke?r.invoke(e,{
level:"info",
msg:"[WechatFe][moon]"+o
}):setTimeout(function(){
i.addEventListener?i.addEventListener("WeixinJSBridgeReady",function(){
t(e,o);
},!1):i.attachEvent&&(i.attachEvent("WeixinJSBridgeReady",function(){
t(e,o);
}),i.attachEvent("onWeixinJSBridgeReady",function(){
t(e,o);
}));
},0);
}
var n;
localStorage&&JSON.parse(localStorage.getItem("__WXLS__moonarg"))&&"fromls"==JSON.parse(localStorage.getItem("__WXLS__moonarg")).method&&(n=!0),
e(" moon init, moon_inline:"+window.__mooninline+", moonls:"+n),function(){
var e={},o={},t={};
e.COMBO_UNLOAD=0,e.COMBO_LOADING=1,e.COMBO_LOADED=2;
var n=function(e,t,n){
if(!o[e]){
o[e]=n;
for(var r=3;r--;)try{
moon.setItem(moon.prefix+e,n.toString()),moon.setItem(moon.prefix+e+"_ver",moon_map[e]);
break;
}catch(i){
moon.clear();
}
}
},r=window.alert;
window.__alertList=[],window.alert=function(e){
r(e),window.__alertList.push(e);
};
var i=function(e){
if(!e||!o[e])return null;
var n=o[e];
if("function"==typeof n&&!t[e]){
var a={},s={
exports:a
},c=n(i,a,s,r);
n=o[e]=c||s.exports,t[e]=!0;
}
if(".css"===e.substr(-4)){
var d=document.getElementById(e);
if(!d){
d=document.createElement("style"),d.id=e;
var _=/url\s*\(\s*\/(\"(?:[^\\\"\r\n\f]|\\[\s\S])*\"|'(?:[^\\'\n\r\f]|\\[\s\S])*'|[^)}]+)\s*\)/g,m=window.testenv_reshost||window.__moon_host||"res.wx.qq.com";
n=n.replace(_,"url(//"+m+"/$1)"),d.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(d);
}
}
return n;
};
e.combo_status=e.COMBO_UNLOAD,e.run=function(){
var o=e.run.info,t=o&&o[0],n=o&&o[1];
if(t&&e.combo_status==e.COMBO_LOADED){
var r=i(t);
n&&n(r);
}
},e.use=function(o,t){
window.__wxgspeeds&&(window.__wxgspeeds.seajs_use_time=+new Date),e.run.info=[o,t],
e.run();
},window.define=n,window.seajs=e;
}(),function(){
if(window.__nonce_str){
var e=document.createElement;
document.createElement=function(o){
var t=e.apply(this,arguments);
return"object"==typeof o&&(o=o.toString()),"string"==typeof o&&"script"==o.toLowerCase()&&t.setAttribute("nonce",window.__nonce_str),
t;
};
}
window.addEventListener&&window.__DEBUGINFO&&Math.random()<.01&&window.addEventListener("load",function(){
var e=document.createElement("script");
e.src=__DEBUGINFO.safe_js,e.type="text/javascript",e.async=!0;
var o=document.head||document.getElementsByTagName("head")[0];
o.appendChild(e);
});
}(),function(){
function t(e){
return"[object Array]"===Object.prototype.toString.call(e);
}
function n(e){
return"[object Object]"===Object.prototype.toString.call(e);
}
function r(e){
var t=e.stack+" "+e.toString()||"";
try{
if(window.testenv_reshost){
var n="http(s)?://"+window.testenv_reshost,r=new RegExp(n,"g");
t=t.replace(r,"");
}else t=t.replace(/http(s)?:\/\/res\.wx\.qq\.com/g,"");
for(var r=/\/([^.]+)\/js\/(\S+?)\.js(\,|:)?/g;r.test(t);)t=t.replace(r,function(e,o,t,n){
return t+n;
});
}catch(e){
t=e.stack?e.stack:"";
}
var i=[];
for(o in u)u.hasOwnProperty(o)&&i.push(o+":"+u[o]);
return i.push("STK:"+t.replace(/\n/g,"")),i.join("|");
}
function i(e){
if(!e){
var o=window.onerror;
window.onerror=function(){},f=setTimeout(function(){
window.onerror=o,f=null;
},50);
}
}
function a(e,o,t){
if(!/^mp\.weixin\.qq\.com$/.test(location.hostname)){
var n=[];
t=t.replace(location.href,(location.origin||"")+(location.pathname||"")).replace("#wechat_redirect","").replace("#rd","").split("&");
for(var r=0,i=t.length;i>r;r++){
var a=t[r].split("=");
a[0]&&a[1]&&n.push(a[0]+"="+encodeURIComponent(a[1]));
}
var s=new window.Image;
return void(s.src=(o+n.join("&")).substr(0,1024));
}
var c;
if(window.ActiveXObject)try{
c=new ActiveXObject("Msxml2.XMLHTTP");
}catch(d){
try{
c=new ActiveXObject("Microsoft.XMLHTTP");
}catch(_){
c=!1;
}
}else window.XMLHttpRequest&&(c=new XMLHttpRequest);
c&&(c.open(e,o,!0),c.setRequestHeader("cache-control","no-cache"),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),
c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.send(t));
}
function s(e){
return function(o,t){
if("string"==typeof o)try{
o=new Function(o);
}catch(n){
throw n;
}
var r=[].slice.call(arguments,2),a=o;
return o=function(){
try{
return a.apply(this,r.length&&r||arguments);
}catch(e){
throw e.stack&&console&&console.error&&console.error("[TryCatch]"+e.stack),_&&window.__moon_report&&(window.__moon_report([{
offset:j,
log:"timeout_error;host:"+location.host,
e:e
}]),i(f)),e;
}
},e(o,t);
};
}
function c(e){
return function(o,t,n){
if("undefined"==typeof n)var n=!1;
var r=this,a=t||function(){};
return t=function(){
try{
return a.apply(r,arguments);
}catch(e){
throw e.stack&&console&&console.error&&console.error("[TryCatch]"+e.stack),_&&window.__moon_report&&(window.__moon_report([{
offset:x,
log:"listener_error;type:"+o+";host:"+location.host,
e:e
}]),i(f)),e;
}
},a.moon_lid=E,b[E]=t,E++,e.call(r,o,t,n);
};
}
function d(e){
return function(o,t,n){
if("undefined"==typeof n)var n=!1;
var r=this;
return t=b[t.moon_lid],e.call(r,o,t,n);
};
}
var _,m,l,w,u,p,f,h=/MicroMessenger/i.test(navigator.userAgent),g=/MPAPP/i.test(navigator.userAgent),v=window.define,y=0,x=2,O=4,j=9,D=10;
if(window.__initCatch=function(e){
_=e.idkey,m=e.startKey||0,l=e.limit,w=e.badjsId,u=e.reportOpt||"",p=e.extInfo||{},
p.rate=p.rate||.5;
},window.__moon_report=function(e,o){
var i=!1,s="";
try{
s=top.location.href;
}catch(c){
i=!0;
}
var d=.5;
if(p&&p.rate&&(d=p.rate),o&&"number"==typeof o&&(d=o),!(!/mp\.weixin\.qq\.com/.test(location.href)&&!/payapp\.weixin\.qq\.com/.test(location.href)||Math.random()>d||!h&&!g||top!=window&&!i&&!/mp\.weixin\.qq\.com/.test(s))&&(n(e)&&(e=[e]),
t(e)&&""!=_)){
var u="",f=[],v=[],y=[],x=[];
"number"!=typeof l&&(l=1/0);
for(var j=0;j<e.length;j++){
var D=e[j]||{};
if(!(D.offset>l||"number"!=typeof D.offset||D.offset==O&&p&&p.network_rate&&Math.random()>=p.network_rate)){
var b=1/0==l?m:m+D.offset;
f[j]="[moon]"+_+"_"+b+";"+D.log+";"+r(D.e||{})||"",v[j]=b,y[j]=1;
}
}
for(var E=0;E<v.length;E++)x[E]=_+"_"+v[E]+"_"+y[E],u=u+"&log"+E+"="+f[E];
if(x.length>0){
a("POST",location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?","idkey="+x.join(";")+"&r="+Math.random()+"&lc="+f.length+u);
var d=1;
if(p&&p.badjs_rate&&(d=p.badjs_rate),w&&Math.random()<d){
u=u.replace(/uin\:(.)*\|biz\:(.)*\|mid\:(.)*\|idx\:(.)*\|sn\:(.)*\|/,"");
var S=new Image,I="https://badjs.weixinbridge.com/badjs?id="+w+"&level=4&from="+encodeURIComponent(location.host)+"&msg="+encodeURIComponent(u);
S.src=I.slice(0,1024);
}
}
}
},window.setTimeout=s(window.setTimeout),window.setInterval=s(window.setInterval),
Math.random()<.01&&window.Document&&window.HTMLElement){
var b={},E=0;
Document.prototype.addEventListener=c(Document.prototype.addEventListener),Document.prototype.removeEventListener=d(Document.prototype.removeEventListener),
HTMLElement.prototype.addEventListener=c(HTMLElement.prototype.addEventListener),
HTMLElement.prototype.removeEventListener=d(HTMLElement.prototype.removeEventListener);
}
var S=window.navigator.userAgent;
if((/ip(hone|ad|od)/i.test(S)||/android/i.test(S))&&!/windows phone/i.test(S)&&window.localStorage&&window.localStorage.setItem){
var I=window.localStorage.setItem,L=0;
window.localStorage.setItem=function(e,o){
if(!(L>=10))try{
I.call(window.localStorage,e,o);
}catch(t){
t.stack&&console&&console.error&&console.error("[TryCatch]"+t.stack),window.__moon_report([{
offset:D,
log:"localstorage_error;"+t.toString(),
e:t
}]),L++,L>=3&&window.moon&&window.moon.clear&&moon.clear();
}
};
}
window.seajs&&v&&(window.define=function(){
for(var o,t=[],n=arguments&&arguments[0],a=0,s=arguments.length;s>a;a++){
var c=o=arguments[a];
"function"==typeof o&&(o=function(){
try{
return c.apply(this,arguments);
}catch(o){
throw"string"==typeof n&&console.error("[TryCatch][DefineeErr]id:"+n),o.stack&&console&&console.error&&console.error("[TryCatch]"+o.stack),
_&&window.__moon_report&&(window.__moon_report([{
offset:y,
log:"define_error;id:"+n+";",
e:o
}]),i(f)),e(" [define_error]"+JSON.stringify(r(o))),o;
}
},o.toString=function(e){
return function(){
return e.toString();
};
}(arguments[a])),t.push(o);
}
return v.apply(this,t);
});
}(),function(o){
function t(e,o,t){
return window.__DEBUGINFO?(window.__DEBUGINFO.res_list||(window.__DEBUGINFO.res_list=[]),
window.__DEBUGINFO.res_list[e]?(window.__DEBUGINFO.res_list[e][o]=t,!0):!1):!1;
}
function n(e){
var o=new TextEncoder("utf-8").encode(e),t=crypto.subtle||crypto.webkitSubtle;
return t.digest("SHA-256",o).then(function(e){
return r(e);
});
}
function r(e){
for(var o=[],t=new DataView(e),n=0;n<t.byteLength;n+=4){
var r=t.getUint32(n),i=r.toString(16),a="00000000",s=(a+i).slice(-a.length);
o.push(s);
}
return o.join("");
}
function i(e,o,t){
if("object"==typeof e){
var n=Object.prototype.toString.call(e).replace(/^\[object (.+)\]$/,function(e,o){
return o;
});
if(t=t||e,"Array"==n){
for(var r=0,i=e.length;i>r;++r)if(o.call(t,e[r],r,e)===!1)return;
}else{
if("Object"!==n&&a!=e)throw"unsupport type";
if(a==e){
for(var r=e.length-1;r>=0;r--){
var s=a.key(r),c=a.getItem(s);
if(o.call(t,c,s,e)===!1)return;
}
return;
}
for(var r in e)if(e.hasOwnProperty(r)&&o.call(t,e[r],r,e)===!1)return;
}
}
}
var a=o.localStorage,s=document.head||document.getElementsByTagName("head")[0],c=1,d=11,_=12,m=13,l=window.__allowLoadResFromMp?1:2,w=window.__allowLoadResFromMp?1:0,u=l+w,p=window.testenv_reshost||window.__moon_host||"res.wx.qq.com",f=new RegExp("^(http(s)?:)?//"+p);
window.__loadAllResFromMp&&(p="mp.weixin.qq.com",l=0,u=l+w);
var h={
prefix:"__MOON__",
loaded:[],
unload:[],
clearSample:!0,
hit_num:0,
mod_num:0,
version:1003,
cacheData:{
js_mod_num:0,
js_hit_num:0,
js_not_hit_num:0,
js_expired_num:0,
css_mod_num:0,
css_hit_num:0,
css_not_hit_num:0,
css_expired_num:0
},
init:function(){
h.loaded=[],h.unload=[];
var e,t,r;
if(window.no_moon_ls&&(h.clearSample=!0),a){
var s="_moon_ver_key_",c=a.getItem(s);
c!=h.version&&(h.clear(),a.setItem(s,h.version));
}
if((-1!=location.search.indexOf("no_moon1=1")||-1!=location.search.indexOf("no_lshttps=1"))&&h.clear(),
a){
var d=1*a.getItem(h.prefix+"clean_time"),_=+new Date;
if(_-d>=1296e6){
h.clear();
try{
!!a&&a.setItem(h.prefix+"clean_time",+new Date);
}catch(m){}
}
}
i(moon_map,function(i,s){
if(t=h.prefix+s,r=!!i&&i.replace(f,""),e=!!a&&a.getItem(t),version=!!a&&(a.getItem(t+"_ver")||"").replace(f,""),
h.mod_num++,r&&-1!=r.indexOf(".css")?h.cacheData.css_mod_num++:r&&-1!=r.indexOf(".js")&&h.cacheData.js_mod_num++,
h.clearSample||!e||r!=version)h.unload.push(r.replace(f,"")),r&&-1!=r.indexOf(".css")?e?r!=version&&h.cacheData.css_expired_num++:h.cacheData.css_not_hit_num++:r&&-1!=r.indexOf(".js")&&(e?r!=version&&h.cacheData.js_expired_num++:h.cacheData.js_not_hit_num++);else{
if("https:"==location.protocol&&window.moon_hash_map&&window.moon_hash_map[s]&&window.crypto)try{
n(e).then(function(e){
window.moon_hash_map[s]!=e&&console.log(s);
});
}catch(c){}
try{
var d="//# sourceURL="+s+"\n//@ sourceURL="+s;
o.eval.call(o,'define("'+s+'",[],'+e+")"+d),h.hit_num++,r&&-1!=r.indexOf(".css")?h.cacheData.css_hit_num++:r&&-1!=r.indexOf(".js")&&h.cacheData.js_hit_num++;
}catch(c){
h.unload.push(r.replace(f,""));
}
}
}),h.load(h.genUrl());
},
genUrl:function(){
var e=h.unload;
if(!e||e.length<=0)return[];
var o,t,n="",r=[],i={},a=-1!=location.search.indexOf("no_moon2=1"),s="//"+p;
-1!=location.href.indexOf("moon_debug2=1")&&(s="//mp.weixin.qq.com");
for(var c=0,d=e.length;d>c;++c){
/^\/(.*?)\//.test(e[c]);
var _=/^\/(.*?)\//.exec(e[c]);
_.length<2||!_[1]||(t=_[1],n=i[t],n?(o=n+","+e[c],o.length>1e3||a?(r.push(n+"?v="+h.version),
n=location.protocol+s+e[c],i[t]=n):(n=o,i[t]=n)):(n=location.protocol+s+e[c],i[t]=n));
}
for(var m in i)i.hasOwnProperty(m)&&r.push(i[m]);
return r;
},
load:function(e){
if(window.__wxgspeeds&&(window.__wxgspeeds.mod_num=h.mod_num,window.__wxgspeeds.hit_num=h.hit_num),
!e||e.length<=0)return seajs.combo_status=seajs.COMBO_LOADED,seajs.run(),console.debug&&console.debug("[moon] load js complete, all in cache, cost time : 0ms, total count : "+h.mod_num+", hit num: "+h.hit_num),
void window.__moonclientlog.push("[moon] load js complete, all in cache, cost time : 0ms, total count : "+h.mod_num+", hit num: "+h.hit_num);
seajs.combo_status=seajs.COMBO_LOADING;
var o=0,t=+new Date;
window.__wxgspeeds&&(window.__wxgspeeds.combo_times=[],window.__wxgspeeds.combo_times.push(t)),
i(e,function(n){
h.request(n,u,function(){
if(window.__wxgspeeds&&window.__wxgspeeds.combo_times.push(+new Date),o++,o==e.length){
var n=+new Date-t;
window.__wxgspeeds&&(window.__wxgspeeds.mod_downloadtime=n),seajs.combo_status=seajs.COMBO_LOADED,
seajs.run(),console.debug&&console.debug("[moon] load js complete, url num : "+e.length+", total mod count : "+h.mod_num+", hit num: "+h.hit_num+", use time : "+n+"ms"),
window.__moonclientlog.push("[moon] load js complete, url num : "+e.length+", total mod count : "+h.mod_num+", hit num: "+h.hit_num+", use time : "+n+"ms");
}
});
});
},
request:function(o,n,r){
if(o){
n=n||0,o.indexOf("mp.weixin.qq.com")>-1&&((new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=27613_32_1&r="+Math.random(),
window.__moon_report([{
offset:_,
log:"load_script_from_mp: "+o
}],1));
var i=-1;
window.__DEBUGINFO&&(__DEBUGINFO.res_list||(__DEBUGINFO.res_list=[]),__DEBUGINFO.res_list.push({
type:"js",
status:"pendding",
start:+new Date,
end:0,
url:o
}),i=__DEBUGINFO.res_list.length-1),-1!=location.search.indexOf("no_lshttps=1")&&(o=o.replace("http://","https://"));
var a=document.createElement("script");
a.src=o,a.type="text/javascript",a.async=!0,a.down_time=+new Date,a.onerror=function(s){
t(i,"status","error"),t(i,"end",+new Date);
var _=new Error(s);
if(n>=0)if(w>n){
var l=o.replace("res.wx.qq.com","mp.weixin.qq.com");
h.request(l,n,r);
}else h.request(o,n,r);else window.__moon_report&&window.__moon_report([{
offset:c,
log:"load_script_error: "+o,
e:_
}],1);
if(n==w-1&&window.__moon_report([{
offset:d,
log:"load_script_error: "+o,
e:_
}],1),-1==n){
var u="ua: "+window.navigator.userAgent+", time="+(+new Date-a.down_time)+", load_script_error -1 : "+o;
window.__moon_report([{
offset:m,
log:u
}],1);
}
window.__moonclientlog.push("moon load js error : "+o+", error -> "+_.toString()),
e("moon_request_error url:"+o);
},"undefined"!=typeof moon_crossorigin&&moon_crossorigin&&a.setAttribute("crossorigin",!0),
a.onload=a.onreadystatechange=function(){
t(i,"status","loaded"),t(i,"end",+new Date),!a||a.readyState&&!/loaded|complete/.test(a.readyState)||(t(i,"status","200"),
a.onload=a.onreadystatechange=null,"function"==typeof r&&r());
},n--,s.appendChild(a),e("moon_request url:"+o+" retry:"+n);
}
},
setItem:function(e,o){
!!a&&a.setItem(e,o);
},
clear:function(){
a&&(i(a,function(e,o){
~o.indexOf(h.prefix)&&a.removeItem(o);
}),console.debug&&console.debug("[moon] clear"));
},
idkeyReport:function(e,o,t){
t=t||1;
var n=e+"_"+o+"_"+t;
(new Image).src="/mp/jsmonitor?idkey="+n+"&r="+Math.random();
}
};
seajs&&seajs.use&&"string"==typeof window.__moon_mainjs&&seajs.use(window.__moon_mainjs),
window.moon=h;
}(window),function(){
try{
Math.random()<1;
}catch(e){}
}(),window.moon.init();
};
e(),!!window.__moon_initcallback&&window.__moon_initcallback(),window.__wxgspeeds&&(window.__wxgspeeds.moonendtime=+new Date);
}
}
__moonf__(); }, 25);</script><script nonce="1019499655" type="text/javascript">
    var real_show_page_time = +new Date();
    if (!!window.addEventListener){
        window.addEventListener("load", function(){
            window.onload_endtime = +new Date();
        });
    }

    
</script>

    </body>
    <script nonce="1019499655" type="text/javascript">document.addEventListener("touchstart", function() {},false);</script>
</html>

