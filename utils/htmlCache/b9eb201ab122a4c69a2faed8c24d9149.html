<!DOCTYPE html>

<html lang="en-US" prefix="og: http://ogp.me/ns#">

<head>

	<meta charset="UTF-8">

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="profile" href="https://gmpg.org/xfn/11">

	<link rel="pingback" href="https://dmtopolog.com/xmlrpc.php">

	<title>Object serialization in iOS - @topolog&#039;s tech blog</title>

<!-- This site is optimized with the Yoast SEO plugin v10.1 - https://yoast.com/wordpress/plugins/seo/ -->
<link rel="canonical" href="https://dmtopolog.com/object-serialization-in-ios/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Object serialization in iOS - @topolog&#039;s tech blog" />
<meta property="og:description" content="In this post I&#8217;ll try to systemise the knowledge about major formats and types of data serialization in iOS development.&hellip;" />
<meta property="og:url" content="https://dmtopolog.com/object-serialization-in-ios/" />
<meta property="og:site_name" content="@topolog&#039;s tech blog" />
<meta property="article:tag" content="Codable" />
<meta property="article:tag" content="iOS" />
<meta property="article:tag" content="JSON" />
<meta property="article:tag" content="NSCoding" />
<meta property="article:tag" content="Plist" />
<meta property="article:tag" content="Serialization" />
<meta property="article:section" content="Tech Blog" />
<meta property="article:published_time" content="2019-01-14T10:18:58+00:00" />
<meta property="article:modified_time" content="2019-01-14T21:05:28+00:00" />
<meta property="og:updated_time" content="2019-01-14T21:05:28+00:00" />
<meta property="og:image" content="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?fit=2000%2C1333&#038;ssl=1" />
<meta property="og:image:secure_url" content="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?fit=2000%2C1333&#038;ssl=1" />
<meta property="og:image:width" content="2000" />
<meta property="og:image:height" content="1333" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="In this post I&#8217;ll try to systemise the knowledge about major formats and types of data serialization in iOS development.&hellip;" />
<meta name="twitter:title" content="Object serialization in iOS - @topolog&#039;s tech blog" />
<meta name="twitter:image" content="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?fit=2000%2C1333&#038;ssl=1" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="@topolog&#039;s tech blog &raquo; Feed" href="https://dmtopolog.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="@topolog&#039;s tech blog &raquo; Comments Feed" href="https://dmtopolog.com/comments/feed/" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.4.2 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<script type="text/javascript" data-cfasync="false">
	var mi_version         = '7.4.2';
	var mi_track_user      = true;
	var mi_no_track_reason = '';
	
	var disableStr = 'ga-disable-UA-127243344-1';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}
	
	if ( mi_track_user ) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

		__gaTracker('create', 'UA-127243344-1', 'auto');
		__gaTracker('set', 'forceSSL', true);
		__gaTracker('require', 'displayfeatures');
		__gaTracker('require', 'linkid', 'linkid.js');
		__gaTracker('send','pageview');
	} else {
		console.log( "" );
		(function() {
			/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
			var noopfn = function() {
				return null;
			};
			var noopnullfn = function() {
				return null;
			};
			var Tracker = function() {
				return null;
			};
			var p = Tracker.prototype;
			p.get = noopfn;
			p.set = noopfn;
			p.send = noopfn;
			var __gaTracker = function() {
				var len = arguments.length;
				if ( len === 0 ) {
					return;
				}
				var f = arguments[len-1];
				if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
					console.log( 'Not running function __gaTracker(' + arguments[0] + " ....) because you are not being tracked. " + mi_no_track_reason );
					return;
				}
				try {
					f.hitCallback();
				} catch (ex) {

				}
			};
			__gaTracker.create = function() {
				return new Tracker();
			};
			__gaTracker.getByName = noopnullfn;
			__gaTracker.getAll = function() {
				return [];
			};
			__gaTracker.remove = noopfn;
			window['__gaTracker'] = __gaTracker;
					})();
		}
</script>
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/dmtopolog.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='crayon-css'  href='https://dmtopolog.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-xcode-css'  href='https://dmtopolog.com/wp-content/plugins/crayon-syntax-highlighter/themes/xcode/xcode.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://dmtopolog.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://dmtopolog.com/wp-includes/css/dist/block-library/style.min.css?ver=5.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-theme-css'  href='https://dmtopolog.com/wp-includes/css/dist/block-library/theme.min.css?ver=5.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='stout-css'  href='https://dmtopolog.com/wp-content/themes/stout/style.css?ver=1.1.4' type='text/css' media='all' />
<style id='stout-inline-css' type='text/css'>
.hero{background-image:url(https://i2.wp.com/dmtopolog.com/wp-content/uploads/2018/10/cropped-art-artistic-background-206290.jpg?resize=2400%2C831&#038;ssl=1);}
.site-title a,.site-title a:visited{color:#5d5179;}.site-title a:hover,.site-title a:visited:hover{color:rgba(93, 81, 121, 0.8);}
.site-description{color:#f9f9f9;}
.hero,.hero .widget h1,.hero .widget h2,.hero .widget h3,.hero .widget h4,.hero .widget h5,.hero .widget h6,.hero .widget p,.hero .widget blockquote,.hero .widget cite,.hero .widget table,.hero .widget ul,.hero .widget ol,.hero .widget li,.hero .widget dd,.hero .widget dt,.hero .widget address,.hero .widget code,.hero .widget pre,.hero .widget .widget-title,.hero .page-header h1{color:#ffffff;}
.main-navigation ul li a,.main-navigation ul li a:visited,.main-navigation ul li a:hover,.main-navigation ul li a:focus,.main-navigation ul li a:visited:hover{color:#5e5e5e;}.main-navigation .sub-menu .menu-item-has-children > a::after{border-right-color:#5e5e5e;border-left-color:#5e5e5e;}.menu-toggle div{background-color:#5e5e5e;}.main-navigation ul li a:hover,.main-navigation ul li a:focus{color:rgba(94, 94, 94, 0.8);}
h1,h2,h3,h4,h5,h6,label,legend,table th,dl dt,.entry-title,.entry-title a,.entry-title a:visited,.widget-title{color:#0f0f0f;}.entry-title a:hover,.entry-title a:visited:hover,.entry-title a:focus,.entry-title a:visited:focus,.entry-title a:active,.entry-title a:visited:active{color:rgba(15, 15, 15, 0.8);}
body,input,select,textarea,input[type="text"]:focus,input[type="email"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="search"]:focus,input[type="number"]:focus,input[type="tel"]:focus,input[type="range"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,input[type="color"]:focus,textarea:focus,.navigation.pagination .paging-nav-text{color:#252525;}hr{background-color:rgba(37, 37, 37, 0.1);border-color:rgba(37, 37, 37, 0.1);}input[type="text"],input[type="email"],input[type="url"],input[type="password"],input[type="search"],input[type="number"],input[type="tel"],input[type="range"],input[type="date"],input[type="month"],input[type="week"],input[type="time"],input[type="datetime"],input[type="datetime-local"],input[type="color"],textarea,.select2-container .select2-choice{color:rgba(37, 37, 37, 0.5);border-color:rgba(37, 37, 37, 0.1);}select,fieldset,blockquote,pre,code,abbr,acronym,.hentry table th,.hentry table td{border-color:rgba(37, 37, 37, 0.1);}.hentry table tr:hover td{background-color:rgba(37, 37, 37, 0.05);}
blockquote,.entry-meta,.entry-footer,.comment-meta .says,.logged-in-as{color:#8e8e8e;}
.site-footer .widget-title,.site-footer h1,.site-footer h2,.site-footer h3,.site-footer h4,.site-footer h5,.site-footer h6{color:#ffffff;}
.site-footer .widget,.site-footer .widget form label{color:#ffffff;}
.footer-menu ul li a,.footer-menu ul li a:visited{color:#252525;}.site-info-wrapper .social-menu a{background-color:#252525;}.footer-menu ul li a,.footer-menu ul li a:visited{color:#252525;}.site-info-wrapper .social-menu a,.site-info-wrapper .social-menu a:visited{background-color:#252525;}.footer-menu ul li a:hover,.footer-menu ul li a:visited:hover{color:rgba(37, 37, 37, 0.8);}.footer-menu ul li a:hover,.footer-menu ul li a:visited:hover{color:rgba(37, 37, 37, 0.8);}
.site-info-wrapper .site-info-text{color:#686868;}
a,a:visited,.entry-title a:hover,.entry-title a:visited:hover{color:#7f7fc6;}.navigation.pagination .nav-links .page-numbers.current,.social-menu a:hover{background-color:#7f7fc6;}a:hover,a:visited:hover,a:focus,a:visited:focus,a:active,a:visited:active{color:rgba(127, 127, 198, 0.8);}.comment-list li.bypostauthor{border-color:rgba(127, 127, 198, 0.2);}
button,a.button,a.button:visited,input[type="button"],input[type="reset"],input[type="submit"],.site-info-wrapper .social-menu a:hover{background-color:#5d5179;border-color:#5d5179;}button:hover,button:active,button:focus,a.button:hover,a.button:active,a.button:focus,a.button:visited:hover,a.button:visited:active,a.button:visited:focus,input[type="button"]:hover,input[type="button"]:active,input[type="button"]:focus,input[type="reset"]:hover,input[type="reset"]:active,input[type="reset"]:focus,input[type="submit"]:hover,input[type="submit"]:active,input[type="submit"]:focus{background-color:rgba(93, 81, 121, 0.8);border-color:rgba(93, 81, 121, 0.8);}
button,button:hover,button:active,button:focus,a.button,a.button:hover,a.button:active,a.button:focus,a.button:visited,a.button:visited:hover,a.button:visited:active,a.button:visited:focus,input[type="button"],input[type="button"]:hover,input[type="button"]:active,input[type="button"]:focus,input[type="reset"],input[type="reset"]:hover,input[type="reset"]:active,input[type="reset"]:focus,input[type="submit"],input[type="submit"]:hover,input[type="submit"]:active,input[type="submit"]:focus{color:#ffffff;}
body{background-color:#ffffff;}.navigation.pagination .nav-links .page-numbers.current{color:#ffffff;}
.hero{background-color:#252525;}.hero{-webkit-box-shadow:inset 0 0 0 9999em;-moz-box-shadow:inset 0 0 0 9999em;box-shadow:inset 0 0 0 9999em;color:rgba(37, 37, 37, 0.25);}
.main-navigation-container,.main-navigation.open,.main-navigation ul ul,.main-navigation .sub-menu{background-color:#ffffff;}.site-header-wrapper{background-color:#ffffff;}
.site-footer{background-color:#191919;}
.site-info-wrapper{background-color:#ffffff;}.site-info-wrapper .social-menu a,.site-info-wrapper .social-menu a:visited,.site-info-wrapper .social-menu a:hover,.site-info-wrapper .social-menu a:visited:hover{color:#ffffff;}
</style>
<link rel='stylesheet' id='stout-fonts-css'  href='//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700%7CLato%3A300%2C400%2C700&#038;subset=latin&#038;ver=5.1.1' type='text/css' media='all' />
<style id='stout-fonts-inline-css' type='text/css'>
.site-title{font-family:"Oswald", sans-serif;}
.main-navigation ul li a,.main-navigation ul li a:visited,button,a.button,a.fl-button,input[type="button"],input[type="reset"],input[type="submit"]{font-family:"Oswald", sans-serif;}
h1,h2,h3,h4,h5,h6,label,legend,table th,dl dt,.entry-title,.widget-title{font-family:"Oswald", sans-serif;}
body,p,ol li,ul li,dl dd,.fl-callout-text{font-family:"Lato", sans-serif;}
blockquote,.entry-meta,.entry-footer,.comment-list li .comment-meta .says,.comment-list li .comment-metadata,.comment-reply-link,#respond .logged-in-as{font-family:"Lato", sans-serif;}
</style>
<link rel='stylesheet' id='social-logos-css'  href='https://dmtopolog.com/wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://dmtopolog.com/wp-content/plugins/jetpack/css/jetpack.css?ver=7.1.1' type='text/css' media='all' />
<script>if (document.location.protocol != "https:") {document.location = document.URL.replace(/^http:/i, "https:");}</script><script type='text/javascript' src='https://dmtopolog.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://dmtopolog.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/jetpack/_inc/build/related-posts/related-posts.min.js?ver=20190204'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/dmtopolog.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,exe,js,pdf,ppt,tgz,zip,xls","inbound_paths":"[]","home_url":"https:\/\/dmtopolog.com","hash_tracking":"false"};
/* ]]> */
</script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend.min.js?ver=7.4.2'></script>
<link rel='https://api.w.org/' href='https://dmtopolog.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://dmtopolog.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://dmtopolog.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.1.1" />
<link rel='shortlink' href='https://wp.me/pal8R9-38' />
<link rel="alternate" type="application/json+oembed" href="https://dmtopolog.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdmtopolog.com%2Fobject-serialization-in-ios%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://dmtopolog.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdmtopolog.com%2Fobject-serialization-in-ios%2F&#038;format=xml" />

<link rel='dns-prefetch' href='//v0.wordpress.com'/>
<link rel='dns-prefetch' href='//i0.wp.com'/>
<link rel='dns-prefetch' href='//i1.wp.com'/>
<link rel='dns-prefetch' href='//i2.wp.com'/>
<style type='text/css'>img#wpstats{display:none}</style>		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<style type='text/css'>
.site-title a,.site-title a:visited{color:5d5179;}
</style>			<style type="text/css">
				/* If html does not have either class, do not show lazy loaded images. */
				html:not( .jetpack-lazy-images-js-enabled ):not( .js ) .jetpack-lazy-image {
					display: none;
				}
			</style>
			<script>
				document.documentElement.classList.add(
					'jetpack-lazy-images-js-enabled'
				);
			</script>
		<link rel="icon" href="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2018/10/cropped-IMG_20181014_112932-1-1.jpg?fit=32%2C32&#038;ssl=1" sizes="32x32" />
<link rel="icon" href="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2018/10/cropped-IMG_20181014_112932-1-1.jpg?fit=192%2C192&#038;ssl=1" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2018/10/cropped-IMG_20181014_112932-1-1.jpg?fit=180%2C180&#038;ssl=1" />
<meta name="msapplication-TileImage" content="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2018/10/cropped-IMG_20181014_112932-1-1.jpg?fit=270%2C270&#038;ssl=1" />

</head>

<body data-rsssl=1 class="post-template-default single single-post postid-194 single-format-standard custom-header-image layout-two-column-default no-max-width">

	
	<div id="page" class="hfeed site">

		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		
		<header id="masthead" class="site-header" role="banner">

			
			<div class="site-header-wrapper">

				
<div class="site-title-wrapper">

	
	<div class="site-title"><a href="https://dmtopolog.com/" rel="home">@topolog&#039;s tech blog</a></div>
	
</div><!-- .site-title-wrapper -->

<div class="main-navigation-container">

	
<div class="menu-toggle" id="menu-toggle">
	<div></div>
	<div></div>
	<div></div>
</div><!-- #menu-toggle -->

	<nav id="site-navigation" class="main-navigation">

		<div class="menu"><ul><li ><a href="https://dmtopolog.com/">Home</a></li><li class="page_item page-item-10"><a href="https://dmtopolog.com/about-me/">About me</a></li><li class="page_item page-item-89"><a href="https://dmtopolog.com/newsletter/">Newsletter</a></li></ul></div>
	</nav><!-- #site-navigation -->

	
</div>

			</div><!-- .site-header-wrapper -->

			
		</header><!-- #masthead -->

		
<div class="hero">

	
	<div class="hero-inner">

		
<div class="page-title-container">

	<header class="page-header">

		<h2 class="page-title">Posts</h2>
	</header><!-- .entry-header -->

</div><!-- .page-title-container -->

	</div>

</div>

		<div id="content" class="site-content">

<div id="primary" class="content-area">

	<main id="main" class="site-main" role="main">

	
		
<article id="post-194" class="post-194 post type-post status-publish format-standard has-post-thumbnail hentry category-tech-blog tag-codable tag-ios tag-json tag-nscoding tag-plist tag-serialization">

	
	
			<div class="featured-image">

	
	
		<img width="1600" height="1066" src="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?fit=1600%2C1066&amp;ssl=1" class="attachment-primer-featured size-primer-featured wp-post-image jetpack-lazy-image" alt="" data-attachment-id="229" data-permalink="https://dmtopolog.com/object-serialization-in-ios/floppy_disks_2/" data-orig-file="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?fit=2000%2C1333&amp;ssl=1" data-orig-size="2000,1333" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="floppy_disks_2" data-image-description="" data-medium-file="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?fit=300%2C200&amp;ssl=1" data-large-file="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?fit=688%2C458&amp;ssl=1" data-lazy-srcset="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?w=2000&amp;ssl=1 2000w, https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?resize=300%2C200&amp;ssl=1 300w, https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?resize=768%2C512&amp;ssl=1 768w, https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?resize=1024%2C682&amp;ssl=1 1024w, https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?resize=1600%2C1066&amp;ssl=1 1600w, https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?w=1376&amp;ssl=1 1376w" data-lazy-sizes="(max-width: 1600px) 100vw, 1600px" data-lazy-src="https://i2.wp.com/dmtopolog.com/wp-content/uploads/2019/01/floppy_disks_2.jpg?fit=1600%2C1066&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" />
	
	
	</div><!-- .featured-image -->
	
	
	
<header class="entry-header">

	<div class="entry-header-row">

		<div class="entry-header-column">

			
			
				<h1 class="entry-title">Object serialization in iOS</h1>

			
			
		</div><!-- .entry-header-column -->

	</div><!-- .entry-header-row -->

</header><!-- .entry-header -->

	
<div class="entry-meta">

	
		<span class="posted-date">2019-01-14</span>

	
	<span class="posted-author"><a href="https://dmtopolog.com/author/topolog/" title="Posts by topolog" rel="author">topolog</a></span>

	
</div><!-- .entry-meta -->

	
		
<div class="entry-content">

	
<p>In this post I&#8217;ll try to systemise the knowledge about major formats and types of data serialization in iOS development. I will also compare ObjC approach to the problem (NSCoding) with the one we got in Swift 4 (Codable) and will take a look at some specific use cases like interop between them and the ability to work with complex object graphs.</p>



<h2>Contents:</h2>



<ul><li>Serialization as a separate process&nbsp;</li><li>NSCoding</li><li>NSCoder and NSKeyedArchiver</li><li>JSON</li><li>Plist</li><li>Other formats</li><li>Codable</li><li>Some benchmarks and comparison</li><li>NSKeyedArchiver encoding Codable</li><li>Encoding complex object graph</li><li>Codable as a replacement for NSCoding (as a conclusion)</li></ul>



<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>Serialization as a separate process</h2>



<p>Serialization is the process of translating data structures or object state into a format that can be stored or transmitted and reconstructed later (possibly in a different computer environment).</p>



<p><em>[&#8220;Deserialization&#8221; is an opposite process when you recreate your models from the serialised data. For simplicity in most cases I&#8217;ll be talking only about serialization.]</em></p>



<p>Quite often serialization is only considered as a part of archiving data on disc. For a long time we would naturally use this code to store NSArray or NSDictionary to file:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c324d871378524" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
NSURL *localURL = …
NSDictionary *someDict = …
[someDict writeToURL:localURL atomically:YES];</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c324d871378524-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c324d871378524-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c324d871378524-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c324d871378524-1"><span class="crayon-v">NSURL</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">localURL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>…</div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c324d871378524-2"><span class="crayon-v">NSDictionary</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">someDict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span>…</div><div class="crayon-line" id="crayon-5ca395d3c324d871378524-3"><span class="crayon-sy">[</span><span class="crayon-e">someDict </span><span class="crayon-v">writeToURL</span><span class="crayon-o">:</span><span class="crayon-e">localURL </span><span class="crayon-v">atomically</span><span class="crayon-o">:</span><span class="crayon-v">YES</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->




<p>You can use this ObjC API in Swift as well:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c325f557667059" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
let hosts: [String] = [
    	"host1",
    	"host2"
	]
try? (hosts as NSArray).write(to: fileUrl)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c325f557667059-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c325f557667059-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c325f557667059-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c325f557667059-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c325f557667059-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c325f557667059-1"><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">hosts</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">String</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c325f557667059-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;	</span><span class="crayon-s">"host1"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5ca395d3c325f557667059-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;	</span><span class="crayon-s">"host2"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c325f557667059-4"><span class="crayon-h">	</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5ca395d3c325f557667059-5"><span class="crayon-st">try</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">hosts </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">NSArray</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v ">write</span><span class="crayon-sy">(</span><span class="crayon-st">to</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">fileUrl</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->




<p>Here you serialise an object and store it to a file with just one line of code. Simple and handy. But there are some obvious limitations and downsides of this approach: you cannot use it for your custom classes, it doesn&#8217;t look nice in Swift with the type cast (even if you properly handle the errors). But more importantly, serialization here inextricably coupled with persisting the data.&nbsp;</p>



<p>Do you see serialization in the code snippet above? Me neither, but it&#8217;s implicitly inside.</p>



<p>Using this API you don&#8217;t control the process and you cannot adjust it. Until you take a look into the file you wrote on disc you have no idea the object was serialised into XML.</p>



<p>The most popular applications for serialization are local storing and sending the data over the internet. But there are some other cases: for instance, passing the data to a third party library or transferring it to an external device via bluetooth. The idea is that there are two (or even more) incapsulated systems separated from each other. (In case of saving/retrieving the data locally we can consider the same system in different points in time as two separate systems). One system is a transmitter, another one is a receiver. There also is a protocol, an agreed data format expected on the receiver side. Serialization is the way to convert the objects the first system uses in its operation activity into this agreed format. And then it doesn&#8217;t matter how this data supposed to be used: stored or passed somewhere; it&#8217;s another separate processes.</p>



<p>Let&#8217;s take a look at the most popular formats and different ways of handling serialization in iOS development.</p>



<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>NSCoding   </h2>



<p>NSCoding is lightweight ObjC protocol with two methods: <code>-initWithCoder:</code> and <code>encodeWithCoder:</code> which has been around since iOS 2. Your custom classes implement it to be ready for serialization/deserialization. Inside the implementation of this methods you specify how different properties of your object (the values inside these properties) are being encoded into some kind of key-value container. You describe how your object supposed to be transferred into key-value pairs.&nbsp;Eventually some coder will serialise this container to binary data.</p>



<p>The implementation of the encoding method usually looks pretty much the same:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c3268433060437" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    func encodeWithCoder(coder: NSCoder) {
        coder.encodeObject(self.name, forKey: "name")
        coder.encodeInt(Int32(self.age), forKey: "age")
        // and so on
    }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c3268433060437-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3268433060437-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c3268433060437-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3268433060437-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c3268433060437-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c3268433060437-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-e">encodeWithCoder</span><span class="crayon-sy">(</span><span class="crayon-v">coder</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">NSCoder</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3268433060437-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">coder</span><span class="crayon-sy">.</span><span class="crayon-v ">encodeObject</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v ">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"name"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c3268433060437-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">coder</span><span class="crayon-sy">.</span><span class="crayon-v ">encodeInt</span><span class="crayon-sy">(</span><span class="crayon-e">Int32</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v ">age</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"age"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3268433060437-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// and so on</span></div><div class="crayon-line" id="crayon-5ca395d3c3268433060437-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->




<p>Sometimes you might need more sophisticated way of encoding some properties, and here you have flexibility to implement pretty much whatever conversion you want. Also this way you can easily handle different versions of your custom class (with some added, changed or removed properties). But other than that it&#8217;s a lot of boilerplate code which you have to write for every data model. The bigger the model is the more code you have to write.</p>



<p>If you use conformance to NSCoding in Swift your models has to be classes (inherit NSObject&#8230; or manually implement all the NSObjectProtocol methods), which makes it impossible to use for Swift <code>structs</code> and <code>enums</code>.&nbsp;</p>



<p>Another flaw of this protocol from Swift&#8217;s perspective is its type dynamism. You basically use key-value coding when passing the values to the coder, so every value can be passed to every key. Eventually when you need to decode these values back you cannot be sure in their types, which is how ObjC works, but it costs you extra type-validation when working with this code in Swift.</p>



<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>NSCoder and NSKeyedArchiver</h2>



<blockquote class="wp-block-quote"><p>NSCoder is an abstract class that serves as the basis for objects that enable archiving and distribution of other objects. NSCoder operates on objects, scalars, C arrays, structures, and strings, and on pointers to these types.</p><cite>https://developer.apple.com/documentation/foundation/nscoder</cite></blockquote>



<p> So you will not be surprised that it has tons of methods for encoding and decoding all this types like:&nbsp;</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c3270830473400" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	func encode(Int, forKey: String)
	func encode(CMTimeRange, forKey: String)

	func decodeCGPoint(forKey: String) -&gt; CGPoint
	func decodeUIOffset(forKey: String) -&gt; UIOffset</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c3270830473400-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3270830473400-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c3270830473400-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3270830473400-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c3270830473400-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c3270830473400-1"><span class="crayon-h">	</span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-t">Int</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3270830473400-2"><span class="crayon-h">	</span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-v">CMTimeRange</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c3270830473400-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3270830473400-4"><span class="crayon-h">	</span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-e">decodeCGPoint</span><span class="crayon-sy">(</span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-e">CGPoint</span></div><div class="crayon-line" id="crayon-5ca395d3c3270830473400-5"><span class="crayon-e">	</span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-e">decodeUIOffset</span><span class="crayon-sy">(</span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">UIOffset</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->




<p>Nowadays in Foundation there is only one concrete subclass of NSCoder and that is NSKeyedArchiver (there also were NSArchiver and NSPortCoder, but they have never be available in iOS development and are deprecated now).</p>



<p>NSKeyedArchiver is an archiver class supposed to work with objects adopted NSCoding protocol. To serialise&nbsp; such object into binary data you just call</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c3276192594737" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    let data = try? NSKeyedArchiver.archivedData(withRootObject: yourObject, requiringSecureCoding: false)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c3276192594737-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c3276192594737-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-v">NSKeyedArchiver</span><span class="crayon-sy">.</span><span class="crayon-v ">archivedData</span><span class="crayon-sy">(</span><span class="crayon-v">withRootObject</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">yourObject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">requiringSecureCoding</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->




<p>NSCoding implementation of the object tells the coder how to pack object data into key-value container, and NSKeyedArchiver handles turning this container into binary data.</p>



<p>NSKeyedArchiver can be also used to serialise and automatically write output data to file (the same way as methods we started this post from):</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c327b961825580" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	NSKeyedArchiver.archiveRootObject(yourObject, toFile: fileUrl.path)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c327b961825580-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c327b961825580-1"><span class="crayon-h">	</span><span class="crayon-v">NSKeyedArchiver</span><span class="crayon-sy">.</span><span class="crayon-v ">archiveRootObject</span><span class="crayon-sy">(</span><span class="crayon-v">yourObject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">toFile</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">fileUrl</span><span class="crayon-sy">.</span><span class="crayon-v ">path</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->




<p>NSKeyedArchiver can encode data into two formats: binary (the default one) and xml. The former is much more compact, the latter is human readable and editable but takes more disc space. If you want to change the format to xml you can do it this way:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c3280563844531" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	let archiver = NSKeyedArchiver(requiringSecureCoding: false)
	archiver.outputFormat = .xml
	archiver.encodeRootObject(yourObject)
	let data = archiver.encodedData</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c3280563844531-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3280563844531-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c3280563844531-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3280563844531-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c3280563844531-1"><span class="crayon-h">	</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">archiver</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">NSKeyedArchiver</span><span class="crayon-sy">(</span><span class="crayon-v">requiringSecureCoding</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3280563844531-2"><span class="crayon-h">	</span><span class="crayon-v">archiver</span><span class="crayon-sy">.</span><span class="crayon-v ">outputFormat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-v ">xml</span></div><div class="crayon-line" id="crayon-5ca395d3c3280563844531-3"><span class="crayon-h">	</span><span class="crayon-v">archiver</span><span class="crayon-sy">.</span><span class="crayon-v ">encodeRootObject</span><span class="crayon-sy">(</span><span class="crayon-v">yourObject</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3280563844531-4"><span class="crayon-h">	</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">archiver</span><span class="crayon-sy">.</span><span class="crayon-v ">encodedData</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->




<p>You might have already noticed <code>requiringSecureCoding</code> parameter we use for NSKeyedArchiver. If we pass <code>true</code> there we assume our coder to work only with objects which adopt NSSecureCoding protocol. NSSecureCoding inherits NSCoding but also guarantees that resulting archive contains the classes it claims.&nbsp;</p>



<p>To adopt NSSecureCoding you have to add this property to your models:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c3286103320233" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	static var supportsSecureCoding: Bool {
	  return true
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c3286103320233-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3286103320233-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c3286103320233-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c3286103320233-1"><span class="crayon-h">	</span><span class="crayon-r">static</span><span class="crayon-h"> </span><span class="crayon-r">var</span><span class="crayon-h"> </span><span class="crayon-v">supportsSecureCoding</span><span class="crayon-o">:</span><span class="crayon-t"> Bool</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3286103320233-2"><span class="crayon-h">	&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span></div><div class="crayon-line" id="crayon-5ca395d3c3286103320233-3"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->




<p>If you use NSSecureCoding you have to explicitly use Foundation classes like NSString instead of String and wrap your primitives into reference types:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c328b795360170" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	aCoder.encode(self.name as NSString, forKey: "name")
	aCoder.encode(NSNumber(value: self.age), forKey: "age")</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c328b795360170-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c328b795360170-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c328b795360170-1"><span class="crayon-h">	</span><span class="crayon-v">aCoder</span><span class="crayon-sy">.</span><span class="crayon-v ">encode</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v ">name</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">NSString</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"name"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c328b795360170-2"><span class="crayon-h">	</span><span class="crayon-v">aCoder</span><span class="crayon-sy">.</span><span class="crayon-v ">encode</span><span class="crayon-sy">(</span><span class="crayon-e">NSNumber</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v ">age</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">"age"</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->




<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>JSON</h2>



<p>The most popular format nowadays is JSON. Up to iOS 5/macOS 10.7 Foundation didn&#8217;t have a built-in functionality to parse JSON, so there were several different third party libs for that (check out the <a href="http://awesomeios.com/#json">list here</a>). Finally NSJSONSerialization class appeared and took it over.</p>



<p>In iOS serialization chain for encoding your custom objects to JSON data looks like this:</p>



<figure class="wp-block-image"><img data-attachment-id="205" data-permalink="https://dmtopolog.com/object-serialization-in-ios/objecttojson/" data-orig-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=1383%2C183&amp;ssl=1" data-orig-size="1383,183" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ObjectToJSON" data-image-description data-medium-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=300%2C40&amp;ssl=1" data-large-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=688%2C91&amp;ssl=1" src="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=688%2C91&amp;ssl=1" alt class="wp-image-205 jetpack-lazy-image" data-lazy-srcset="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?w=1383&amp;ssl=1 1383w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?resize=300%2C40&amp;ssl=1 300w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?resize=768%2C102&amp;ssl=1 768w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?resize=1024%2C135&amp;ssl=1 1024w" data-lazy-sizes="(max-width: 688px) 100vw, 688px" data-lazy-src="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=688%2C91&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img data-attachment-id="205" data-permalink="https://dmtopolog.com/object-serialization-in-ios/objecttojson/" data-orig-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=1383%2C183&amp;ssl=1" data-orig-size="1383,183" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ObjectToJSON" data-image-description="" data-medium-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=300%2C40&amp;ssl=1" data-large-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=688%2C91&amp;ssl=1" src="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?fit=688%2C91&amp;ssl=1" alt="" class="wp-image-205" srcset="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?w=1383&amp;ssl=1 1383w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?resize=300%2C40&amp;ssl=1 300w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?resize=768%2C102&amp;ssl=1 768w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/ObjectToJSON.png?resize=1024%2C135&amp;ssl=1 1024w" sizes="(max-width: 688px) 100vw, 688px" /></noscript></figure>



<p>NSJSONSerialization offers only the second part &#8211; serialization from NSDictionaty/NSArray to JSON, so you still need to do the mapping from your custom object to NSDictionary. The class is straightforward and supposed to be used like this:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c3291729759147" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    NSDictionary *objectDict = @{
                             @"name" : @"John Smith",
                             @"age" : @(34),
                             @"gender" : @"male"
                             };
    NSError *error;
    NSData *jsonData = [NSJSONSerialization dataWithJSONObject:objectDict options:kNilOptions error:&amp;amp;error];</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c3291729759147-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3291729759147-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c3291729759147-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3291729759147-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c3291729759147-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3291729759147-6">6</div><div class="crayon-num" data-line="crayon-5ca395d3c3291729759147-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c3291729759147-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">NSDictionary</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">objectDict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3291729759147-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">@</span><span class="crayon-s">"name"</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-s">"John Smith"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5ca395d3c3291729759147-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">@</span><span class="crayon-s">"age"</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">(</span><span class="crayon-cn">34</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3291729759147-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">@</span><span class="crayon-s">"gender"</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-s">"male"</span></div><div class="crayon-line" id="crayon-5ca395d3c3291729759147-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3291729759147-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">NSError</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">error</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ca395d3c3291729759147-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">NSData</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">jsonData</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">NSJSONSerialization </span><span class="crayon-v">dataWithJSONObject</span><span class="crayon-o">:</span><span class="crayon-e">objectDict </span><span class="crayon-v">options</span><span class="crayon-o">:</span><span class="crayon-e">kNilOptions </span><span class="crayon-v">error</span><span class="crayon-o">:</span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-v">error</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->




<p>As I mentioned the root object of the tree we aim to encode can be NSDictionaty or NSArray only. But there are some other limitation for using NSJSONSerialization:</p>



<ul><li>all objects are instances of NSString, NSNumber, NSArray, NSDictionary, or NSNull.</li><li>all dictionary keys are instances of NSString.</li><li>Numbers are not NaN or infinity.</li></ul>



<p>There are some options you can pass to NSJSONSerialization for encoding and decoding data:</p>



<p>1. Encoding (NSJSONWritingOptions):</p>



<ul><li>PrettyPrinted &#8211; using white space and indentation to make the output more readable (adding some extra bytes to resulting data)</li><li>SortedKeys &#8211; sorting keys in lexicographic order</li></ul>



<p>2. Decoding (NSJSONReadingOptions):</p>



<ul><li>MutableContainers &#8211; arrays and dictionaries are created as mutable objects</li><li>MutableLeaves &#8211; strings are created as instances of NSMutableString.</li><li>AllowFragments &#8211; tells the parser to allow top-level objects that are not an instance of NSArray or NSDictionary.</li></ul>



<p>If you don&#8217;t want to specify any options you can pass <code>kNilOptions</code>-constant in ObjC code or an empty array in Swift.&nbsp;</p>



<p>Back to our serialization chain: with NSJSONSerialization we still need to map our custom objects into arrays and dictionaries. For that purpose you would sometimes use manual key-value mapping inside your model object:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c3299285223808" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	- (NSDictionary *)jsonDict {
	    return @{
	             @"name" : self.name,
	             @"age" : @(self.age),
	             @"gender" : self.gender
	             };
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c3299285223808-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3299285223808-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c3299285223808-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3299285223808-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c3299285223808-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c3299285223808-6">6</div><div class="crayon-num" data-line="crayon-5ca395d3c3299285223808-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c3299285223808-1"><span class="crayon-h">	</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">NSDictionary</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-sy">)</span><span class="crayon-e">jsonDict</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3299285223808-2"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ca395d3c3299285223808-3"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">@</span><span class="crayon-s">"name"</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v ">name</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3299285223808-4"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">@</span><span class="crayon-s">"age"</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v ">age</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5ca395d3c3299285223808-5"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">@</span><span class="crayon-s">"gender"</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v ">gender</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c3299285223808-6"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ca395d3c3299285223808-7"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->




<p>But it&#8217;s also possible to automate it using class inspection in ObjC runtime.</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c329e475026262" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	#import &amp;lt;objc/runtime.h&gt;
	...
	unsigned int outCount, i;
	objc_property_t *properties = class_copyPropertyList([self class], &amp;amp;outCount);
	for(i = 0; i &amp;lt; outCount; i++) {
	    objc_property_t property = properties[i];
	    fprintf(stdout, "%s %s\n", property_getName(property), property_getAttributes(property));
	}
	free(properties);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c329e475026262-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c329e475026262-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c329e475026262-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c329e475026262-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c329e475026262-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c329e475026262-6">6</div><div class="crayon-num" data-line="crayon-5ca395d3c329e475026262-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c329e475026262-8">8</div><div class="crayon-num" data-line="crayon-5ca395d3c329e475026262-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c329e475026262-1"><span class="crayon-h">	</span><span class="crayon-o">#</span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-v">objc</span><span class="crayon-o">/</span><span class="crayon-v">runtime</span><span class="crayon-sy">.</span><span class="crayon-v ">h</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c329e475026262-2"><span class="crayon-h">	</span><span class="crayon-o">...</span></div><div class="crayon-line" id="crayon-5ca395d3c329e475026262-3"><span class="crayon-h">	</span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">outCount</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c329e475026262-4"><span class="crayon-h">	</span><span class="crayon-v">objc_property_t</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">properties</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">class_copyPropertyList</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-r">class</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-v">outCount</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ca395d3c329e475026262-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">outCount</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c329e475026262-6"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">objc_property_t </span><span class="crayon-v">property</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">properties</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ca395d3c329e475026262-7"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">fprintf</span><span class="crayon-sy">(</span><span class="crayon-v">stdout</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"%s %s\n"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">property_getName</span><span class="crayon-sy">(</span><span class="crayon-v">property</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">property_getAttributes</span><span class="crayon-sy">(</span><span class="crayon-v">property</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c329e475026262-8"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ca395d3c329e475026262-9"><span class="crayon-h">	</span><span class="crayon-e">free</span><span class="crayon-sy">(</span><span class="crayon-v">properties</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0022 seconds] -->




<p>Here we get a list of all the properties of a given class with some attributes including the property type. So we can generalise the algorithm to serialise every object into JSON data. Optionally we can use some mapping tables and transformations if exact keys or values of the object properties are not what we want to see in JSON. There are a number of libraries out there successfully using this approach (I had a pleasant experience using <a href="https://github.com/jsonmodel/jsonmodel">JSONModel</a>).</p>



<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>Plist</h2>



<p>Plist (from &#8220;property list&#8221;) is a structured way to represent and persist a single object or an object tree. The format has appeared in NeXTSTEP operation system and made its way through decades to contemporary macOS/iOS ecosystem.</p>



<p>Generally plist serialization in Foundation world looks like JSON serialization. We have NSPropertyListSerialization (PropertyListSerialization when calling from Swift) which is being around since macOS 10.2/iOS 2. The class &#8211; an older brother of NSJSONSerialization &#8211; makes conversion between plist (which is represented in memory by instance of NSDictionary or NSArray) and binary data (represented by NSData).</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c32a5246279635" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    NSError *error;
    NSPropertyListFormat format;
    id plist = [NSPropertyListSerialization propertyListWithData: data options: NSPropertyListImmutable format: &amp;amp;format error: &amp;amp;error]; </textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c32a5246279635-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32a5246279635-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c32a5246279635-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c32a5246279635-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">NSError</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">error</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32a5246279635-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">NSPropertyListFormat </span><span class="crayon-v">format</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ca395d3c32a5246279635-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">id </span><span class="crayon-v">plist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">NSPropertyListSerialization </span><span class="crayon-v">propertyListWithData</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">data </span><span class="crayon-v">options</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">NSPropertyListImmutable </span><span class="crayon-v">format</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-e">format </span><span class="crayon-v">error</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-v">error</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->




<p>NSPropertyListSerialization works only with limited amount of Foundation classes: NSData, NSString, NSArray, NSDictionary, NSDate, and NSNumber. If an instance of some other class is inside the dictionary or array you want to encode serialization will fail. &nbsp;</p>



<p>Property list can be encoded/decoded in two formats: xml (<code>NSPropertyListXMLFormat_v1_0</code>) or binary data (<code>NSPropertyListBinaryFormat_v1_0</code>) with their pros and cons (pretty much the same as for NSKeyedArchiever). There is one more format &#8211; OpenStep (<code>NSPropertyListOpenStepFormat</code>) which is deprecated now and available only for reading.</p>



<p><em>(</em><a href="https://medium.com/@karaiskc/understanding-apples-binary-property-list-format-281e6da00dbd"><em>Here</em></a><em> you can find some details about the structure of plist binary format)</em></p>



<p>There is an &#8216;options&#8217; parameter in both serialising and deserialising calls. It has to do with mutability. When you deserialise an object from plist data you can tell serialiser if you wan to have mutable containers &#8211; NSPropertyListMutableContainers value. If you pass NSPropertyListMutableContainersAndLeaves serialiser will try to make all the values mutable if the value class has its mutable counterpart.</p>



<p>When serialising objects to binary data you cannot save mutability info of your objects, so <code>options</code> parameter makes no sense and you would always pass <code>0</code>.</p>



<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>Codable</h2>



<p>All these APIs for serialization were good enough for ObjC but had some significant limitations for Swift. I&#8217;ve already mentioned that NSCoding cannot work with swift native structs and enums (although developers came up with <a href="http://swiftandpainless.com/nscoding-and-swift-structs/">some workarounds</a>), and if you want to use it in swift classes you have to make them visible in ObjC. Also all the serialization APIs are needed to be adjusted for Swift&#8217;s strong type safety. So creating some tools for serialisation in a standard library was the matter of time.</p>



<p>Codable (which unites Encodable and Decodable protocols) was implemented in Swift 4 and made developers&#8217; lives much easier.&nbsp;</p>



<p>As till Swift 4 there were no built-in native solution for data serialization, plenty of third party libraries appeared to fill this gap in. In <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0166-swift-archival-serialization.md">swift-evolution proposal for Codable</a> the authors reason that out of these solutions (for JSON parsing specifically) there is none which is both easy to use/implement and type safe enough.</p>



<p>It&#8217;s not explicitly said in the proposal but obviously the ability to generate Codable implementation by compiler, moving this workload from a developer, is a significant benefit of the approach we eventually have seen implemented.</p>



<p>Each protocol (Encodable/Decodable) consist of just one required method. The great news is that if all the object&#8217;s properties conform to Codable themselves the compiler will be able to generate the implementation for the object. If the condition isn&#8217;t met or you need some additional customisation you can write the methods manually. For Encodable it will look like this:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c32af149994884" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	func encode(to encoder: Encoder) throws {
    	var container = encoder.container(keyedBy: CodingKeys.self)
    	try container.encode(someObjectProperty, forKey: CodingKeys.someKey)
    	// handling all the object's properties
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c32af149994884-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32af149994884-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c32af149994884-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32af149994884-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c32af149994884-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c32af149994884-1"><span class="crayon-h">	</span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Encoder</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32af149994884-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;	</span><span class="crayon-r">var</span><span class="crayon-h"> </span><span class="crayon-v">container</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-sy">.</span><span class="crayon-v ">container</span><span class="crayon-sy">(</span><span class="crayon-v">keyedBy</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">CodingKeys</span><span class="crayon-sy">.</span><span class="crayon-r">self</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c32af149994884-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;	</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">container</span><span class="crayon-sy">.</span><span class="crayon-v ">encode</span><span class="crayon-sy">(</span><span class="crayon-v">someObjectProperty</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">CodingKeys</span><span class="crayon-sy">.</span><span class="crayon-v ">someKey</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32af149994884-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;	</span><span class="crayon-c">// handling all the object's properties</span></div><div class="crayon-line" id="crayon-5ca395d3c32af149994884-5"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->




<p>Basically that&#8217;s the same code as the one generate by the compiler for you.</p>



<p>By making your object conform to this protocols you get an ability to decode them to both JSON and plist format out of the box &#8211; just pick a corresponding encoder.</p>



<p>Encoder is an object which does the actual serialization for the model object. There are two built-in encoders: JSONEncoder and PropertyListEncoder for corresponding formats. All the system is protocol based and there are specific Encoder/Decoder protocols so it&#8217;s possible to implement your own coders for another formats which can work with all Codable models (<a href="https://www.mikeash.com/pyblog/friday-qa-2017-07-28-a-binary-coder-for-swift.html">an example from Mike Ash</a>).</p>



<p>The usage of built-in encoders (as well as decoders) is trivial (as far as your yourCustomObject conforms to Codable):</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c32b6709940894" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
let jsonData = try JSONEncoder().encode(yourCustomObject)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c32b6709940894-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c32b6709940894-1"><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">jsonData</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-e">JSONEncoder</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v ">encode</span><span class="crayon-sy">(</span><span class="crayon-v">yourCustomObject</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->




<p>This way we have ent-to-end serialization from your custom object right into the binary data.</p>



<p>If you take a look inside Swift source code you will see that JSONEncoder uses the same NSJSONSerialization from Foundation (which is called JSONSerialization when being used from swift) that I&#8217;ve mentioned before. JSONEncoder uses Encodable implementation of a model object as an instruction how to wrap all its properties into NSObjects. Then it puts them to a container (which is actually an array of NSObjects) and passes the container to JSONSerialization for the conversion into binary data. So basically JSONEncoder utilise Encodable implementation to map your custom objects into a data structure which can be used by good old NSJSONSerialization. So Swift safely and elegantly does the same that we developers had been doing before: performs some kind of mapping for custom model&#8217;s properties into a Foundation-based container and then uses NSJSONSerialization.&nbsp;</p>



<p>The same is fair for PropertyListEncoder as well.</p>



<p><em>(If you want to read in details about complex use cases for Codable/Encodable/Decodable and all the capabilities of JSONEncoder I refer you to </em><a href="https://benscheirman.com/2017/06/swift-json/"><em>this</em></a><em> or </em><a href="https://www.hackingwithswift.com/articles/119/codable-cheat-sheet"><em>this</em></a><em> posts)</em></p>



<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>Some benchmarks and comparison</h2>



<p>It&#8217;s hard to fairly compare all the different approaches regarding their speed or resulting data size because originally they serve completely different needs.</p>



<p>NSKeyedArchiver (as well as NSArchiever before) suppose to deal with complex object graphs. It takes into consideration such things like multiple references to the same object, object replacement, calling each object&#8217;s <code>encodeWithCoder()</code> method, object graphs, and so on.  If you use binary output it also takes some extra effort to make the output smaller than it would otherwise be. So no surprise it takes a lot of time for NSKeyedArchiver to serialise a custom object or object graph.</p>



<p>JSON/Plist serialisers originally would work only with dictionary or array and some small set of predefined Foundation types. It makes the life of an encoder much easier so it can spend less time and be more efficient in disc space.</p>



<p>Talking about the size of output data, JSON is the most compact format out of these three and plist is a bit more verbose one (2-4 times difference). The output of NSKeyedArchiever with all the metadata it provides can take up to 10 times more disc space than JSON. But usual eventual use case for NSKeyedArchiever&#8217;s serialization is data persistence, so here the proper data structure is more important than the occupied space.</p>



<p>When talking about ObjC the comparison may only be done for NSDictionary or NSArray (JSON/Plist serialisers don&#8217;t work with custom types) and the results are more or less predictable: JSON is the most compact format, JSON and plist are both quite speed efficient and NSKeyedArchiver sucks (you can find <a href="https://holtwick.de/blog/serialization">one of the benchmarks here</a>)</p>



<p>But in Swift we are able to use all these 3 encoders for our custom classes conforming Codable so the conditions are equal for all of them.</p>



<p>I did <a href="https://gist.github.com/DmIvanov/ead75141ebb6dc24b5820f7c5e4a3749">a trivial benchmark</a> myself to check how the things really are. After I took a look at the results for Swift I decided to include Obj encoding as well for custom objects. All the tests are done for small objects.</p>



<p>Here are the results:</p>



<figure class="wp-block-image"><img data-attachment-id="208" data-permalink="https://dmtopolog.com/object-serialization-in-ios/serialization_benchmark_chart/" data-orig-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=1590%2C1162&amp;ssl=1" data-orig-size="1590,1162" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="serialization_benchmark_chart" data-image-description data-medium-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=300%2C219&amp;ssl=1" data-large-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=688%2C503&amp;ssl=1" src="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=688%2C503&amp;ssl=1" alt class="wp-image-208 jetpack-lazy-image" data-lazy-srcset="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?w=1590&amp;ssl=1 1590w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?resize=300%2C219&amp;ssl=1 300w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?resize=768%2C561&amp;ssl=1 768w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?resize=1024%2C748&amp;ssl=1 1024w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?w=1376&amp;ssl=1 1376w" data-lazy-sizes="(max-width: 688px) 100vw, 688px" data-lazy-src="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=688%2C503&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img data-attachment-id="208" data-permalink="https://dmtopolog.com/object-serialization-in-ios/serialization_benchmark_chart/" data-orig-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=1590%2C1162&amp;ssl=1" data-orig-size="1590,1162" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="serialization_benchmark_chart" data-image-description="" data-medium-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=300%2C219&amp;ssl=1" data-large-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=688%2C503&amp;ssl=1" src="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?fit=688%2C503&amp;ssl=1" alt="" class="wp-image-208" srcset="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?w=1590&amp;ssl=1 1590w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?resize=300%2C219&amp;ssl=1 300w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?resize=768%2C561&amp;ssl=1 768w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?resize=1024%2C748&amp;ssl=1 1024w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/serialization_benchmark_chart.png?w=1376&amp;ssl=1 1376w" sizes="(max-width: 688px) 100vw, 688px" /></noscript></figure>



<p><strong>Serialization in Swift.&nbsp;</strong></p>



<ul><li>NSKeyedArchiver is the slowest one &#8211; let&#8217;s remember that the ability to handle Codable was added just for compatibility to this ObjC API. JSONEncoder/PropertyListEncoder which are native for Codable do the job faster.</li><li>Plist serialization is slower than JSON serialization. But for binary plist format the difference is almost negligible. Binary plist is considered as &#8220;not human readable&#8221;, but basically it&#8217;s just the matter of application you use to open the file. JSON is also not readable until you open it in a text editor 😉</li><li>Serialization into binary format takes more time than XML for both plist serialiser and keyed archiver. Don&#8217;t forget that the archiver puts more metadata to the output XML, so its output file is much bigger.</li></ul>



<p><strong>Serialization in ObjC:</strong></p>



<ul><li>Here <strong>we don&#8217;t compare NSKeyedArchiver with JSON/Plist serialisers</strong> for custom objects. For serialisers I used manual mapping (object property -> dictionary key) which is way faster than general archiver&#8217;s approach with key-value container. So for JSON/Plist we still serialise dictionary instead of the object.</li><li>Comparing JSON with plist serialization we see that the former is twice faster than the latter.</li><li> We can see that there is no significant difference between binary and XML formats for both plist serialiser and keyed archiver.</li></ul>



<p><strong>Comparing Swift and ObjC:</strong></p>



<ul><li>I put JSON/Plist serialization for ObjC and Swift next to each other to show how big is encoding work of Codable implementation (the difference between the ObjC and Swift bars for each type) and how fast is actual work of ObjC serialisers (which is common for both languages)</li><li>Check out NSKeyedArchiver: It&#8217;s not surprising that Swift is slower here as well, keyed archiver is completely an ObjC API. </li></ul>



<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>NSKeyedArchiver working with Codable</h2>



<p>After Codable was introduces the necessity to use NSKeyedArchiver from Swift almost disappeared. Now to store some custom object on disk with an equal effort you can use JSONEncoder or PropertyListEncoder for serialization. NSKeyedArchiver is not the main coder for serialising custom objects anymore. But if you want to use it with models conforming to Codable you can do it (without implementing NSCoding protocol methods). Swift team specifically introduced two new methods for NSKeyedArchiver to make it work with Codable:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c32c4630101786" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	// These are provided in the Swift overlay, and included in swift-corelibs-foundation.
	extension NSKeyedArchiver {
	    public func encodeCodable(_ codable: Encodable?, forKey key: String) { ... }
	}

	extension NSKeyedUnarchiver {
	    public func decodeCodable&amp;lt;T : Decodable&gt;(_ type: T.Type, forKey key: String) -&gt; T? { ... }
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c32c4630101786-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32c4630101786-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c32c4630101786-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32c4630101786-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c32c4630101786-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32c4630101786-6">6</div><div class="crayon-num" data-line="crayon-5ca395d3c32c4630101786-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32c4630101786-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c32c4630101786-1"><span class="crayon-h">	</span><span class="crayon-c">// These are provided in the Swift overlay, and included in swift-corelibs-foundation.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32c4630101786-2"><span class="crayon-h">	</span><span class="crayon-r">extension</span><span class="crayon-h"> </span><span class="crayon-e">NSKeyedArchiver</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ca395d3c32c4630101786-3"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">public </span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-e">encodeCodable</span><span class="crayon-sy">(</span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-v">codable</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Encodable</span><span class="crayon-sy">?</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">forKey </span><span class="crayon-v">key</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-o">...</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32c4630101786-4"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ca395d3c32c4630101786-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32c4630101786-6"><span class="crayon-h">	</span><span class="crayon-r">extension</span><span class="crayon-h"> </span><span class="crayon-e">NSKeyedUnarchiver</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ca395d3c32c4630101786-7"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">public </span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-v">decodeCodable</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-v">T</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Decodable</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-r">type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">T</span><span class="crayon-sy">.</span><span class="crayon-r">Type</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">forKey </span><span class="crayon-v">key</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-e">T</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-o">...</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32c4630101786-8"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->




<p>For encoding the root object you would use an encoding method like this:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c32ca615452704" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	do {
	    let archiver = NSKeyedArchiver(requiringSecureCoding: false)
	    archiver.outputFormat = .binary
	    try archiver.encodeEncodable(yourObject, forKey: NSKeyedArchiveRootObjectKey)
	    archiver.finishEncoding()

	    // then you can use encoded data
	    try archiver.encodedData.write(to: fileUrl)
	} catch {
	    print("Couldn't write file: \(error)")
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c32ca615452704-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32ca615452704-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c32ca615452704-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32ca615452704-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c32ca615452704-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32ca615452704-6">6</div><div class="crayon-num" data-line="crayon-5ca395d3c32ca615452704-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32ca615452704-8">8</div><div class="crayon-num" data-line="crayon-5ca395d3c32ca615452704-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32ca615452704-10">10</div><div class="crayon-num" data-line="crayon-5ca395d3c32ca615452704-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c32ca615452704-1"><span class="crayon-h">	</span><span class="crayon-st">do</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32ca615452704-2"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">archiver</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">NSKeyedArchiver</span><span class="crayon-sy">(</span><span class="crayon-v">requiringSecureCoding</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c32ca615452704-3"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">archiver</span><span class="crayon-sy">.</span><span class="crayon-v ">outputFormat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-v ">binary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32ca615452704-4"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">archiver</span><span class="crayon-sy">.</span><span class="crayon-v ">encodeEncodable</span><span class="crayon-sy">(</span><span class="crayon-v">yourObject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">NSKeyedArchiveRootObjectKey</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c32ca615452704-5"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">archiver</span><span class="crayon-sy">.</span><span class="crayon-v ">finishEncoding</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32ca615452704-6">&nbsp;</div><div class="crayon-line" id="crayon-5ca395d3c32ca615452704-7"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// then you can use encoded data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32ca615452704-8"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">archiver</span><span class="crayon-sy">.</span><span class="crayon-v ">encodedData</span><span class="crayon-sy">.</span><span class="crayon-v ">write</span><span class="crayon-sy">(</span><span class="crayon-st">to</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">fileUrl</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c32ca615452704-9"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32ca615452704-10"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Couldn't write file: <span class="crayon-sy">\</span><span class="crayon-sy">(</span><span class="crayon-v">error</span><span class="crayon-sy">)</span>"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c32ca615452704-11"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->




<p>Another case is when you want to encode the root object with let&#8217;s say JSONEncoder. This object almost conforms to Codable, but it has just one property of a legacy ObjC class which cannot adopt Codable. So your option is to manually implement Codable&#8217;s encode() method where you use NSKeyedArchiver for converting this legacy property to binary data:</p>



<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5ca395d3c32cf313738259" class="crayon-syntax crayon-theme-xcode crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Swift</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	struct Person: Codable {

	    let name: String
	    let workHistory: WorkHistory // cannot be extended to adopt Codable, but conforms to NSCoding

	    enum CodingKeys: String, CodingKey {
	        case name
	        case workHistory
	    }

	    func encode(to encoder: Encoder) throws {
	        var container = encoder.container(keyedBy: CodingKeys.self)
	        try container.encode(name, forKey: .name)
	        let workHistoryData = try NSKeyedArchiver.archivedData(withRootObject: workHistory, requiringSecureCoding: false)
	        try container.encode(workHistoryData, forKey: .workHistory)
	    }

	    init(from decoder: Decoder) throws {
	        let container = try decoder.container(keyedBy: CodingKeys.self)
	        name = try container.decode(String.self, forKey: .name)
	        let workHistoryData = try container.decode(Data.self, forKey: .workHistory)
	        workHistory = try NSKeyedUnarchiver.unarchiveTopLevelObjectWithData(workHistoryData) as! WorkHistory
	    }
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-2">2</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-4">4</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-6">6</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-8">8</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-10">10</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-12">12</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-14">14</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-16">16</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-18">18</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-20">20</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-22">22</div><div class="crayon-num" data-line="crayon-5ca395d3c32cf313738259-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ca395d3c32cf313738259-24">24</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-1"><span class="crayon-h">	</span><span class="crayon-r">struct</span><span class="crayon-h"> </span><span class="crayon-v">Person</span><span class="crayon-o">:</span><span class="crayon-t"> Codable</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-2">&nbsp;</div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-3"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">String</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-4"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">workHistory</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">WorkHistory</span><span class="crayon-h"> </span><span class="crayon-c">// cannot be extended to adopt Codable, but conforms to NSCoding</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-6"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">enum</span><span class="crayon-h"> </span><span class="crayon-v">CodingKeys</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CodingKey</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-7"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-e">name</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-8"><span class="crayon-e">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">workHistory</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-9"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-10">&nbsp;</div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-11"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">func</span><span class="crayon-h"> </span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Encoder</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-12"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">var</span><span class="crayon-h"> </span><span class="crayon-v">container</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-sy">.</span><span class="crayon-v ">container</span><span class="crayon-sy">(</span><span class="crayon-v">keyedBy</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">CodingKeys</span><span class="crayon-sy">.</span><span class="crayon-r">self</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-13"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">container</span><span class="crayon-sy">.</span><span class="crayon-v ">encode</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-v ">name</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-14"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">workHistoryData</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">NSKeyedArchiver</span><span class="crayon-sy">.</span><span class="crayon-v ">archivedData</span><span class="crayon-sy">(</span><span class="crayon-v">withRootObject</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">workHistory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">requiringSecureCoding</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-15"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">container</span><span class="crayon-sy">.</span><span class="crayon-v ">encode</span><span class="crayon-sy">(</span><span class="crayon-v">workHistoryData</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-v ">workHistory</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-16"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-18"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">init</span><span class="crayon-sy">(</span><span class="crayon-e">from </span><span class="crayon-v">decoder</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Decoder</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-19"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">container</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">decoder</span><span class="crayon-sy">.</span><span class="crayon-v ">container</span><span class="crayon-sy">(</span><span class="crayon-v">keyedBy</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">CodingKeys</span><span class="crayon-sy">.</span><span class="crayon-r">self</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-20"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">container</span><span class="crayon-sy">.</span><span class="crayon-v ">decode</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-sy">.</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-v ">name</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-21"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">let</span><span class="crayon-h"> </span><span class="crayon-v">workHistoryData</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">container</span><span class="crayon-sy">.</span><span class="crayon-v ">decode</span><span class="crayon-sy">(</span><span class="crayon-v">Data</span><span class="crayon-sy">.</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forKey</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-v ">workHistory</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-22"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">workHistory</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-v">NSKeyedUnarchiver</span><span class="crayon-sy">.</span><span class="crayon-v ">unarchiveTopLevelObjectWithData</span><span class="crayon-sy">(</span><span class="crayon-v">workHistoryData</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-o">!</span><span class="crayon-h"> </span><span class="crayon-v">WorkHistory</span></div><div class="crayon-line" id="crayon-5ca395d3c32cf313738259-23"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ca395d3c32cf313738259-24"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0059 seconds] -->




<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>Other formats</h2>



<p>Of course JSON and Plist are not the only formats available out there. So there are some other serialization approach specified for different needs</p>



<p>For platform-agnostic data exchange over the network there are some alternatives like <a href="https://developers.google.com/protocol-buffers/">Protobuf</a> or <a href="https://msgpack.org/">MessagePack</a> which claimed to be better in various different metrics (protobuf even has <a href="https://github.com/apple/swift-protobuf">an official Swift library</a>).</p>



<p>For local data persistence there is <a href="https://github.com/nicklockwood/FastCoding">FastCoding</a>.</p>



<p>There also are some other popular protocols which are not ported to Cocoa platforms yet like <a href="https://thrift.apache.org/">Apache Thrift</a> from Facebook or <a href="https://google.github.io/flatbuffers/">FlatBuffers</a> from Google.</p>



<p>Personally I didn&#8217;t have a chance to use any of them in production so I just mention them as possible alternatives. You can find a lot of information about the formats, libraries to handle them and use cases where it makes sense to look into these alternatives.</p>



<div style="height:100px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>Encoding complex object graph</h2>



<p>Quite frequent use case for serialization is persistence of complex object graphs on disk. (For example <a href="https://nshipster.com/nscoding/">in&nbsp;this&nbsp;NSHipster&#8217;s post</a> Mattt considers NSCoding/NSKeyed​Archiver as a valid alternative to Core Data.)</p>



<p>All the mentioned encoders easily handle not only simple objects, but also quite a complex object trees with lots of nested items. But if you want to encode a complex graph it&#8217;s another task with several additional complications.</p>



<p>Talking about &#8220;complex graphs&#8221; I mean a structure which has at least one of these conditions:</p>



<ul><li>Several references to one object</li><li>Cyclic references between objects</li></ul>



<div class="wp-block-image"><figure class="aligncenter"><img data-attachment-id="209" data-permalink="https://dmtopolog.com/object-serialization-in-ios/graph_severalreferences/" data-orig-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=2283%2C1083&amp;ssl=1" data-orig-size="2283,1083" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph_severalReferences" data-image-description data-medium-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=300%2C142&amp;ssl=1" data-large-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=688%2C327&amp;ssl=1" src="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=688%2C327&amp;ssl=1" alt class="wp-image-209 jetpack-lazy-image" data-lazy-srcset="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?w=2283&amp;ssl=1 2283w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?resize=300%2C142&amp;ssl=1 300w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?resize=768%2C364&amp;ssl=1 768w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?resize=1024%2C486&amp;ssl=1 1024w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?resize=1600%2C759&amp;ssl=1 1600w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?w=1376&amp;ssl=1 1376w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?w=2064&amp;ssl=1 2064w" data-lazy-sizes="(max-width: 688px) 100vw, 688px" data-lazy-src="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=688%2C327&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img data-attachment-id="209" data-permalink="https://dmtopolog.com/object-serialization-in-ios/graph_severalreferences/" data-orig-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=2283%2C1083&amp;ssl=1" data-orig-size="2283,1083" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph_severalReferences" data-image-description="" data-medium-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=300%2C142&amp;ssl=1" data-large-file="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=688%2C327&amp;ssl=1" src="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?fit=688%2C327&amp;ssl=1" alt="" class="wp-image-209" srcset="https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?w=2283&amp;ssl=1 2283w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?resize=300%2C142&amp;ssl=1 300w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?resize=768%2C364&amp;ssl=1 768w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?resize=1024%2C486&amp;ssl=1 1024w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?resize=1600%2C759&amp;ssl=1 1600w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?w=1376&amp;ssl=1 1376w, https://i1.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_severalReferences.png?w=2064&amp;ssl=1 2064w" sizes="(max-width: 688px) 100vw, 688px" /></noscript><figcaption>Several references to the same object<br></figcaption></figure></div>



<p>If the graph has several references to the same object inside itself the problem is to consider uniqueness of the object. The encoder has to have some table of occurred object for not to encode the same object several times. If an object is passed to the encoder more than once it should encode only a reference. Eventually when the archive is decoded back and the graph is rebuild there should be references to the same instance, but not several different objects.</p>



<div class="wp-block-image"><figure class="aligncenter"><img data-attachment-id="210" data-permalink="https://dmtopolog.com/object-serialization-in-ios/graph_cyclicreferences/" data-orig-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=2088%2C1143&amp;ssl=1" data-orig-size="2088,1143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph_cyclicReferences" data-image-description data-medium-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=300%2C164&amp;ssl=1" data-large-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=688%2C377&amp;ssl=1" src="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=688%2C377&amp;ssl=1" alt class="wp-image-210 jetpack-lazy-image" data-lazy-srcset="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?w=2088&amp;ssl=1 2088w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?resize=300%2C164&amp;ssl=1 300w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?resize=768%2C420&amp;ssl=1 768w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?resize=1024%2C561&amp;ssl=1 1024w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?resize=1600%2C876&amp;ssl=1 1600w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?w=1376&amp;ssl=1 1376w" data-lazy-sizes="(max-width: 688px) 100vw, 688px" data-lazy-src="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=688%2C377&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img data-attachment-id="210" data-permalink="https://dmtopolog.com/object-serialization-in-ios/graph_cyclicreferences/" data-orig-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=2088%2C1143&amp;ssl=1" data-orig-size="2088,1143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Graph_cyclicReferences" data-image-description="" data-medium-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=300%2C164&amp;ssl=1" data-large-file="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=688%2C377&amp;ssl=1" src="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?fit=688%2C377&amp;ssl=1" alt="" class="wp-image-210" srcset="https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?w=2088&amp;ssl=1 2088w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?resize=300%2C164&amp;ssl=1 300w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?resize=768%2C420&amp;ssl=1 768w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?resize=1024%2C561&amp;ssl=1 1024w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?resize=1600%2C876&amp;ssl=1 1600w, https://i0.wp.com/dmtopolog.com/wp-content/uploads/2019/01/Graph_cyclicReferences.png?w=1376&amp;ssl=1 1376w" sizes="(max-width: 688px) 100vw, 688px" /></noscript><figcaption>Cyclic references between objects</figcaption></figure></div>



<p>If the graph has objects referencing each other, it&#8217;s tricky for the encoder. If it doesn&#8217;t consider this possible cycles and blindly follows every link of every object it would go to an infinite loop.</p>



<p>Another complication for complex structures is that it might be not always appropriate to archive the entire graph. A good example is a view hierarchy. A view has many links to other objects: models, subviews, superviews, formatters, targets, gesture recognisers, and so on. If the view encoded all of its references to these objects, the entire application would get pulled in. Some objects are more important than others, though. A view’s subviews always should be archived, but not necessarily its superview. In this case, the superview is considered an extraneous part of the graph; a view can exist without its superview, but not its subviews. A view, however, needs to keep a reference to its superview, if the superview is also being encoded in the archive.</p>



<p>All this problems are considered in NSCoder&#8217;s API and its concrete implementation &#8211; NSKeyedArchiver.&nbsp; Uniqueness of the objects is controlled within the context of one graph encoding which is opened by calling <code>encodeRootObject:</code>. Multiple and circular references are also being properly managed: no infinite loops and only one instance of each object.</p>



<p>NSKeyedArchiver has a set of other useful things like default values for missing keys, type coercions or an ability to substitute objects. You can read more of that here (https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Archiving/Articles/archives.html)</p>



<p>Unfortunately most of that NSKeyedArchiver&#8217;s benefits work only for objects adopting NSCoding protocol. Neither reference control nor cyclic dependencies resolving doesn&#8217;t work for Codable.</p>



<p>Moreover Codable models behave the same with JSONEncoder and PropertyListEncoder, having the same issues if talking about complex graphs. So currently for Codable there is no built-in solution for this problem.</p>



<p>Swift team assured that this functionality was in the plan for Codable from the beginning, but they didn&#8217;t have time to accomplish it in time for Swift 4 release. The main difficulty has to do with Swift initialisation process which is much stricter that ObjC&#8217;s one. It&#8217;s still an ongoing discussion and work in progress and hopefully we will see some solution in the standard library soon.</p>



<p>Until then you have several options for encoding/decoding complex graph structures in Swift:</p>



<ol><li>Use NSKeyedArchiver + NSCoding. Good old ObjC APIs work smoothly from Swift.</li><li>Implement an additional compatibility layer between the calling code and the actual encoders. Create a <code>reference table</code> for checking an identity of the encoding objects.</li><li>Implement your own encoder/decoder pair. It&#8217;s the most time consuming option, but this way eventually you can use synthesised implementation for actual encoding/decoding in your models.</li><li>You can use some third party solutions. The problem is common enough so there are already some attempts to implement a solution. (<a href="https://github.com/BigZaphod/Archivable">https://github.com/BigZaphod/Archivable</a>, <a href="https://github.com/cherrywoods/swift-meta-serialization">https://github.com/cherrywoods/swift-meta-serialization</a>)&nbsp;</li></ol>



<p>There are couple of very informative discussion on the matter in swift forum <a href="https://forums.swift.org/t/codable-with-references/13885">here</a> and <a href="https://forums.swift.org/t/codable-archivable/11414">here</a>.</p>



<div style="height:105px" aria-hidden="true" class="wp-block-spacer"></div>



<h2>Codable as a replacement for NSCoding (as a conclusion)</h2>



<p>Obviously Codable is the future for serialization in iOS/macOS platforms. So can we consider NSCoding as a legacy API and forget about it when considering Swift?</p>



<p>Codable (with Coder protocol) came from NSCoding (with NSCoder abstract class) and inherited its general mechanics. We pass an encoder into encode() method of the model and the model translates itself into a number of key-value pairs which it passes to the encoder. But Codable is different in amount of use cases it covers.</p>



<p>In the beginning we pointed out that even before Codable we should have distinguished serialization from archiving, but the only way we utilise NSCoding is data persistence. NSKeyedArchiever which is used together with NSCoding serialises data in a format which makes it almost impossible to deserialise the data in another ecosystem (without NSKeyedUnarchiver and the same data model as was used for encoding). NSCoding has nothing to do with JSON or plist encoding/decoding. So the only practical approach is to persist data between app launches.</p>



<p>Codable introduces a completely different approach. Codable implementation may be used for serialising objects not only to JSON or plist, but to some custom formats as well. It decouples serialization from archiving and makes it more independent. In this regard multipurpose Codable has more value than NSCoding.</p>



<p>NSCoding has its own benefits. lets mention them one more time.</p>



<p>You can use NSCoding in both languages. In mixed ObjC/Swift projects when legacy models are written in ObjC it doesn&#8217;t matter if you write all the new code in Swift &#8211; you still cannot build general encoding mechanism (working for both languages) based on Codable.</p>



<p>The second point is wide adoption of NSCoding in Apple frameworks. All of the Foundation value objects and most of the Application Kit and UIKit user interface objects adopt NSCoding. The <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0167-swift-encoders.md#foundation-types-adopting-codable">list of classes adopting Codable</a> now is not so big. So it might cost you quite an effort to write extensions for classes you want to serialise/archive (for instance if you want to persist your app&#8217;s view hierarchy).</p>



<p>For serialising complex object graphs you cannot use pure Swift and Codable without an additional harness. But you can easily do it with NSCoding.</p>



<p>Saying that I don&#8217;t think that Codable can completely replace NSCoding in our code, at least now. You can leverage its benefits for some use cases like JSON encoding or serialization of simple structures to store them on disk. But there are still set of use cases when NSCoding is a better approach. Our job is to know the peculiarities and restrictions of both this approaches and use them in appropriate situations.</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-194" class="share-twitter sd-button share-icon no-text" href="https://dmtopolog.com/object-serialization-in-ios/?share=twitter" target="_blank" title="Click to share on Twitter"><span></span><span class="sharing-screen-reader-text">Click to share on Twitter (Opens in new window)</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-194" class="share-facebook sd-button share-icon no-text" href="https://dmtopolog.com/object-serialization-in-ios/?share=facebook" target="_blank" title="Click to share on Facebook"><span></span><span class="sharing-screen-reader-text">Click to share on Facebook (Opens in new window)</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
</div><!-- .entry-content -->

	
	
<footer class="entry-footer">

	<div class="entry-footer-right">

		
	</div>

	
		
		
		
		
			<span class="tags-links">

				Filed under: <a href="https://dmtopolog.com/tag/codable/" rel="tag">Codable</a>, <a href="https://dmtopolog.com/tag/ios/" rel="tag">iOS</a>, <a href="https://dmtopolog.com/tag/json/" rel="tag">JSON</a>, <a href="https://dmtopolog.com/tag/nscoding/" rel="tag">NSCoding</a>, <a href="https://dmtopolog.com/tag/plist/" rel="tag">Plist</a>, <a href="https://dmtopolog.com/tag/serialization/" rel="tag">Serialization</a>
			</span>

		
	
</footer><!-- .entry-footer -->

	
</article><!-- #post-## -->

		
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://dmtopolog.com/code-optimization-for-swift-and-objective-c/" rel="prev">&larr; Code optimization for Swift and Objective-C</a></div><div class="nav-next"><a href="https://dmtopolog.com/ios-app-extensions-data-sharing/" rel="next">iOS App Extensions: Data Sharing &rarr;</a></div></div>
	</nav>
		
	
	</main><!-- #main -->

</div><!-- #primary -->


<div id="secondary" class="widget-area" role="complementary">

	<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://dmtopolog.com/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h4 class="widget-title">Recent Posts</h4>		<ul>
											<li>
					<a href="https://dmtopolog.com/serialisation-of-enum-with-associated-type/">Serialisation of enum with associated type</a>
									</li>
											<li>
					<a href="https://dmtopolog.com/siri-intents/">Siri Intents</a>
									</li>
											<li>
					<a href="https://dmtopolog.com/ios-app-extensions-data-sharing/">iOS App Extensions: Data Sharing</a>
									</li>
											<li>
					<a href="https://dmtopolog.com/object-serialization-in-ios/">Object serialization in iOS</a>
									</li>
											<li>
					<a href="https://dmtopolog.com/code-optimization-for-swift-and-objective-c/">Code optimization for Swift and Objective-C</a>
									</li>
					</ul>
		</aside><aside id="recent-comments-2" class="widget widget_recent_comments"><h4 class="widget-title">Recent Comments</h4><ul id="recentcomments"></ul></aside><aside id="archives-2" class="widget widget_archive"><h4 class="widget-title">Archives</h4>		<ul>
				<li><a href='https://dmtopolog.com/2019/03/'>March 2019</a></li>
	<li><a href='https://dmtopolog.com/2019/02/'>February 2019</a></li>
	<li><a href='https://dmtopolog.com/2019/01/'>January 2019</a></li>
	<li><a href='https://dmtopolog.com/2018/12/'>December 2018</a></li>
	<li><a href='https://dmtopolog.com/2018/11/'>November 2018</a></li>
	<li><a href='https://dmtopolog.com/2018/10/'>October 2018</a></li>
	<li><a href='https://dmtopolog.com/2018/09/'>September 2018</a></li>
	<li><a href='https://dmtopolog.com/2018/08/'>August 2018</a></li>
		</ul>
			</aside><aside id="categories-2" class="widget widget_categories"><h4 class="widget-title">Categories</h4>		<ul>
				<li class="cat-item cat-item-4"><a href="https://dmtopolog.com/category/tech-blog/" >Tech Blog</a>
</li>
		</ul>
			</aside><aside id="meta-2" class="widget widget_meta"><h4 class="widget-title">Meta</h4>			<ul>
						<li><a rel="nofollow" href="https://dmtopolog.com/wp-login.php">Log in</a></li>
			<li><a href="https://dmtopolog.com/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://dmtopolog.com/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>
</div><!-- #secondary -->



		</div><!-- #content -->

		
		<footer id="colophon" class="site-footer">

			<div class="site-footer-inner">

				
			</div><!-- .site-footer-inner -->

		</footer><!-- #colophon -->

		
<div class="site-info-wrapper">

	<div class="site-info">

		<div class="site-info-inner">

			
<div class="site-info-text">

	Copyright &copy; 2019 @topolog&#039;s tech blog
</div>

		</div><!-- .site-info-inner -->

	</div><!-- .site-info -->

</div><!-- .site-info-wrapper -->

	</div><!-- #page -->

		<div style="display:none">
	</div>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/dmtopolog.com\/object-serialization-in-ios\/":194};
	</script>
				<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/jetpack/_inc/build/photon/photon.min.js?ver=20130122'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201914'></script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/themes/stout/assets/js/stout-hero.min.js?ver=1.8.6'></script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/themes/primer/assets/js/navigation.min.js?ver=1.8.6'></script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/themes/primer/assets/js/skip-link-focus-fix.min.js?ver=1.8.6'></script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/jetpack/_inc/build/lazy-images/js/lazy-images.min.js?ver=7.1.1'></script>
<script type='text/javascript' src='https://dmtopolog.com/wp-includes/js/wp-embed.min.js?ver=5.1.1'></script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/jetpack/_inc/build/spin.min.js?ver=1.3'></script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/jetpack/_inc/build/jquery.spin.min.js?ver=1.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/dmtopolog.com\/wp-admin\/admin-ajax.php","nonce":"7fea816318","display_exif":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/dmtopolog.com\/wp-login.php?redirect_to=https%3A%2F%2Fdmtopolog.com%2Fobject-serialization-in-ios%2F","blog_id":"1","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"],"local_comments_commenting_as":"<fieldset><label for=\"email\">Email (Required)<\/label> <input type=\"text\" name=\"email\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-email-field\" \/><\/fieldset><fieldset><label for=\"author\">Name (Required)<\/label> <input type=\"text\" name=\"author\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-author-field\" \/><\/fieldset><fieldset><label for=\"url\">Website<\/label> <input type=\"text\" name=\"url\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-url-field\" \/><\/fieldset>"};
/* ]]> */
</script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/jetpack/_inc/build/carousel/jetpack-carousel.min.js?ver=20190102'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://dmtopolog.com/wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js?ver=7.1.1'></script>
<script type='text/javascript'>
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-twitter', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
</script>
<script type='text/javascript' src='https://stats.wp.com/e-201914.js' async='async' defer='defer'></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:7.1.1',blog:'152802295',post:'194',tz:'-2',srv:'dmtopolog.com'} ]);
	_stq.push([ 'clickTrackerInit', '152802295', '194' ]);
</script>

</body>

</html>
