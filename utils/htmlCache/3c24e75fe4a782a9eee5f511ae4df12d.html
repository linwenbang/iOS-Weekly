<!DOCTYPE html>
<html lang="en-GB" prefix="og: http://ogp.me/ns#">
<head >
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rethinking Design Patterns in Swift: State Pattern - Khawer Khaliq</title>

<!-- Social Warfare v3.5.4 https://warfareplugins.com --><meta property="og:description" content="The State pattern, made simpler and more flexible with the power of Swift, with a detailed worked example to illustrate handling of new requirements, also looking at key design and implementation considerations and the benefits and practical applications of the pattern."><meta property="og:title" content="Rethinking Design Patterns in Swift: State Pattern"><meta property="fb:app_id" content="529576650555031"><meta property="og:type" content="article"><meta property="og:url" content="https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/"><meta property="og:site_name" content="Khawer Khaliq"><meta property="article:published_time" content="2018-12-06T19:20:35+00:00"><meta property="article:modified_time" content="2019-03-06T19:45:03+00:00"><meta property="og:updated_time" content="2019-03-06T19:45:03+00:00"><meta name="twitter:title" content="Rethinking Design Patterns in Swift: State Pattern"><meta name="twitter:description" content="The State pattern, made simpler and more flexible with the power of Swift, with a detailed worked example to illustrate handling of new requirements, also looking at key design and implementation considerations and the benefits and practical applications of the pattern."><meta name="twitter:image" content=""><meta name="twitter:creator" content=""><meta name="twitter:card" content="summary"><style>@font-face {font-family: "sw-icon-font";src:url("https://khawerkhaliq.com/wp-content/plugins/social-warfare/assets/fonts/sw-icon-font.eot?ver=3.5.4");src:url("https://khawerkhaliq.com/wp-content/plugins/social-warfare/assets/fonts/sw-icon-font.eot?ver=3.5.4#iefix") format("embedded-opentype"),url("https://khawerkhaliq.com/wp-content/plugins/social-warfare/assets/fonts/sw-icon-font.woff?ver=3.5.4") format("woff"),
	url("https://khawerkhaliq.com/wp-content/plugins/social-warfare/assets/fonts/sw-icon-font.ttf?ver=3.5.4") format("truetype"),url("https://khawerkhaliq.com/wp-content/plugins/social-warfare/assets/fonts/sw-icon-font.svg?ver=3.5.4#1445203416") format("svg");font-weight: normal;font-style: normal;}</style>
<!-- Social Warfare v3.5.4 https://warfareplugins.com -->


<!-- This site is optimized with the Yoast SEO Premium plugin v10.0.1 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="The State pattern, even more flexible with the power of Swift, with a worked example, design and implementation considerations, benefits and applications."/>
<link rel="canonical" href="https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="The State pattern, even more flexible with the power of Swift, with a worked example, design and implementation considerations, benefits and applications." />
<meta name="twitter:title" content="Rethinking Design Patterns in Swift: State Pattern - Khawer Khaliq" />
<meta name="twitter:image" content="https://khawerkhaliq.com/wp-content/uploads/2018/12/StatePatternClassDiagram.png" />
<script type='application/ld+json'>{"@context":"https://schema.org","@type":"Person","url":"https://khawerkhaliq.com/","sameAs":[],"@id":"#person","name":"Khawer Khaliq"}</script>
<!-- / Yoast SEO Premium plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//code.ionicframework.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Khawer Khaliq &raquo; Feed" href="https://khawerkhaliq.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Khawer Khaliq &raquo; Comments Feed" href="https://khawerkhaliq.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Khawer Khaliq &raquo; Rethinking Design Patterns in Swift: State Pattern Comments Feed" href="https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/feed/" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.4.2 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<script type="text/javascript" data-cfasync="false">
	var mi_version         = '7.4.2';
	var mi_track_user      = true;
	var mi_no_track_reason = '';
	
	var disableStr = 'ga-disable-UA-114674274-1';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}
	
	if ( mi_track_user ) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

		__gaTracker('create', 'UA-114674274-1', 'auto');
		__gaTracker('set', 'forceSSL', true);
		__gaTracker('require', 'linkid', 'linkid.js');
		__gaTracker('send','pageview');
	} else {
		console.log( "" );
		(function() {
			/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
			var noopfn = function() {
				return null;
			};
			var noopnullfn = function() {
				return null;
			};
			var Tracker = function() {
				return null;
			};
			var p = Tracker.prototype;
			p.get = noopfn;
			p.set = noopfn;
			p.send = noopfn;
			var __gaTracker = function() {
				var len = arguments.length;
				if ( len === 0 ) {
					return;
				}
				var f = arguments[len-1];
				if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
					console.log( 'Not running function __gaTracker(' + arguments[0] + " ....) because you are not being tracked. " + mi_no_track_reason );
					return;
				}
				try {
					f.hitCallback();
				} catch (ex) {

				}
			};
			__gaTracker.create = function() {
				return new Tracker();
			};
			__gaTracker.getByName = noopnullfn;
			__gaTracker.getAll = function() {
				return [];
			};
			__gaTracker.remove = noopfn;
			window['__gaTracker'] = __gaTracker;
					})();
		}
</script>
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/khawerkhaliq.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='social-warfare-block-css-css'  href='https://khawerkhaliq.com/wp-content/plugins/social-warfare/assets/js/post-editor/dist/blocks.style.build.css?ver=5.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='monochrome-pro-css'  href='https://khawerkhaliq.com/wp-content/themes/monochrome-pro/style.css?ver=1.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://khawerkhaliq.com/wp-includes/css/dist/block-library/style.min.css?ver=5.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='social_warfare-css'  href='https://khawerkhaliq.com/wp-content/plugins/social-warfare/assets/css/style.min.css?ver=3.5.4' type='text/css' media='all' />
<link rel='stylesheet' id='monochrome-fonts-css'  href='//fonts.googleapis.com/css?family=Muli%3A200%2C300%2C300i%2C400%2C400i%2C600%2C600i%7COpen+Sans+Condensed%3A300&#038;ver=1.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='monochrome-ionicons-css'  href='//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css?ver=1.0.1' type='text/css' media='all' />
<script>if (document.location.protocol != "https:") {document.location = document.URL.replace(/^http:/i, "https:");}</script><script type='text/javascript'>
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,exe,js,pdf,ppt,tgz,zip,xls","inbound_paths":"[]","home_url":"https:\/\/khawerkhaliq.com","hash_tracking":"false"};
/* ]]> */
</script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-content/plugins/google-analytics-premium/assets/js/frontend.min.js?ver=7.4.2'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-content/themes/genesis/lib/js/html5shiv.min.js?ver=3.7.3'></script>
<![endif]-->
<link rel='https://api.w.org/' href='https://khawerkhaliq.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://khawerkhaliq.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://khawerkhaliq.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.1.1" />
<link rel='shortlink' href='https://khawerkhaliq.com/?p=1515' />
<link rel="alternate" type="application/json+oembed" href="https://khawerkhaliq.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://khawerkhaliq.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F&#038;format=xml" />
<style type="text/css">
	</style>
	<style type="text/css"> .enews .screenread {
	height: 1px;
    left: -1000em;
    overflow: hidden;
    position: absolute;
    top: -1000em;
    width: 1px; } </style><link rel="icon" href="https://khawerkhaliq.com/wp-content/themes/monochrome-pro/images/favicon.ico" />
<link rel="pingback" href="https://khawerkhaliq.com/xmlrpc.php" />
		<style type="text/css" id="wp-custom-css">
			.site-header {
	position: absolute;
}

div.code-container {
	background-color: black;
	margin-top: 20px;
	margin-bottom: 30px;
	line-height: 1.4em;
	font-family: "Lucida Console", Monaco, monospace;
  font-size: 0.9em;
	color: silver;
}

pre {
	padding-left: 15px;
	padding-right: 15px;
	padding-top: 25px;
	padding-bottom: 25px;
	white-space: pre;
	word-wrap: normal;
	overflow: auto
}

span.keyword { 
	color: indianred; 
}
span.type { 
	color: steelblue; 
}
span.comment { 
	color: slategray; 
	font-style: italic;
}
span.property { 
	color: olivedrab; 
}
span.string { 
	color: burlywood; 
}
span.number { 
	color: burlywood; 
}
span.call { 
	color: olivedrab; 
}
span.dotAccess { 
	color: olivedrab; 
}

span.inline-code {
  font-family: "Courier New", Courier, monospace;
}

table {
	word-break: normal;
}

td {
	padding: 10px;
	vertical-align: top;
	line-height: 1.5;
}

div.toc-container {
	border-style: solid;
	border-width: 1px;
	padding-bottom: 25px;
	padding-left: 20px;
	padding-right: 20px;
	margin-top: 40px;
	margin-bottom: 40px;
}

div.toc-content-area {
	white-space: nowrap;
	overflow: auto;
}

span.toc1 { padding-left: 1em; }
span.toc2 { padding-left: 2em; }
		</style>
		</head>
<body data-rsssl=1 class="post-template-default single single-post postid-1515 single-format-standard header-full-width content-sidebar" itemscope itemtype="https://schema.org/WebPage"><div class="site-container"><ul class="genesis-skip-link"><li><a href="#genesis-nav-primary" class="screen-reader-shortcut"> Skip to primary navigation</a></li><li><a href="#genesis-content" class="screen-reader-shortcut"> Skip to content</a></li><li><a href="#genesis-sidebar-primary" class="screen-reader-shortcut"> Skip to primary sidebar</a></li></ul><header class="site-header" itemscope itemtype="https://schema.org/WPHeader"><div class="wrap"><div class="title-area"><p class="site-title" itemprop="headline"><a href="https://khawerkhaliq.com/">Khawer Khaliq</a></p></div><nav class="nav-primary" aria-label="Main" itemscope itemtype="https://schema.org/SiteNavigationElement" id="genesis-nav-primary"><div class="wrap"><ul id="menu-navigation-menu" class="menu genesis-nav-menu menu-primary js-superfish"><li id="menu-item-1439" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1439"><a href="https://khawerkhaliq.com" itemprop="url"><span itemprop="name">Home</span></a></li>
</ul></div></nav></div></header><div class="site-inner"><div class="content-sidebar-wrap"><main class="content" id="genesis-content"><article class="post-1515 post type-post status-publish format-standard category-articles tag-design-patterns tag-finite-state-automata tag-finite-state-machine tag-state-diagram tag-state-machine-diagram tag-state-pattern tag-swift entry" itemscope itemtype="https://schema.org/CreativeWork"><header class="entry-header"><h1 class="entry-title" itemprop="headline">Rethinking Design Patterns in Swift: State Pattern</h1>
<p class="entry-meta"><time class="entry-time" itemprop="datePublished" datetime="2018-12-06T19:20:35+00:00">December 6, 2018</time></p></header><div class="entry-content" itemprop="text"><div class="swp_social_panel swp_horizontal_panel swp_flat_fresh  swp_default_full_color swp_other_full_color swp_individual_full_color scale-100 scale-full_width" data-min-width="1100" data-float-color="#ffffff" data-float="none" data-float-mobile="none" data-transition="slide" ><div class="nc_tweetContainer swp_share_button swp_facebook" data-network="facebook"><a class="nc_tweet swp_share_link" rel="nofollow noreferrer noopener" target="_blank" href="https://www.facebook.com/share.php?u=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" data-link="https://www.facebook.com/share.php?u=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F"><span class="swp_count swp_hide"><span class="iconFiller"><span class="spaceManWilly"><i class="sw swp_facebook_icon"></i><span class="swp_share">Share</span></span></span></span></a></div><div class="nc_tweetContainer swp_share_button swp_twitter" data-network="twitter"><a class="nc_tweet swp_share_link" rel="nofollow noreferrer noopener" target="_blank" href="https://twitter.com/intent/tweet?text=Rethinking+Design+Patterns+in+Swift%3A+State+Pattern&url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" data-link="https://twitter.com/intent/tweet?text=Rethinking+Design+Patterns+in+Swift%3A+State+Pattern&url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F"><span class="swp_count swp_hide"><span class="iconFiller"><span class="spaceManWilly"><i class="sw swp_twitter_icon"></i><span class="swp_share">Tweet</span></span></span></span></a></div><div class="nc_tweetContainer swp_share_button swp_linkedin" data-network="linkedin"><a class="nc_tweet swp_share_link" rel="nofollow noreferrer noopener" target="_blank" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" data-link="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F"><span class="swp_count swp_hide"><span class="iconFiller"><span class="spaceManWilly"><i class="sw swp_linkedin_icon"></i><span class="swp_share">Share</span></span></span></span></a></div><div class="nc_tweetContainer swp_share_button swp_google_plus" data-network="google_plus"><a class="nc_tweet swp_share_link" rel="nofollow noreferrer noopener" target="_blank" href="https://plus.google.com/share?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" data-link="https://plus.google.com/share?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F"><span class="swp_count swp_hide"><span class="iconFiller"><span class="spaceManWilly"><i class="sw swp_google_plus_icon"></i><span class="swp_share">+1</span></span></span></span></a></div></div><p class="intro">This article shows how to implement the State pattern in Swift, using the power of Swift to make it more efficient and more flexible. We work through an example to explore the various aspects of the State pattern and show its ability to handle changes in requirements. We then look at key design and implementation considerations as well as the benefits and practical applications of the pattern.</p>
<div class="toc-container">
<h2>Contents</h2>
<div class="toc-content-area">
<span class="toc1"><a href="#Finite_state_automata">Finite state automata</a></span><br />
<span class="toc1"><a href="#State_pattern">State pattern</a></span><br />
<span class="toc2"><a href="#Definition">1. Definition</a></span><br />
<span class="toc2"><a href="#Structure_and_participants">2. Structure and participants</a></span><br />
<span class="toc1"><a href="#State_machine_diagram">State machine diagram</a></span><br />
<span class="toc2"><a href="#States,_events_and_transitions">1. States, events and transitions</a></span><br />
<span class="toc2"><a href="#Entry_and_exit_activities_for_states">2. Entry and exit activities for states</a></span><br />
<span class="toc2"><a href="#Guard_conditions_and_effects_for_transitions">3. Guard conditions and effects for transitions</a></span><br />
<span class="toc1"><a href="#State_Pattern_implementation">State Pattern implementation</a></span><br />
<span class="toc2"><a href="#External_interface">1. External interface</a></span><br />
<span class="toc2"><a href="#The_Context_type">2. The Context type</a></span><br />
<span class="toc2"><a href="#The_abstract_State_type">3. The abstract State type</a></span><br />
<span class="toc2"><a href="#The_Context_type_revisited">4. The Context type revisited</a></span><br />
<span class="toc2"><a href="#Concrete_State_types">5. Concrete State types</a></span><br />
<span class="toc2"><a href="#Finishing_touches">6. Finishing touches</a></span><br />
<span class="toc2"><a href="#Test_run">7. Test run</a></span><br />
<span class="toc1"><a href="#Dealing_with_Change">Dealing with Change</a></span><br />
<span class="toc2"><a href="#Adding_a_transition">1. Adding a transition</a></span><br />
<span class="toc2"><a href="#Adding_a_conditional_transition">2. Adding a conditional transition</a></span><br />
<span class="toc2"><a href="#Adding_a_new_state">3. Adding a new state</a></span><br />
<span class="toc1"><a href="#Key_design_and_implementation_considerations">Key design and implementation considerations</a></span><br />
<span class="toc2"><a href="#Handling_state_transitions">1. Handling state transitions</a></span><br />
<span class="toc2"><a href="#States_with_state">2. States with state</a></span><br />
<span class="toc2"><a href="#Creating_states">3. Creating states</a></span><br />
<span class="toc2"><a href="#Events_and_activities_not_applicable_to_certain_states">4. Events and activities not applicable to certain states</a></span><br />
<span class="toc2"><a href="#Specifying_activities_in_states_or_transitions">5. Specifying activities in states or transitions</a></span><br />
<span class="toc1"><a href="#Benefits_of_the_State_pattern">Benefits of the State pattern</a></span><br />
<span class="toc2"><a href="#Clear_control_flow">1. Clear control flow</a></span><br />
<span class="toc2"><a href="#Partitioning_of_behaviour">2. Partitioning of behaviour</a></span><br />
<span class="toc2"><a href="#Ease_of_maintenance">3. Ease of maintenance</a></span><br />
<span class="toc1"><a href="#Practical_applications_of_the_State_pattern">Practical applications of the State pattern</a></span><br />
<span class="toc2"><a href="#Database_updates">1. Database updates</a></span><br />
<span class="toc2"><a href="#Drawing_programs_and_frameworks">2. Drawing programs and frameworks</a></span><br />
<span class="toc2"><a href="#Graphical_user_interfaces">3. Graphical user interfaces</a></span><br />
<span class="toc2"><a href="#Network_protocols">4. Network protocols</a></span><br />
<span class="toc2"><a href="#Game_programming">5. Game programming</a></span><br />
<span class="toc2"><a href="#Embedded_systems">6. Embedded systems</a></span><br />
<span class="toc1"><a href="#Conclusion">Conclusion</a></span><br />
<span class="toc1"><a href="#References">References</a></span>
</div>
</div>
<h2 id="Finite_state_automata">Finite state automata</h2>
<p>Real-world domains commonly contain entities that may, at any point in time, be in one of a finite number of possible states. Depending on what state the entity is in, it may react differently to the same action or event.</p>
<p>Consider a typical vending machine. When no money has been inserted, pressing a button that is supposed to vend a particular item has no effect. This is because the machine is not in the right state for that action to be performed. Even when money is inserted, the machine may vend some items but not others, depending on how much money has been inserted and how much each item costs. Once the item that was paid for has been given, the machine goes back to the state where it will not vend anything without receiving money.</p>
<p>These kinds of entities can be modeled effectively using finite state automata, or finite state machines. A finite state automaton, or finite state machine, or simply a state machine, is an abstract machine that can be in any one of a finite number of states, and can transition among these states in response to certain trigger events.</p>
<p>Simple state machines can be implemented in code using conditional statements, typically nested <span class="inline-code">switch</span> statements. This may be adequate, and quite efficient, for very simple state machine implementations. However, this approach does not scale well. When dealing with more complex state machines, it can lead to code that is cumbersome, hard-to-understand and challenging to maintain.</p>
<p>The State pattern is a robust and scalable way to implement a state machine. State-specific behavior is encapsulated by various state types, to which the entity being modeled delegates events and actions. The rules governing transitions between states can also be managed by the states themselves.</p>
<h2 id="State_pattern">State pattern</h2>
<h3 id="Definition">1. Definition</h3>
<p>The State pattern enables an instance of a type to change its behaviour with changes in its internal state. From an external perspective, the instance may appear to change its type.</p>
<h3 id="Structure_and_participants">2. Structure and participants</h3>
<p>The class diagram below illustrates the structure of the State pattern:</p>
<p><img src="https://khawerkhaliq.com/wp-content/uploads/2018/12/StatePatternClassDiagram.png" alt="State pattern class diagram" width="617" height="303" class="aligncenter size-full wp-image-1583" srcset="https://khawerkhaliq.com/wp-content/uploads/2018/12/StatePatternClassDiagram.png 617w, https://khawerkhaliq.com/wp-content/uploads/2018/12/StatePatternClassDiagram-300x147.png 300w" sizes="(max-width: 617px) 100vw, 617px" /></p>
<p>The Context type defines the interface to be used by clients. The abstract State type in turn defines an interface, to be used by the Context, which encapsulates state-specific behaviour of the Context. Each concrete State type implements the behaviour associated with a particular state of the Context. The Context is thus able to delegate state-specific behaviour to the concrete State types.</p>
<p>The flexibility of the pattern comes from the fact that the Context depends only on the abstract State type and not on any of the concrete State types. Instances of concrete State types can thus be swapped in and out as the Context transitions from one state to another.</p>
<h2 id="State_machine_diagram">State machine diagram</h2>
<p>A state machine diagram, or state diagram, is a good way to visualize a state machine. Each state is represented by a rounded rectangle and arrows connecting the rectangles show transitions between states. If the state machine has a default initial state, a small filled circle is used to represent an initial pseudostate, which typically transitions automatically into the first proper state.</p>
<p>Let&#8217;s assume we have been tasked with building the control unit for a security system, which sounds an alarm when there is an intrusion or the threat of an intrusion. The security system will be connected to sensors, each of which can detect a breach, such as a door or window being opened. When the system is armed, such a breach should cause an alarm to be sounded. The system will also have one or more panic switches, which can be used to sound an alarm even when there is no actual breach but there may be an imminent threat of a breach from a potential intruder. When the system is not armed, a breach or panic signal should not have any effect.</p>
<p>We also need to ensure that, once armed, the system can be disarmed only through the use of a code. This code will be set when the system is initialized and must be used to disarm the system. The same code must also be used to reset the system, i.e., stop the alarm once it has been sounded.</p>
<p>If we think of the security system described above as a state machine, we can represent it visually by the following state diagram:</p>
<p><img src="https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramInitial.png" alt="Initial state diagram for security system" width="517" height="472" class="aligncenter size-full wp-image-1591" srcset="https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramInitial.png 517w, https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramInitial-300x274.png 300w" sizes="(max-width: 517px) 100vw, 517px" /></p>
<p>Although the diagram is fairly intuitive, let&#8217;s briefly look at its constituent parts and some of the formalisms governing construction of state diagrams, as per the Unified Modeling Language (UML) specification.</p>
<h3 id="States,_events_and_transitions">1. States, events and transitions</h3>
<p>Our system can be in any of three states: <strong>Disarmed</strong>, <strong>Armed</strong> and <strong>Alarm</strong>. The Disarmed state is the default initial state.</p>
<p>Transitions between the states can be triggered by the following events:</p>
<ul>
<li><strong>Arm</strong>: Applicable only to the Disarmed state. Triggers a transition to the Armed state.</li>
<li><strong>Disarm</strong>: Applicable only to the Armed state. Triggers a transition to the Disarmed state.</li>
<li><strong>Breach</strong>: Indicates that a sensor has been breached. Applicable only to the Armed state. Triggers a transition to the Alarm state.</li>
<li><strong>Panic</strong>: Indicates that a panic switch has been activated. Applicable only to the Armed state. Triggers a transition to the Alarm state.</li>
<li><strong>Reset</strong>: Applicable only to the Alarm state. Triggers a transition to the Disarmed state.</li>
</ul>
<h3 id="Entry_and_exit_activities_for_states">2. Entry and exit activities for states</h3>
<p>Any of the states in a state machine may have entry and exit activities. An entry activity is performed just after a state is entered while an exit activity is performed just before a state is exited. Specifying activities for states is not mandatory but it is a useful way of ensuring that the states encapsulate the behavior associated with them. In our example, every state has an entry activity whereas only the Alarm state has an exit activity.</p>
<h3 id="Guard_conditions_and_effects_for_transitions">3. Guard conditions and effects for transitions</h3>
<p>A complete specification of a transition can have four parts &#8211; an event, a guard condition, an effect and a target state. The event is what triggers the transition and the target state is the state that becomes active on completion of the transition. The guard condition is a boolean expression which is evaluated and the transition fires only if the expression evaluates to true. An effect is an optional activity that is performed before the transition completes, i.e., before the target state becomes active.</p>
<p>A transition label can include the event, guard condition and effect in the format: &#8216;event [guard condition] / effect&#8217;. In our example, two of the transitions have guard conditions. These ensure that the system can be disarmed and reset only with a valid code. We have not used effects in any of the transitions in our example.</p>
<h2 id="State_Pattern_implementation">State Pattern implementation</h2>
<h3 id="External_interface">1. External interface</h3>
<p>Having visualized our state machine, let&#8217;s start implementing it by defining the interface to be used by clients. This is the interface that the concrete Context type will implement.</p>
<p>Methods in the external interface correspond to the events in the state diagram.</p>
<div class="code-container">
<pre><span class="keyword">protocol</span> SecuritySystem {
    <span class="keyword">func</span> arm()
    <span class="keyword">func</span> disarm(usingCode: <span class="type">String</span>)
    <span class="keyword">func</span> breach()
    <span class="keyword">func</span> panic()
    <span class="keyword">func</span> reset(usingCode: <span class="type">String</span>)
}</pre>
</div>
<p>Note the use of a protocol to define the external interface. This has the following benefits:</p>
<ul>
<li>Clients of the state machine only see and use the methods in the protocol. The concrete Context type will have other methods required to facilitate the inner workings of the State pattern. In the original implementation of the State pattern in [Gamma], the GoF used the <em>friend class</em> functionality of C++ to ensure that the inner workings of the State pattern are not exposed to clients. In our Swift implementation, we use a protocol.</li>
<li>Using a protocol also allows us to define the interface of the state machine independent of the concrete Context type that provides the underlying functionality. This gives us the ability to handle changes to the interface of the concrete Context type, even swap in a new one, without impacting the clients of the state machine.</li>
</ul>
<h3 id="The_Context_type">2. The Context type</h3>
<p>Next, we define the concrete Context type, which implements the protocol introduced above.</p>
<div class="code-container">
<pre><span class="keyword">class</span> System: <span class="type">SecuritySystem</span> {
    <span class="keyword">func</span> arm() {}
    <span class="keyword">func</span> disarm(usingCode: <span class="type">String</span>) {}
    <span class="keyword">func</span> breach() {}
    <span class="keyword">func</span> panic() {}
    <span class="keyword">func</span> reset(usingCode: <span class="type">String</span>) {}
}</pre>
</div>
<p>What we have at the moment is just a skeleton of the Context type, with empty implementations of all the methods in the protocol. This is because we are yet to implement the machinery of the State pattern, which will be used by the Context type to implement the required functionality. </p>
<h3 id="The_abstract_State_type">3. The abstract State type</h3>
<p>When describing the structure of the State pattern, we had noted that the Context type delegates state-specific behavior to the concrete State types, using the interface defined by the abstract State type, to which all the concrete State types conform. </p>
<p>Each state will be responsible not only for handling events that may trigger transitions between states but also for its own entry and exit activities. These are separate responsibilities but we need to combine them into a single interface. Swift allows us to do this very cleanly using <strong>protocol composition</strong>, which lets us combine the requirements of the two protocols, together with a <span class="inline-code">typealias</span>, which we can use to bind the combined protocol to a name. </p>
<div class="code-container">
<pre><span class="keyword">protocol</span> Events {}

<span class="keyword">protocol</span> Activities {}

<span class="keyword">typealias</span> State = <span class="type">Events</span> & <span class="type">Activities</span></pre>
</div>
<p>We have defined separate protocols to represent events, that may trigger transitions between states, and activities related to the states. The requirements of these protocols are then combined into a single protocol, which is named <span class="inline-code">State</span> using a <span class="inline-code">typealias</span>. This demonstrates how protocol composition can facilitate following the <strong>Interface Segregation Principle</strong> to define protocols narrowly while being able to combine their requirements as required to meet the needs of client code. </p>
<p>Having worked out the overall scheme, we define the requirements of the <span class="inline-code">Events</span> protocol.  </p>
<div class="code-container">
<pre><span class="keyword">protocol</span> Events {
    <span class="keyword">func</span> arm(_: <span class="type">System</span>)
    <span class="keyword">func</span> disarm(usingCode: <span class="type">String</span>, _: <span class="type">System</span>)
    <span class="keyword">func</span> breach(_: <span class="type">System</span>)
    <span class="keyword">func</span> panic(_: <span class="type">System</span>)
    <span class="keyword">func</span> reset(usingCode: <span class="type">String</span>, _: <span class="type">System</span>)
}</pre>
</div>
<p>This protocol contains one method for each of the events that may trigger a transition from one state to another. Each method takes an instance of the concrete Context type as a parameter, to be able to call methods on the system to effect actions as required. </p>
<p>It is important to note that not every state in a state machine may have a possible transition to every other state. In our case, for instance, when the alarm system is in the Disarmed state, a breach or a panic event should not have any effect. Similarly, a second breach or panic event should have no effect on a system already in the Alarm state. An otherwise valid transition may also fail due to a guard condition not evaluating to true. This would be case for the alarm system if an attempt is made to trigger a transition from the Armed or Alarm States to the Disarmed state, without providing a valid code. </p>
<p>We, therefore, use a protocol extension to provide empty default implementations of all the protocol methods. This enables the concrete State types to implement methods only for the events that can actually cause a transition from that state.</p>
<div class="code-container">
<pre><span class="keyword">extension</span> <span class="type">Events</span> {
    <span class="keyword">func</span> arm(_: <span class="type">System</span>) {}
    <span class="keyword">func</span> disarm(usingCode: <span class="type">String</span>, _: <span class="type">System</span>) {}
    <span class="keyword">func</span> breach(_: <span class="type">System</span>) {}
    <span class="keyword">func</span> panic(_: <span class="type">System</span>) {}
    <span class="keyword">func</span> reset(usingCode: <span class="type">String</span>, _: <span class="type">System</span>) {}
}</pre>
</div>
<p>Next, we define the requirements of the <span class="inline-code">Activities</span> protocol. </p>
<div class="code-container">
<pre><span class="keyword">protocol</span> Activities {
    <span class="keyword">func</span> enter(_: <span class="type">System</span>)
    <span class="keyword">func</span> exit(_: <span class="type">System</span>)
}</pre>
</div>
<p>These methods will allow each concrete State type to define entry and exit activities for the state it represents. Both these methods take an instance of the concrete Context type as a parameter, to be able to call methods on the system to effect any required actions.</p>
<p>Since every state will not have both an entry and an exit activity, we define the following extension to the above protocol. </p>
<div class="code-container">
<pre><span class="keyword">extension</span> <span class="type">Activities</span> {
    <span class="keyword">func</span> enter(_: <span class="type">System</span>) {}
    <span class="keyword">func</span> exit(_: <span class="type">System</span>) {}
}</pre>
</div>
<p>With default empty implementations of both the methods in place, concrete State types will need to implement these methods only for states that actually have entry and exit activities respectively. </p>
<h3 id="The_Context_type_revisited">4. The Context type revisited</h3>
<p>Now that we have defined the interface of the abstract State type, which combines the requirements of the <span class="inline-code">Events</span> and <span class="inline-code">Activities</span> protocols, we are in a position to implement the relevant methods in the Context type. The Context type will delegate state-specific behaviour to the concrete State types using the methods defined by the abstract State type. </p>
<div class="code-container">
<pre><span class="keyword">class</span> System: <span class="type">SecuritySystem</span> {
    <span class="keyword">init</span>(code: <span class="type">String</span>, initialState: <span class="type">State</span>) {
        <span class="keyword">self</span>.<span class="property">code</span> = code
        state = initialState
    }
    
    <span class="keyword">func</span> arm() {
        state.<span class="call">arm</span>(<span class="keyword">self</span>)
    }
    
    <span class="keyword">func</span> disarm(usingCode code: <span class="type">String</span>) {
        state.<span class="call">disarm</span>(usingCode: code, <span class="keyword">self</span>)
    }
    
    <span class="keyword">func</span> breach() {
        state.<span class="call">breach</span>(<span class="keyword">self</span>)
    }
    
    <span class="keyword">func</span> panic() {
        state.<span class="call">panic</span>(<span class="keyword">self</span>)
    }
    
    <span class="keyword">func</span> reset(usingCode code: <span class="type">String</span>) {
        state.<span class="call">reset</span>(usingCode: code, <span class="keyword">self</span>)
    }
    
    <span class="keyword">private</span> <span class="keyword">var</span> state: <span class="type">State</span>
    <span class="keyword">private</span> <span class="keyword">let</span> code: <span class="type">String</span>
}</pre>
</div>
<p>The <span class="inline-code">state</span> property of the Context type is the lynchpin of the State pattern. As the program runs, instances of different concrete State types will be assigned to it, as the Context type transitions from one state to another. State-related behaviour will thus be delegated using this property to the relevant concrete State instances.</p>
<p>The Context type does not have to know when to transition to which state. That knowledge is encapsulated in the concrete State types themselves, as we will see in the next section. All the Context type has to do is to provide a method that the concrete State types can call to effect the transition in an orderly manner. We do this in the following extension of the <span class="inline-code">System</span> class. </p>
<div class="code-container">
<pre><span class="keyword">extension</span> <span class="type">System</span> {
    <span class="keyword">func</span> transition(to newState: <span class="type">State</span>) {
        state.<span class="call">exit</span>(<span class="keyword">self</span>)
        state = newState
        state.<span class="call">enter</span>(<span class="keyword">self</span>)
    }
    
    <span class="keyword">func</span> isValid(code: <span class="type">String</span>) -&gt; <span class="type">Bool</span> {
        <span class="keyword">let</span> isValid = code == <span class="keyword">self</span>.<span class="property">code</span>
        <span class="call">print</span>(isValid ? <span class="string">"Code</span> <span class="string">accepted"</span> : <span class="string">"Invalid</span> <span class="string">code"</span>)
        <span class="keyword">return</span> isValid
    }
}</pre>
</div>
<p>The <span class="inline-code">transition(to:)</span> method takes an instance of any type conforming to the <span class="inline-code">State</span> protocol. It is meant to be called by the concrete State types, to effect a transition to another state, passing an instance of the concrete State that represents the state to which the Context type should transition. The <span class="inline-code">transition(to:)</span> method does not know anything about the current state or the state to which the Context type will transition. It just effects the transition, by calling the <span class="inline-code">exit(_:)</span> method on the existing state, assigning the concrete instance representing the next state to the <span class="inline-code">state</span> stored property, and calling the <span class="inline-code">enter(_:)</span> method on the new state to complete the transition. </p>
<p>The extension also contains the <span class="inline-code">isValid(code:)</span> method, which is called by the concrete State types that include transitions allowed to proceed only if a valid code has been provided. It uses the <span class="inline-code">code</span> stored property set in the initializer of the <span class="inline-code">System</span> class. </p>
<h3 id="Concrete_State_types">5. Concrete State types</h3>
<p>Having laid the groundwork, we are ready to implement state-related behaviour in the concrete State types, each of which will conform to the <span class="inline-code">State</span> protocol, which as we have seen above, is simply a composition of the <span class="inline-code">Events</span> and <span class="inline-code">Activities</span> protocols. </p>
<p>Let&#8217;s start with the simplest concrete State type, which represents the Disarmed state.</p>
<div class="code-container">
<pre><span class="keyword">class</span> DisarmedState: <span class="type">State</span> {
    <span class="keyword">func</span> enter(_: <span class="type">System</span>) {
        <span class="call">print</span>(<span class="string">"System</span> <span class="string">disarmed"</span>)
    }
    
    <span class="keyword">func</span> arm(<span class="keyword">_</span> system: <span class="type">System</span>) {
        system.<span class="call">transition</span>(to: <span class="type">ArmedState</span>.<span class="property">instance</span>)
    }
    
    <span class="keyword">static</span> <span class="keyword">let</span> instance = <span class="type">DisarmedState</span>()
}</pre>
</div>
<p>The <span class="inline-code">enter(_:)</span> method, which will be executed when this state is entered, disarms the system. For the purposes of this demonstration, it simply prints a message to the console stating that the system has been disarmed.</p>
<p>When the system is disarmed, a breach or a panic event does not apply. Neither can the system be reset from this state. The only applicable method from the <span class="inline-code">Events</span> protocol, therefore, is <span class="inline-code">arm(_:)</span>, which causes the system to become armed. This method calls the <span class="inline-code">transition(to:)</span> method of the <span class="inline-code">System</span> class to effect the transition, passing an instance of the concrete State type representing the state to which the system should transition. </p>
<p>Note the static property called <span class="inline-code">instance</span>, which holds a unique instance of <span class="inline-code">DisarmedState</span>. Each concrete State type will have a similar property to allow the concrete State types to collectively control all transitions in the state machine. The <span class="inline-code">arm(_:)</span> method in this case uses the unique instance of <span class="inline-code">ArmedState</span> to ensure that the system transitions to the Armed state. </p>
<p>This is the state we will implement next.</p>
<div class="code-container">
<pre><span class="keyword">class</span> ArmedState: <span class="type">State</span> {
    <span class="keyword">func</span> enter(_: <span class="type">System</span>) {
        <span class="call">print</span>(<span class="string">"System</span> <span class="string">armed"</span>)
    }
    
    <span class="keyword">func</span> disarm(usingCode code: <span class="type">String</span>, <span class="keyword">_</span> system: <span class="type">System</span>) {
        <span class="keyword">guard</span> system.<span class="call">isValid</span>(code: code) <span class="keyword">else</span> { <span class="keyword">return</span> }
        system.<span class="call">transition</span>(to: <span class="type">DisarmedState</span>.<span class="property">instance</span>)
    }
    
    <span class="keyword">func</span> breach(<span class="keyword">_</span> system: <span class="type">System</span>) {
        system.<span class="call">transition</span>(to: <span class="type">AlarmState</span>.<span class="property">instance</span>)
    }
    
    <span class="keyword">func</span> panic(<span class="keyword">_</span> system: <span class="type">System</span>) {
        system.<span class="call">transition</span>(to: <span class="type">AlarmState</span>.<span class="property">instance</span>)
    }
    
    <span class="keyword">static</span> <span class="keyword">let</span> instance = <span class="type">ArmedState</span>()
}</pre>
</div>
<p>The <span class="inline-code">enter(_:)</span> method in this case arms the system. As with the <span class="inline-code">DisarmedState</span> class, it simply prints the appropriate message to the console. </p>
<p>When the system is in the Armed state, the <span class="inline-code">disarm(usingCode:_:)</span> method disarms the system, if the correct code has been provided. The <span class="inline-code">breach(_:)</span> and <span class="inline-code">panic(_:)</span> methods use the unique instance of <span class="inline-code">AlarmState</span> to ensure the correct transitions. As before, all these methods call the <span class="inline-code">transition(to:)</span> method of the <span class="inline-code">System</span> class to effect the respective transitions. </p>
<p>The last state we need to implement is the Alarm state.</p>
<div class="code-container">
<pre><span class="keyword">class</span> AlarmState: <span class="type">State</span> {
    <span class="keyword">func</span> enter(_: <span class="type">System</span>) {
        <span class="call">print</span>(<span class="string">"Alarm</span> <span class="string">sounded"</span>)
    }
    
    <span class="keyword">func</span> exit(_: <span class="type">System</span>) {
        <span class="call">print</span>(<span class="string">"Alarm</span> <span class="string">stopped"</span>)
    }
    
    <span class="keyword">func</span> reset(usingCode code: <span class="type">String</span>, <span class="keyword">_</span> system: <span class="type">System</span>) {
        <span class="keyword">guard</span> system.<span class="call">isValid</span>(code: code) <span class="keyword">else</span> { <span class="keyword">return</span> }
        system.<span class="call">transition</span>(to: <span class="type">DisarmedState</span>.<span class="property">instance</span>)
    }
    
    <span class="keyword">static</span> <span class="keyword">let</span> instance = <span class="type">AlarmState</span>()
}</pre>
</div>
<p>The <span class="inline-code">enter(_:)</span> method for this state sounds the alarm. This is the only state to have an <span class="inline-code">exit(_:)</span> method, which stops the alarm. </p>
<p>Once the alarm has been sounded, any further breach or panic event should not cause a transition, so these events don&#8217;t apply to this state. The <span class="inline-code">reset(usingCode:_:)</span> method validates the code and, provided the code is valid, effects a transition to the Disarmed state. </p>
<h3 id="Finishing_touches">6. Finishing touches</h3>
<p>Our implementation of the State pattern is essentially complete. We just need to ensure that the system is in the Disarmed state when the programs begins execution, by passing an instance of <span class="inline-code">DisarmedState</span> to the initializer of the <span class="inline-code">System</span> class. This could be done in various ways, depending on how the <span class="inline-code">System</span> class fits in the broader design. For our purposes, we simply create a new class with a single factory method. </p>
<div class="code-container">
<pre><span class="keyword">class</span> SecuritySystemFactory {
    <span class="keyword">static</span> <span class="keyword">func</span> create(withCode code: <span class="type">String</span>) -&gt; <span class="type">SecuritySystem</span> {
        <span class="keyword">return</span> <span class="type">System</span>(code: code, initialState: <span class="type">DisarmedState</span>.<span class="property">instance</span>)
    }
}</pre>
</div>
<p>The above <span class="inline-code">static</span> method creates a new instance of the <span class="inline-code">System</span> class, passing in the provided code and setting the initial state to an instance of the <span class="inline-code">DisarmedState</span> class. Note that the return type of the method is the protocol type <span class="inline-code">SecuritySystem</span>. This ensures that the client code does not get exposed to the <span class="inline-code">System</span> class and is only able to call the methods defined by the <span class="inline-code">SecuritySystem</span> protocol. </p>
<p>That&#8217;s it. Our security system is all set up and ready for a test run.</p>
<h3 id="Test_run">7. Test run</h3>
<p>First, we test the system in its initial Disarmed state. In this state, a breach reported by a sensor or the press of a panic button should not have any effect. So we call the two methods on a newly minted <span class="inline-code">System</span> instance and see what happens.</p>
<div class="code-container">
<pre><span class="keyword">let</span> system = <span class="type">SecuritySystemFactory</span>.<span class="call">create</span>(withCode: <span class="string">"1234"</span>)
system.<span class="call">breach</span>()
system.<span class="call">panic</span>()</pre>
</div>
<p>As expected, nothing gets printed to the console.</p>
<p>Let us arm the system and then trigger a breach.</p>
<div class="code-container">
<pre>system.<span class="call">arm</span>()                        <span class="comment">// System armed</span>
system.<span class="call">breach</span>()                     <span class="comment">// Alarm sounded</span>
system.<span class="call">reset</span>(usingCode: <span class="string">"1234"</span>)     <span class="comment">// Code accepted</span>
                                    <span class="comment">// Alarm stopped</span>
                                    <span class="comment">// System disarmed</span></pre>
</div>
<p>This time, when the <span class="inline-code">breach()</span> method is called, the alarm is sounded as expected. We then call the <span class="inline-code">reset(usingCode:)</span> method to stop the alarm and disarm the system.</p>
<p>Let&#8217;t see if the panic switches also work as expected.</p>
<div class="code-container">
<pre>system.<span class="call">arm</span>()                        <span class="comment">// System armed</span>
system.<span class="call">panic</span>()                      <span class="comment">// Alarm sounded</span>
system.<span class="call">reset</span>(usingCode: <span class="string">"1234"</span>)     <span class="comment">// Code accepted</span>
                                    <span class="comment">// Alarm stopped</span>
                                    <span class="comment">// System disarmed</span></pre>
</div>
<p>A call to the <span class="inline-code">panic()</span> method has the same effect as the <span class="inline-code">breach()</span> method earlier. As before, we call the <span class="inline-code">reset(usingCode:)</span> method to stop the alarm and disarm the system.</p>
<p>So far we have only tested the normal case. Let&#8217;s see what happens when we try to disarm the system with the wrong code.</p>
<div class="code-container">
<pre>system.<span class="call">arm</span>()                        <span class="comment">// System armed</span>
system.<span class="call">disarm</span>(usingCode: <span class="string">"0000"</span>)    <span class="comment">// Invalid code</span>
system.<span class="call">disarm</span>(usingCode: <span class="string">"1234"</span>)    <span class="comment">// Code accepted</span>
                                    <span class="comment">// System disarmed</span></pre>
</div>
<p>When we use the wrong code, the state of the system remains unchanged and we just get a polite error message. When we use the correct code, the system gets disarmed.</p>
<p>Finally, let&#8217;s make sure that once we are in the Alarm state, the system can be reset only using the correct code.</p>
<div class="code-container">
<pre>system.<span class="call">arm</span>()                        <span class="comment">// System armed</span>
system.<span class="call">breach</span>()                     <span class="comment">// Alarm sounded</span>
system.<span class="call">reset</span>(usingCode: <span class="string">"1111"</span>)     <span class="comment">// Invalid code</span>
system.<span class="call">reset</span>(usingCode: <span class="string">"1234"</span>)     <span class="comment">// Code accepted</span>
                                    <span class="comment">// Alarm stopped</span>
                                    <span class="comment">// System disarmed</span></pre>
</div>
<p>As expected, when we enter an invalid code, it is rejected. The correct code is accepted, stopping the alarm and disarming the system.</p>
<h2 id="Dealing_with_Change">Dealing with Change</h2>
<p>It is said that change is the only constant in life. This is probably more true in systems development than in many other situations. Most real-world systems have to deal with change and the true test of the robustness of a design is how well it can embrace that change.</p>
<p>Let us now see how the State pattern allows our system to flex as business requirements change.</p>
<h3 id="Adding_a_transition">1. Adding a transition</h3>
<p>In the initial design of the security system, if a sensor is breached or a panic button is pressed while the system is disarmed, there is no effect. Some customers have asked for a design change where a panic can be triggered even when the system is disarmed. This panic functionality could then be used, even when the system is disarmed, to scare off any unsavoury characters who may lurking around a property secured by one of our security systems.</p>
<p>We modify the state diagram we had drawn earlier, to reflect the new requirement:</p>
<p><img src="https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddNewTransition.png" alt="State diagram for adding a transition to the security system" width="517" height="472" class="aligncenter size-full wp-image-1586" srcset="https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddNewTransition.png 517w, https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddNewTransition-300x274.png 300w" sizes="(max-width: 517px) 100vw, 517px" /></p>
<p>The only change from the earlier state diagram is a new transition from the Disarmed state to the Alarm state, triggered by a panic event.</p>
<p>To effect this change, we need to extend the behaviour of the system only when it is disarmed. With the behaviour related to every state encapsulated in its own type, all we have to do is add the following method to the <span class="inline-code">DisarmedState</span> class.</p>
<div class="code-container">
<pre><span class="keyword">func</span> panic(<span class="keyword">_</span> system: <span class="type">System</span>) {
    system.<span class="call">transition</span>(to: <span class="type">AlarmState</span>.<span class="property">instance</span>)
}</pre>
</div>
<p>Voila! Our system will now go into the Alarm state when a panic is triggered in the Disarmed state.</p>
<div class="code-container">
<pre><span class="keyword">let</span> system = <span class="type">SecuritySystemFactory</span>.<span class="call">create</span>(withCode: <span class="string">"1234"</span>)
system.<span class="call">panic</span>()                      <span class="comment">// Alarm sounded</span></pre>
</div>
<p>So far so good. </p>
<p>Time to crank our change request engine up a few notches.</p>
<h3 id="Adding_a_conditional_transition">2. Adding a conditional transition</h3>
<p>Let&#8217;s extend our example by adding a new business requirement. When the system is in the Armed state, the user should be given only a limited number of attempts to try and disarm it. If the user makes more than the permitted number of attempts using an invalid code, the system should sound the alarm.</p>
<p>We dust off our last state diagram and make the required changes:</p>
<p><img src="https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddConditionalTransition.png" alt="State diagram for adding a conditional transition to the security system" width="560" height="472" class="aligncenter size-full wp-image-1608" srcset="https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddConditionalTransition.png 560w, https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddConditionalTransition-300x253.png 300w" sizes="(max-width: 560px) 100vw, 560px" /></p>
<p>This will require us to add a new transition from the Armed state to the Alarm state, which is triggered by the disarm event, but has a guard clause and fires only if the code provided is not valid and the maximum number of permitted attempts has been exceeded.</p>
<p>The only changes we will need to make will be to the <span class="inline-code">ArmedState</span> class.</p>
<p>First, we add the following stored properties to enable tracking of the number of attempts made to disarm the system and to ensure that the maximum is not exceeded.</p>
<div class="code-container">
<pre><span class="keyword">private</span> <span class="keyword">var</span> disarmAttempts = <span class="number">0</span>
<span class="keyword">private</span> <span class="keyword">let</span> maxDisarmAttempts = <span class="number">3</span></pre>
</div>
<p>Then, we modify the <span class="inline-code">disarm(usingCode:_:)</span> method to increment <span class="inline-code">disarmAttempts</span> for each call and to trigger the Alarm state if the maximum number of attempts is exceeded.</p>
<div class="code-container">
<pre><span class="keyword">func</span> disarm(usingCode code: <span class="type">String</span>, <span class="keyword">_</span> system: <span class="type">System</span>) {
    disarmAttempts += <span class="number">1</span>
    <span class="keyword">if</span> system.<span class="call">isValid</span>(code: code) {
        system.<span class="call">transition</span>(to: <span class="type">DisarmedState</span>.<span class="property">instance</span>)
    } <span class="keyword">else</span> <span class="keyword">if</span> disarmAttempts &lt;= maxDisarmAttempts {
        <span class="keyword">return</span>
    } <span class="keyword">else</span> {
        system.<span class="call">transition</span>(to: <span class="type">AlarmState</span>.<span class="property">instance</span>)
    }
}</pre>
</div>
<p>Finally, we change the static stored property used to get an instance of <span class="inline-code">ArmedState</span> to a static computed property with the same name.</p>
<div class="code-container">
<pre><span class="keyword">static</span> <span class="keyword">var</span> instance: <span class="type">State</span> {
    <span class="keyword">return</span> <span class="type">ArmedState</span>()
}</pre>
</div>
<p>This is a subtle but important change. Without this, each time we get an instance of the <span class="inline-code">ArmedState</span> type, we would get the same unique instance. This means the starting value of <span class="inline-code">disarmAttempts</span> may or may not be zero. The computed property, on the other hand, creates a new <span class="inline-code">ArmedState</span> instance each time it is called, which ensures that we always get a freshly initialized <span class="inline-code">disarmAttempts</span> property.</p>
<p>That&#8217;s all we need to do. Time for some testing.</p>
<div class="code-container">
<pre><span class="keyword">let</span> system = <span class="type">SecuritySystemFactory</span>.<span class="call">create</span>(withCode: <span class="string">"1234"</span>)
system.<span class="call">arm</span>()                        <span class="comment">// System armed</span>
system.<span class="call">disarm</span>(usingCode: <span class="string">"0000"</span>)    <span class="comment">// Invalid code</span>
system.<span class="call">disarm</span>(usingCode: <span class="string">"1111"</span>)    <span class="comment">// Invalid code</span>
system.<span class="call">disarm</span>(usingCode: <span class="string">"2222"</span>)    <span class="comment">// Invalid code</span>
system.<span class="call">disarm</span>(usingCode: <span class="string">"3333"</span>)    <span class="comment">// Invalid code</span>
                                    <span class="comment">// Alarm sounded</span></pre>
</div>
<p>Sure enough, we are allowed three attempts with an invalid code, but the moment we try a fourth time, the alarm sounds.</p>
<h3 id="Adding_a_new_state">3. Adding a new state</h3>
<p>Let&#8217;s say we started off by selling our basic security system to home owners. As the fame of the system spread, it has attracted the attention of establishments such as banks, with more complex security requirements.</p>
<p>While home owners use the new panic feature to scare off random unsavoury characters, banks face the possibility of armed robbers entering the premises during normal hours of operation, when the system would normally be disarmed. To deal with such situations, banks typically install panic buttons out of public view, which can easily be activated by bank staff. However, if armed robbers have already entered the premises, it may not be wise to sound the alarm. What would be more useful is a mechanism which would trigger a message to law enforcement personnel, without sounding the alarm.</p>
<p>We know the drill. Let&#8217;s modify our state diagram to visualize the new requirement:</p>
<p><img src="https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddNewState.png" alt="State diagram for adding a new state to the security system" width="618" height="544" class="aligncenter size-full wp-image-1588" srcset="https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddNewState.png 618w, https://khawerkhaliq.com/wp-content/uploads/2018/12/StateDiagramAddNewState-300x264.png 300w" sizes="(max-width: 618px) 100vw, 618px" /></p>
<p>Our state diagram now sports a new Silent Alarm state, which results from a panic event when the system is in the Disarmed state. When the system is in the Silent Alarm state, it can be reset in the same way as for the Alarm state.</p>
<p>We define a new concrete State type called <span class="inline-code">SilentAlarmState</span> which, like all other concrete State types, conforms to the <span class="inline-code">State</span> protocol.</p>
<div class="code-container">
<pre><span class="keyword">class</span> SilentAlarmState: <span class="type">State</span> {
    <span class="keyword">func</span> enter(_: <span class="type">System</span>) {
        <span class="call">print</span>(<span class="string">"Police</span> <span class="string">informed"</span>)
    }
    
    <span class="keyword">func</span> reset(usingCode code: <span class="type">String</span>, <span class="keyword">_</span> system: <span class="type">System</span>) {
        <span class="keyword">guard</span> system.<span class="call">isValid</span>(code: code) <span class="keyword">else</span> { <span class="keyword">return</span> }
        system.<span class="call">transition</span>(to: <span class="type">DisarmedState</span>.<span class="property">instance</span>)
    }
    
    <span class="keyword">static</span> <span class="keyword">let</span> instance = <span class="type">SilentAlarmState</span>()
}</pre>
</div>
<p>The <span class="inline-code">enter(_:)</span> method informs the police. No <span class="inline-code">exit(_:)</span> method is required. The <span class="inline-code">reset(usingCode:_:)</span> method is the same as in the <span class="inline-code">AlarmState</span> class, to ensure that the system can be reset only using the correct code. </p>
<p>The only other thing we have to do is to modify the <span class="inline-code">panic(_:)</span> method in the <span class="inline-code">DisarmedState</span> class, as shown below.</p>
<div class="code-container">
<pre><span class="keyword">func</span> panic(<span class="keyword">_</span> system: <span class="type">System</span>) {
    system.<span class="call">transition</span>(to: <span class="type">SilentAlarmState</span>.<span class="property">instance</span>)
}</pre>
</div>
<p>That&#8217;s it. Time for a test-drive.</p>
<div class="code-container">
<pre><span class="keyword">let</span> system = <span class="type">SecuritySystemFactory</span>.<span class="call">create</span>(withCode: <span class="string">"1234"</span>)
system.<span class="call">panic</span>()                      <span class="comment">// Police informed</span>
system.<span class="call">reset</span>(usingCode: <span class="string">"1234"</span>)     <span class="comment">// Code accepted</span>
                                    <span class="comment">// System disarmed</span></pre>
</div>
<p>Everything works as expected and we can now sell our system to banks and other high-security establishments.</p>
<p>The above examples show the ability the State pattern gives us to accommodate changing requirements with only localized changes in code, without having the effects of these changes ripple through the code base.</p>
<h2 id="Key_design_and_implementation_considerations">Key design and implementation considerations</h2>
<h3 id="Handling_state_transitions">1. Handling state transitions</h3>
<p>A signature characteristic of the State pattern is transition between states, which leads to the question: Which participant should be responsible for deciding when to transition from one state to another and knowing which state to transition to under what conditions? This responsibility could be given to either the Context or the concrete State types themselves. While it is possible to make the Context responsible for controlling state transitions, that would concentrate too much responsibility in the Context. This could lead to creating just the kind of complex and hard-to-modify logic in the Context that the State pattern aims to avoid.</p>
<p>The more common approach, which we have also followed, is to let the concrete State types encapsulate the state transition logic. This does create a bit of dependency among the concrete State types, since each concrete State type must be aware of at least one other concrete State type. However, the benefit in making the transition logic decentralized and easy to modify makes this minor compromise worthwhile.</p>
<p>It is pertinent to note that while the Context in our approach does not decide when a transition is to happen and to which state, we have given responsibility to the context to process the transitions. This ensures that the specific steps required to complete each transition are centralized in one place and not sprinkled throughout the concrete State types.</p>
<h3 id="States_with_state">2. States with state</h3>
<p>Another question that arises when implementing the State patterns is: Should the concrete State classes have stored instance properties, or put another way, should the states have state of their own? It is perfectly acceptable to define concrete State types that have stored instance properties. These properties can be used by the concrete State types in meeting their responsibilities.</p>
<p>It could be especially interesting when some of these properties are mutable, allowing refinement of behaviour, depending on the values of these properties. In our example, as part of dealing with one of the change requests, we gave the <span class="inline-code">ArmedState</span> class one mutable and one immutable property. These allowed us to add a conditional transition from the Armed state to the Alarm state.</p>
<h3 id="Creating_states">3. Creating states</h3>
<p>Each transition needs an instance of the target concrete State type, which raises two questions. First, where should we put the logic related to creation of concrete State type instances? Second, do we create new instances of concrete State types for each transition or reuse existing instances? Let&#8217;s take these questions in turn.</p>
<p>There is an argument for putting state creation logic in the Context. However, this would mean that the Context would have knowledge of individual concrete State types and will have to change when we need to add or remove a state. The approach we have taken is to make each concrete State type responsible for dispensing its own instance, eliminating the need for the Context to know anything about individual concrete State types.</p>
<p>As long as the concrete State classes do not have any mutable stored properties, it is preferable to use one unique instance of each concrete State type. This avoids the overhead associated with creating and destroying class instances each time a state transition needs to be executed, making the process more efficient. If, however, any of the concrete State types has one or more mutable stored properties, we need to create new instances of those types to ensure that mutable stored properties in each instance have the expected initial values and not ones that may have carried over from a previous use of the same instance.</p>
<p>Swift lets us solve this problem simply and elegantly through the use of stored and computed properties, which can be used interchangeably in the sense that the call site does not need to know whether a property it is accessing is stored or computed. This enables us to use static stored properties containing unique concrete State type instances for those types that do not have mutable stored properties, while employing static computed properties to create new instances of those concrete State types that have mutable stored properties.</p>
<p>As we have seen for the <span class="inline-code">ArmedState</span> type in the example, we can change a property from stored to computed, without the need to change anything at the call site. In fact, we can freely switch back and forth between static stored and computed properties, depending on whether a particular concrete State type does or does not have stored mutable stored properties.</p>
<h3 id="Events_and_activities_not_applicable_to_certain_states">4. Events and activities not applicable to certain states</h3>
<p>It is quite common when using the State pattern to have trigger events that don&#8217;t apply to certain states. There may also be activities, such as entry and exit activities, that may apply to certain states but not to others. Having to implement all the methods of the abstract State interface in each concrete State class can cause a combinatorial explosion of methods, many of which don&#8217;t do anything. In fact this is sometimes held up as a weakness or drawback of the State pattern.</p>
<p>Swift, with its flexible protocols, facilitates a very simple solution. We define extensions of the <span class="inline-code">Events</span> and <span class="inline-code">Activities</span> protocols, which combine to form the <span class="inline-code">State</span> protocol, with empty implementations of all methods. This leaves the conforming concrete State types needing to implement methods related to only those events and activities that actually apply to them.</p>
<h3 id="Specifying_activities_in_states_or_transitions">5. Specifying activities in states or transitions</h3>
<p>In some cases, the same activity can potentially be specified as an activity in a state or as the effect of a transition. The most common case is when an activity can be specified as an entry activity for a state or as the effect of a transition terminating in that state.</p>
<p>It is important, in most cases, to think through whether an activity inherently relates to a state or to a transition. For example, if we put an activity that should belong to a state on a transition, it will break encapsulation of the state and cause logic related to the state to leak into transitions. It may also cause repetition of the same code if a state has multiple transitions leading into it and there is an activity that needs to be performed regardless of how the state is entered.</p>
<h2 id="Benefits_of_the_State_pattern">Benefits of the State pattern</h2>
<h3 id="Clear_control_flow">1. Clear control flow</h3>
<p>Compared to the alternative of using data values to represent states and making the Context responsible for deciding what action to perform for each event based on these data values, the State pattern delivers much clearer control flow. In fact, the Context is no longer responsible for the control flow. All it has to do is delegate state-specific behaviour to its abstract <span class="inline-code">state</span> property, and let the concrete instance it holds swing into action to provide the required functionality.</p>
<h3 id="Partitioning_of_behaviour">2. Partitioning of behaviour</h3>
<p>The State pattern lets us distribute the behavior of what would otherwise be a monolithic Context class to a number of concrete State types, each responsible for encapsulating the behaviour related to a single state of the Context. This leads to a neat partitioning of behaviour, with all behaviour related to a particular state localized in a single type. This includes not only the entry, exit and other activities associated with a state but also logic related to when it is possible to transition from the state and determining the target state for each transition.</p>
<h3 id="Ease_of_maintenance">3. Ease of maintenance</h3>
<p>As we have already seen, the State pattern makes it easy to modify and extend behaviour. Whether modifying the behavior of an existing state or adding a completely new state, the State pattern helps localize the effect of the change. This is thanks to decoupling of the Context type from the concrete State types that contain the logic related to the various states of the Context. The Context only uses the interface defined by the abstract State type, and is not dependent on any of the concrete State types. In fact, with the concrete State types taking responsibility for creating their own instances, the Context does not even need to be aware of how many concrete State type actually exist.</p>
<h2 id="Practical_applications_of_the_State_pattern">Practical applications of the State pattern</h2>
<p>Here is a sampling of some applications of the State pattern, discovered and described by practitioners and subject matter experts:</p>
<h3 id="Database_updates">1. Database updates</h3>
<p>[Larman] discusses employing the State pattern to simplify the logic used to commit or rollback changes made to records in a database. At any given time, a database record in memory may be new (not in the database) or old (retrieved from the database). An old record could be clean (unmodified) or dirty (modified).</p>
<p>Based on the state of a record, it should react differently to a commit or a rollback operation. For example, on a commit operation, an &#8220;old dirty&#8221; record should be updated to the database, because it has been modified since being retrieved, while an &#8220;old clean&#8221; record should simply be ignored since it has not been modified.</p>
<h3 id="Drawing_programs_and_frameworks">2. Drawing programs and frameworks</h3>
<p>[Gamma] talks about how the State pattern can be used to create interactive drawing programs and frameworks. In a typical drawing program, the user has a palette of &#8220;tools&#8221; to select from, which may include a drawing tool, a paint tool, a selection tool, a text tool, etc. Based on which tool the user has selected, user actions such as a mouse click, mouse press and release, keystroke input, etc., may be handled differently.</p>
<p>When the drawing tool is active, for instance, a mouse press may start the creation of a new shape while a mouse release may give the shape its final size and position. When the selection tool is active, the same mouse press may be used to mark the start of a rectangular area within which all shapes will be selected, while a mouse release may complete the selection.</p>
<h3 id="Graphical_user_interfaces">3. Graphical user interfaces</h3>
<p>[Martin] notes how the State pattern can be used to capture and implement high-level application policies for GUIs, making them explicit and easy to maintain. Modern GUIs can present a plethora of information in a single screen. However, not all information that could be presented may be applicable, relevant or even permitted for display at any given time. Similarly, certain tools or menu options could be made unavailable at certain times by disabling them or not displaying them altogether. For instance, different information and functionality will usually be available depending on whether the user is just browsing or logged in with a password. For multi-stage actions, the screen presented to the user may be different depending on what stage the user has reached.</p>
<h3 id="Network_protocols">4. Network protocols</h3>
<p>[Gamma] provides a worked example of how the State pattern can be used to model a TCP connection. An object representing a TCP connection can be in one of several different states, e.g., established, listening, closed. Depending on the current state of the connection, it will react differently to requests such as a request to open or close a connection.</p>
<h3 id="Game_programming">5. Game programming</h3>
<p>[Nystrom] describes how the State pattern can be used to control the behaviour and graphical representation of game characters, based on their current state. A character in an adventure game, for instance, can be in various states, such as standing, running, ducking, diving, sliding, etc. Depending on the state, the character would be represented differently on the screen and would react differently to various commands.</p>
<p>State pattern implementations could even be used concurrently to model not only the state of the character but also what equipment she may be carrying. The same fire command could then be used to release an arrow or fire a gun, depending on what weapon the character is wielding at the time.</p>
<h3 id="Embedded_systems">6. Embedded systems</h3>
<p>A number of real-world machines have distinct states, which determine whether and how the machine responds to a particular command or event.</p>
<p>[Freeman] gives an example of a gumball machine, which may or may not have gumballs to dispense and may or may not have coins inserted, so will react differently when the crank is turned depending on its state. Similar logic would apply to most vending machines.</p>
<p>[Martin] looks at a turnstile, the likes of which are found in places ranging from train stations and museums to lobbies of office buildings. A turnstile may be in a locked or unlocked state, may change state based on a valid ticket being inserted or an entry pass being scanned, and may or may not let a person through depending on its state.</p>
<h2 id="Conclusion">Conclusion</h2>
<p>A state machine is a useful abstraction to model entities commonly found in a number of real-world domains. The State pattern provides a robust and scalable way to implement a state machine. Owing to encapsulation of the behaviour related to individual states and decoupling of the Context from the concrete State types, there is clearer control flow and partitioning of behaviour, leading to more flexible and maintainable applications.</p>
<h2 id="References">References</h2>
<table>
<tbody>
<tr>
<td>[Gamma]</td>
<td>Gamma, E., Helm, R., Johnson, R. &amp; Vlissides, J. (1995). <em>Design Patterns: Elements of Reusable Object-Oriented Software</em>. Addison-Wesley</td>
</tr>
<tr>
<td>[Freeman]</td>
<td>Freeman, E., Freeman, E., Sierra, K. &amp; Bates, B. (2004). <em>Head First Design Patterns</em>. O&#8217;Reilly Media</td>
</tr>
<tr>
<td>[Larman]</td>
<td>Larman, C. (2005). <em>Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development</em> (3rd ed.). Prentice Hall</td>
</tr>
<tr>
<td>[Martin]</td>
<td>Martin, R. C. (2003). <em>Agile Software Development: Principles, Patterns and Practices</em>. Prentice Hall</td>
</tr>
<tr>
<td>[Nystrom]</td>
<td>Nystrom, R. (2014). <em>Game Programming Patterns</em></td>
</tr>
</tbody>
</table>
<p class="intro">Thank you for reading! I always appreciate constructive comments and feedback. Please feel free to leave a comment in the comments section of this post or start a conversation on <a href="https://twitter.com/khawerkhaliq/status/1070764654568398848" target="_blank" rel="noopener noreferrer">Twitter</a></p>
<p>.</p>
<div class="swp_social_panel swp_horizontal_panel swp_flat_fresh  swp_default_full_color swp_other_full_color swp_individual_full_color scale-100 scale-full_width" data-min-width="1100" data-float-color="#ffffff" data-float="none" data-float-mobile="none" data-transition="slide" ><div class="nc_tweetContainer swp_share_button swp_facebook" data-network="facebook"><a class="nc_tweet swp_share_link" rel="nofollow noreferrer noopener" target="_blank" href="https://www.facebook.com/share.php?u=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" data-link="https://www.facebook.com/share.php?u=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F"><span class="swp_count swp_hide"><span class="iconFiller"><span class="spaceManWilly"><i class="sw swp_facebook_icon"></i><span class="swp_share">Share</span></span></span></span></a></div><div class="nc_tweetContainer swp_share_button swp_twitter" data-network="twitter"><a class="nc_tweet swp_share_link" rel="nofollow noreferrer noopener" target="_blank" href="https://twitter.com/intent/tweet?text=Rethinking+Design+Patterns+in+Swift%3A+State+Pattern&url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" data-link="https://twitter.com/intent/tweet?text=Rethinking+Design+Patterns+in+Swift%3A+State+Pattern&url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F"><span class="swp_count swp_hide"><span class="iconFiller"><span class="spaceManWilly"><i class="sw swp_twitter_icon"></i><span class="swp_share">Tweet</span></span></span></span></a></div><div class="nc_tweetContainer swp_share_button swp_linkedin" data-network="linkedin"><a class="nc_tweet swp_share_link" rel="nofollow noreferrer noopener" target="_blank" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" data-link="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F"><span class="swp_count swp_hide"><span class="iconFiller"><span class="spaceManWilly"><i class="sw swp_linkedin_icon"></i><span class="swp_share">Share</span></span></span></span></a></div><div class="nc_tweetContainer swp_share_button swp_google_plus" data-network="google_plus"><a class="nc_tweet swp_share_link" rel="nofollow noreferrer noopener" target="_blank" href="https://plus.google.com/share?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F" data-link="https://plus.google.com/share?url=https%3A%2F%2Fkhawerkhaliq.com%2Fblog%2Fswift-design-patterns-state-pattern%2F"><span class="swp_count swp_hide"><span class="iconFiller"><span class="spaceManWilly"><i class="sw swp_google_plus_icon"></i><span class="swp_share">+1</span></span></span></span></a></div></div><div class="swp-content-locator"></div><!--<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/"
    dc:identifier="https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/"
    dc:title="Rethinking Design Patterns in Swift: State Pattern"
    trackback:ping="https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/trackback/" />
</rdf:RDF>-->
</div><footer class="entry-footer"><p class="entry-meta"></p></footer></article><div class="after-entry widget-area"><section id="enews-ext-14" class="widget enews-widget"><div class="widget-wrap"><div class="enews"><h3 class="widgettitle widget-title">Never miss a post</h3>
<p>Get notifications of new posts</p>
			<form id="subscribeenews-ext-14" action="https://app.convertkit.com/forms/733393/subscriptions" method="post"
																			target="_blank" onsubmit="if ( subbox1.value == 'First Name') { subbox1.value = ''; } if ( subbox2.value == 'Last Name') { subbox2.value = ''; }" name="enews-ext-14">
				<label for="subbox1" class="screenread">First Name</label><input type="text" id="subbox1" class="enews-subbox" value="" placeholder="First Name" name="first_name" />								<label for="subbox" class="screenread">Email Address</label><input type="email" value="" id="subbox" placeholder="Email Address" name="email_address"
																														required="required" />
								<input type="submit" value="Notify me" id="subbutton" />
			</form>
		<p>No spam. Unsubscribe any time</p>
</div></div></section>
</div><h2 class="screen-reader-text">Reader Interactions</h2><div class="entry-comments" id="comments"><h3>Comments</h3><ol class="comment-list">
	<li class="comment even thread-even depth-1" id="comment-63">
	<article itemprop="comment" itemscope itemtype="https://schema.org/Comment">

		
		<header class="comment-header">
			<p class="comment-author" itemprop="author" itemscope itemtype="https://schema.org/Person">
				<img alt='' src='https://secure.gravatar.com/avatar/096159dd231088fef3e8b9e7de44695d?s=48&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/096159dd231088fef3e8b9e7de44695d?s=96&#038;d=mm&#038;r=g 2x' class='avatar avatar-48 photo' height='48' width='48' /><span itemprop="name">Lang</span> <span class="says">says</span>			</p>

			<p class="comment-meta"><time class="comment-time" datetime="2019-02-16T02:59:44+00:00" itemprop="datePublished"><a href="https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/#comment-63" class="comment-time-link" itemprop="url">February 16, 2019 at 2:59 am</a></time></p>		</header>

		<div class="comment-content" itemprop="text">
			
			<p>Great article, very in-depth and well explained, would love to read more article like this.<br />
BTW, may I ask what tool are you using to draw the diagram?</p>
		</div>

		<div class="comment-reply"><a rel='nofollow' class='comment-reply-link' href='#comment-63' data-commentid="63" data-postid="1515" data-belowelement="comment-63" data-respondelement="respond" aria-label='Reply to Lang'>Reply</a></div>
		
	</article>
	<ul class="children">

	<li class="comment byuser comment-author-khawerkhaliqhotmail-com bypostauthor odd alt depth-2" id="comment-64">
	<article itemprop="comment" itemscope itemtype="https://schema.org/Comment">

		
		<header class="comment-header">
			<p class="comment-author" itemprop="author" itemscope itemtype="https://schema.org/Person">
				<img alt='' src='https://secure.gravatar.com/avatar/f7e0b011178e75d5bf36a2933ccc79fc?s=48&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/f7e0b011178e75d5bf36a2933ccc79fc?s=96&#038;d=mm&#038;r=g 2x' class='avatar avatar-48 photo' height='48' width='48' /><span itemprop="name">Khawer Khaliq</span> <span class="says">says</span>			</p>

			<p class="comment-meta"><time class="comment-time" datetime="2019-02-16T04:49:39+00:00" itemprop="datePublished"><a href="https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/#comment-64" class="comment-time-link" itemprop="url">February 16, 2019 at 4:49 am</a></time></p>		</header>

		<div class="comment-content" itemprop="text">
			
			<p>Hi Lang, </p>
<p>Many thanks. I am glad that you liked the article. My articles generally tend to look at a topic in a fair bit of depth. This is not to everyones liking but is appreciated by people looking to work through a topic. More articles will be coming in due course, including on the application of design patterns in Swift. </p>
<p>For drawing, I use SmartDraw (<a href="https://www.smartdraw.com" rel="nofollow">https://www.smartdraw.com</a>). It is easy to use, fairly powerful and can be used across devices, even operating systems, since it is browser based.</p>
		</div>

		<div class="comment-reply"><a rel='nofollow' class='comment-reply-link' href='#comment-64' data-commentid="64" data-postid="1515" data-belowelement="comment-64" data-respondelement="respond" aria-label='Reply to Khawer Khaliq'>Reply</a></div>
		
	</article>
	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol></div>	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/swift-design-patterns-state-pattern/#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="https://khawerkhaliq.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate>
				<p class="comment-notes"><span id="email-notes">Your e-mail address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1515' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="665cf967c8" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="233"/></p>			</form>
			</div><!-- #respond -->
	</main><aside class="sidebar sidebar-primary widget-area" role="complementary" aria-label="Primary Sidebar" itemscope itemtype="https://schema.org/WPSideBar" id="genesis-sidebar-primary"><h2 class="genesis-sidebar-title screen-reader-text">Primary Sidebar</h2><section id="custom_html-8" class="widget_text widget widget_custom_html"><div class="widget_text widget-wrap"><div class="textwidget custom-html-widget"><a href="https://twitter.com/khawerkhaliq?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-dnt="true" data-show-count="false">Follow @khawerkhaliq</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></div></section>
<section id="enews-ext-16" class="widget enews-widget"><div class="widget-wrap"><div class="enews"><h3 class="widgettitle widget-title">Never miss a post</h3>
<p>Get notifications of new posts</p>
			<form id="subscribeenews-ext-16" action="https://app.convertkit.com/forms/733393/subscriptions" method="post"
																			target="_blank" onsubmit="if ( subbox1.value == 'First Name') { subbox1.value = ''; } if ( subbox2.value == 'Last Name') { subbox2.value = ''; }" name="enews-ext-16">
				<label for="subbox1" class="screenread">First Name</label><input type="text" id="subbox1" class="enews-subbox" value="" placeholder="First Name" name="first_name" />								<label for="subbox" class="screenread">Email Address</label><input type="email" value="" id="subbox" placeholder="Email Address" name="email_address"
																														required="required" />
								<input type="submit" value="Notify me" id="subbutton" />
			</form>
		<p>No spam. Unsubscribe any time.</p>
</div></div></section>
<section id="category-posts-19" class="widget cat-post-widget"><div class="widget-wrap"><h3 class="widgettitle widget-title">Recent Articles</h3>
<ul id="category-posts-19-internal" class="category-posts-internal">
<li class='cat-post-item'><div><a class="cat-post-title" href="https://khawerkhaliq.com/blog/swift-domain-logic-business-rules-value-types/" rel="bookmark">Encapsulating Domain Data, Logic and Business Rules With Value Types in Swift</a></div><div>
<span class="cat-post-date">January 30, 2019</span></div></li><li class='cat-post-item'><div><a class="cat-post-title" href="https://khawerkhaliq.com/blog/swift-optionals-part-two/" rel="bookmark">Programming Safely and Effectively With Optionals in Swift  (Part Two)</a></div><div>
<span class="cat-post-date">August 6, 2018</span></div></li><li class='cat-post-item'><div><a class="cat-post-title" href="https://khawerkhaliq.com/blog/swift-optionals-part-one/" rel="bookmark">Programming Safely and Effectively With Optionals in Swift  (Part One)</a></div><div>
<span class="cat-post-date">August 6, 2018</span></div></li><li class='cat-post-item'><div><a class="cat-post-title" href="https://khawerkhaliq.com/blog/swift-error-handling/" rel="bookmark">Understanding, Preventing and Handling Errors in Swift</a></div><div>
<span class="cat-post-date">February 26, 2018</span></div></li><li class='cat-post-item'><div><a class="cat-post-title" href="https://khawerkhaliq.com/blog/swift-design-patterns-command-pattern/" rel="bookmark">Rethinking Design Patterns in Swift: Command Pattern</a></div><div>
<span class="cat-post-date">January 9, 2018</span></div></li></ul>
</div></section>
<section id="category-posts-18" class="widget cat-post-widget"><div class="widget-wrap"><h3 class="widgettitle widget-title">Recent Tips</h3>
<ul id="category-posts-18-internal" class="category-posts-internal">
<li class='cat-post-item'><div><a class="cat-post-title" href="https://khawerkhaliq.com/blog/swift-conditional-logic-conditional-statements/" rel="bookmark">Conditional Logic With and Without Conditional Statements in Swift</a></div><div>
<span class="cat-post-date">April 20, 2018</span></div></li><li class='cat-post-item'><div><a class="cat-post-title" href="https://khawerkhaliq.com/blog/swift-generic-types-numeric-protocol/" rel="bookmark">Better Generic Types in Swift With the Numeric Protocol</a></div><div>
<span class="cat-post-date">March 21, 2018</span></div></li></ul>
</div></section>
</aside></div></div></div><footer class="site-footer" itemscope itemtype="https://schema.org/WPFooter"><div class="wrap"><p>Copyright &copy; Khawer Khaliq, 2017-19.   All rights reserved.</p></div></footer><script type='text/javascript'>
/* <![CDATA[ */
var socialWarfare = {"addons":[{"name":"Social Warfare - Pro","key":"pro","core_required":"3.3.0","product_id":63157,"store_url":"https:\/\/warfareplugins.com","version":"3.5.4","filepath":"\/home2\/khawerkh\/public_html\/wp-content\/plugins\/social-warfare-pro\/social-warfare-pro.php","license_key":true,"is_registered":true},"pro"],"post_id":"1515","floatBeforeContent":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-content/plugins/social-warfare/assets/js/script.min.js?ver=3.5.4'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-includes/js/comment-reply.min.js?ver=5.1.1'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-includes/js/hoverIntent.min.js?ver=1.8.1'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-content/themes/genesis/lib/js/menu/superfish.min.js?ver=1.7.10'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-content/themes/genesis/lib/js/menu/superfish.args.min.js?ver=2.9.1'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-content/themes/genesis/lib/js/skip-links.min.js?ver=2.9.1'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-content/themes/monochrome-pro/js/global.js?ver=1.0.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var genesis_responsive_menu = {"mainMenu":"Menu","menuIconClass":"ionicons-before ion-navicon","subMenu":"Submenu","subMenuIconClass":"ionicons-before ion-chevron-down","menuClasses":{"combine":[],"others":[".nav-primary"]}};
/* ]]> */
</script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-content/themes/monochrome-pro/js/responsive-menus.min.js?ver=1.0.1'></script>
<script type='text/javascript' src='https://khawerkhaliq.com/wp-includes/js/wp-embed.min.js?ver=5.1.1'></script>
<script async="async" type='text/javascript' src='https://khawerkhaliq.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1.1'></script>
<script type="text/javascript"> var swp_nonce = "31cb306c36";
function parentIsEvil() { var html = null; try { var doc = top.location.pathname; } catch(err){ }; if(typeof doc === "undefined") { return true } else { return false }; }; if (parentIsEvil()) { top.location = self.location.href; };var url = "https://khawerkhaliq.com/blog/swift-design-patterns-state-pattern/";if(url.indexOf("stfi.re") != -1) { var canonical = ""; var links = document.getElementsByTagName("link"); for (var i = 0; i < links.length; i ++) { if (links[i].getAttribute("rel") === "canonical") { canonical = links[i].getAttribute("href")}}; canonical = canonical.replace("?sfr=1", "");top.location = canonical; console.log(canonical);};var swpFloatBeforeContent = false;var swpClickTracking = false; swpPinIt={"enabled":false};</script></body></html>
