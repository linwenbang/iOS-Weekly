<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Improving Your Build Time in Xcode 10 &middot; Patrick Balestra
    
  </title>

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39434190-8', 'auto');
  ga('send', 'pageview');
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Patrick Balestra
      </a>
    </div>
    <p class="lead">iOS Engineer at <a href="http://spotify.com" target="_blank">Spotify</a>.<br>Conference organizer.<br>OSS contributor.</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">About</a>
  
  
    <a class="page-link " href="/blog">Blog</a>
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/experience">Experience</a>
    
  

  
    
  

  
    
  

  

  
    
      <a class="page-link "
          href="/projects">Projects</a>
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
  

  
    
  

  
    
  


  


  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  <nav id="sidebar-icon-links">
  
    <a id="github-link"
      class="icon" title="Github" aria-label="Github"
      target="_blank"
      href="https://github.com/balestrapatrick">
      <?xml version="1.0" encoding="UTF-8"?>
<svg width="30px" height="30px" viewBox="0 0 30 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <path d="M14.937931,0.210344828 C23.1849138,0.210344828 29.8758621,6.9012931 29.8758621,15.1482759 C29.8758621,21.7421276 25.5973897,27.3438517 19.6645414,29.3281069 C18.9064414,29.4637931 18.6338241,28.9969828 18.6338241,28.6085966 C18.6338241,28.121869 18.6537414,26.5085724 18.6537414,24.5044 C18.6537414,23.103969 18.186931,22.2089379 17.6429414,21.7421276 C20.9691207,21.3724138 24.4695759,20.107669 24.4695759,14.3702586 C24.4695759,12.7358 23.8857517,11.4137931 22.9334586,10.3631586 C23.0890621,9.97352759 23.5944621,8.45732759 22.7778552,6.3958931 C21.5330276,6.00626207 18.6736586,7.93201034 18.6736586,7.93201034 C17.4873379,7.60088621 16.2039207,7.42661034 14.9391759,7.42661034 C13.674431,7.42661034 12.3910138,7.60213103 11.2046931,7.93201034 C11.2046931,7.93201034 8.34532414,6.00626207 7.10049655,6.3958931 C6.28388966,8.45732759 6.78928966,9.97477241 6.9448931,10.3631586 C5.99135517,11.4137931 5.40877586,12.7358 5.40877586,14.3702586 C5.40877586,20.0889966 8.89055862,21.3724138 12.2167379,21.7421276 C11.7885172,22.1317586 11.400131,22.7927621 11.2632,23.7450552 C10.4067586,24.1346862 8.22831034,24.7956897 6.92622069,22.5002276 C6.10961379,21.0798793 4.63075862,20.9641103 4.63075862,20.9641103 C3.17182069,20.9441931 4.53366207,21.8778138 4.53366207,21.8778138 C5.50587241,22.3247069 6.1867931,24.0562621 6.1867931,24.0562621 C7.0619069,26.7214379 11.2246103,25.8264069 11.2246103,25.8264069 C11.2246103,27.0712345 11.2445276,28.2376379 11.2445276,28.6073517 C11.2445276,28.9969828 10.9719103,29.4637931 10.2138103,29.3268621 C4.28096207,27.3426069 0.00248965517,21.7408828 0.00248965517,15.147031 C0.00248965517,6.90004828 6.69343793,0.2091 14.9404207,0.2091 L14.937931,0.210344828 Z M5.66023103,21.6637034 C5.69882069,21.5852793 5.64031379,21.4881828 5.52454483,21.4309207 C5.40753103,21.392331 5.31043448,21.4110034 5.27184483,21.4695103 C5.23325517,21.5479345 5.29176207,21.645031 5.40753103,21.7022931 C5.50462759,21.7608 5.62164138,21.7408828 5.66023103,21.6637034 Z M6.26272759,22.3259517 C6.34115172,22.2674448 6.32123448,22.1317586 6.22413793,22.0147448 C6.12704138,21.9176483 5.99135517,21.8790586 5.91293103,21.9562379 C5.8345069,22.0147448 5.85442414,22.150431 5.95152069,22.2674448 C6.04861724,22.3645414 6.18430345,22.403131 6.26272759,22.3259517 Z M6.84655172,23.2010655 C6.94364828,23.1226414 6.94364828,22.9682828 6.84655172,22.8313517 C6.76812759,22.6956655 6.61376897,22.6371586 6.51542759,22.7143379 C6.41833103,22.7728448 6.41833103,22.9284483 6.51542759,23.0641345 C6.61252414,23.1998207 6.76812759,23.2583276 6.84655172,23.1998207 L6.84655172,23.2010655 Z M7.66315862,24.0176724 C7.74158276,23.9392483 7.70174828,23.7649724 7.58473448,23.6479586 C7.44904828,23.5122724 7.27352759,23.4923552 7.19510345,23.5894517 C7.0980069,23.6678759 7.13659655,23.8421517 7.27352759,23.9591655 C7.40921379,24.0948517 7.58473448,24.114769 7.66315862,24.0176724 Z M8.7723,24.5044 C8.81088966,24.3873862 8.69387586,24.2517 8.5196,24.1931931 C8.36399655,24.1546034 8.18847586,24.2131103 8.14988621,24.3288793 C8.11129655,24.4446483 8.22831034,24.5815793 8.40258621,24.620169 C8.55818966,24.6786759 8.73371034,24.620169 8.7723,24.5031552 L8.7723,24.5044 Z M9.99721034,24.6014966 C9.99721034,24.4658103 9.8416069,24.3687138 9.66608621,24.3873862 C9.49056552,24.3873862 9.35487931,24.4844828 9.35487931,24.6014966 C9.35487931,24.7371828 9.49056552,24.8342793 9.68600345,24.8156069 C9.86152414,24.8156069 9.99721034,24.7185103 9.99721034,24.6014966 Z M11.1250241,24.4073034 C11.1051069,24.2902897 10.9495034,24.2131103 10.7752276,24.2317828 C10.5997069,24.2703724 10.4839379,24.3873862 10.5026103,24.5230724 C10.5225276,24.6400862 10.678131,24.7172655 10.8524069,24.6786759 C11.0266828,24.6400862 11.1436966,24.5230724 11.1250241,24.4060586 L11.1250241,24.4073034 Z" id="Shape"></path>
</svg>
    </a>
    <a id="twitter-link"
      class="icon" title="Twitter" aria-label="Twitter"
      target="_blank"
      href="https://twitter.com/BalestraPatrick">
      <?xml version="1.0" encoding="UTF-8"?>
<svg width="37px" height="29px" viewBox="0 0 37 29" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <path d="M36.9275447,3.45347824 C35.5632265,4.03178346 34.1064122,4.4257446 32.5725178,4.60562875 C34.1357027,3.69728815 35.3381526,2.26564823 35.9070039,0.557492182 C34.44094,1.38258061 32.816091,1.98318552 31.0864131,2.31768083 C29.7051373,0.891987492 27.736511,0 25.5505187,0 C21.3619849,0 17.9658348,3.27508074 17.9658348,7.30983749 C17.9658348,7.88962936 18.0352069,8.44712155 18.1616183,8.9808274 C11.8564643,8.69390475 6.26815549,5.77413236 2.52822799,1.36028092 C1.86996375,2.43363921 1.50152077,3.68093505 1.50152077,5.03972933 C1.50152077,7.58189368 2.84271489,9.81632235 4.87454689,11.1290306 C3.63047373,11.0903778 2.46039748,10.7603424 1.43985667,10.2132568 L1.43985667,10.3039422 C1.43985667,13.8495925 4.04978959,16.806531 7.52301987,17.4799815 C6.88633807,17.6449992 6.21419941,17.734198 5.52510312,17.734198 C5.04103996,17.734198 4.57701762,17.6895986 4.11299529,17.6063464 C5.08574643,20.5097657 7.88221324,22.6267494 11.2105329,22.6862152 C8.62064081,24.647101 5.33856923,25.8156047 1.80367485,25.8156047 C1.2024499,25.8156047 0.602766551,25.7814118 0,25.7159994 C3.37456773,27.7883837 7.3503604,29 11.6498896,29 C25.607558,29 33.2307821,17.8561029 33.2307821,8.20777157 C33.2307821,7.89706259 33.2307821,7.58338033 33.207658,7.2711847 C34.689138,6.24688573 35.9825424,4.95201722 37,3.48321115 L36.9275447,3.45347824 Z" id="Shape"></path>
</svg>
    </a>
    <a id="linkedin-link"
      class="icon" title="Linkedin" aria-label="Linkedin"
      target="_blank"
      href="https://www.linkedin.com/in/balestrapatrick/">
      <svg aria-labelledby="simpleicons-linkedin-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title id="simpleicons-linkedin-icon">LinkedIn icon</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
    </a>
    <a id="instagram-link"
      class="icon" title="Instagram" aria-label="Instagram"
      target="_blank"
      href="https://instagram.com/balestrapatrick">
      <svg aria-labelledby="simpleicons-instagram-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title id="simpleicons-instagram-icon">Instagram icon</title><path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"/></svg>
    </a>
    <a id="stackoverflow-link"
      class="icon" title="StackOverflow" aria-label="StackOverflow"
      target="_blank"
      href="https://stackoverflow.com/users/1408403/balestrapatrick">
      <svg aria-labelledby="simpleicons-stackoverflow-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title id="simpleicons-stackoverflow-icon">Stack Overflow icon</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"/></svg>
    </a>
    <a id="email-link"
      class="icon" title="Email" aria-label="Email"
      target="_blank"
      href="mailto:me@patrickbalestra.com">
      <svg aria-labelledby="simpleicons-telegram-icon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title id="simpleicons-telegram-icon">Telegram icon</title><path d="M9.028 20.837c-.714 0-.593-.271-.839-.949l-2.103-6.92L22.263 3.37"/><path d="M9.028 20.837c.552 0 .795-.252 1.105-.553l2.941-2.857-3.671-2.214"/><path d="M9.403 15.213l8.89 6.568c1.015.56 1.748.271 2-.942l3.62-17.053c.372-1.487-.564-2.159-1.534-1.72L1.125 10.263c-1.45.582-1.443 1.392-.264 1.753l5.455 1.7L18.94 5.753c.595-.36 1.143-.167.694.232"/></svg>
    </a>
  

  <!-- <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a> -->

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p>
  <!-- &copy; 2018 -->
  <!-- <a href="/LICENSE.md">MIT License.</a> -->
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Improving Your Build Time in Xcode 10</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">27 Aug 2018  - <i>7 min read</i>  </span>
  <span class="post-categories">
    
  </span>
</div>


  <div class="post-body">
    <p>I finally had time to watch some of the WWDC talks related to Xcode 10 today, and I wanted to share some very interesting and useful new tips to improve the build times of Swift and Objective-C projects in Xcode 10.
<!--more--></p>

<p>Most of the content in this post is taken from <a href="https://developer.apple.com/videos/play/wwdc2018/408/">WWDC 2018 Session 408 - Building Faster in Xcode</a>.</p>

<h2 id="parallelizing-your-build-process">Parallelizing your build process</h2>

<p>Previously to Xcode 10, all the targets were built serially, which means that only one target can be built at any given time. Xcode 10 is now much faster in building since it distributes tasks across multiple cores to build targets in parallel whenever possible. Let’s take the example shown in the session to see how the timeline would look in order to build 5 targets in Xcode 9.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/serialized-timeline.png" alt="Serialized Work" />
<em>In Xcode 9 every target is built after the other.</em></p>

<p>All the targets are built one after the other, starting from the ones that are dependencies of other targets. One real example of where you may have noticed this behavior is when using CocoaPods. If you have 10 dependencies in your <code class="highlighter-rouge">Podfile</code>, Xcode needs to build all the Pods before building your target. This is why using Carthage usually decreases your build times, since the dependencies are compiled once and only linked at runtime with your app target.</p>

<p>Xcode 10 tries to make better utilization of the available hardware by distributing on multiple cores the targets to build. Thus, the timeline could look like something like this.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/parallelization-timeline.png" alt="Serialized Work" />
<em>By reducing the size of your targets, you will obtain a better parallelization.</em></p>

<p>When opening your project in Xcode 10, build parallelization should already be enabled. To check or change this option, open your scheme editor, select “Build” in the sidebar and make sure “Parallelize Build” is checked at the top.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/parallelized-build.png" alt="Parallelized Build" />
<em>Xcode Scheme editor build options.</em></p>

<p>Of course, Xcode can’t build all your targets at once. Your project will most likely have some dependencies between the targets. A cool algorithm that is usually used to solve dependencies and figure out the order of compilation is <a href="https://en.wikipedia.org/wiki/Topological_sorting">topological sorting</a>.</p>

<p><em>Fun fact: this is a common topic in technical interviews at <a href="https://www.reddit.com/r/cscareerquestions/comments/6tkc59/what_is_a_big_n_company/">Big N</a> companies, so definitely learn more about it if you’re interested in computer science problems.</em></p>

<p>There’s one thing that you can do to help Xcode in parallelizing the work: split up your targets into smaller units. One example is creating a separate testing target for each framework, instead of testing all the libraries in a single unit testing bundle.</p>

<p>You can view the dependencies of a target directly in the “Build Phases” section. Let’s take one of my side projects that I have been working on lately, <a href="https://github.com/BalestraPatrick/Tweetometer/">Tweetometer</a>. <code class="highlighter-rouge">TweetometerKit</code> is a framework that contains the business logic of the app, such as network requests and models. The main app target <code class="highlighter-rouge">Tweetometer</code> specifies <code class="highlighter-rouge">TweetometerKit</code> as an explicit target dependency, in order to tell Xcode that it requires the framework to be ready before it can compile itself. In the “Link Binary with Libraries”, implicit target dependencies are specified which are also used to figure out the dependency order.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/build-phases.png" alt="Build Phases" />
<em>An example of build phases that specify dependencies between modules.</em></p>

<p>If your Xcode project is a few years old and survived some refactorings, make sure you are not specifying unnecessary target dependencies that may slow down your build.</p>

<p>One last improvement in the Xcode 10 build process worth mentioning is the parallelization of some parts of the build process. Xcode starts the compilation of a target as soon as the build and the run script phases of its dependencies are complete. This means that the next target to be built will start a little bit early compared to Xcode 9, since linking and other operations can now be done in parallel.</p>

<h2 id="declaring-script-inputs-and-outputs">Declaring script inputs and outputs</h2>
<p>A run script phase allows you to execute custom code during the compilation of the target. You may have created a run script to invoke Carthage’s <code class="highlighter-rouge">copy-frameworks</code> script. I also use this feature in Tweetometer in combination with <a href="https://github.com/SwiftGen/SwiftGen">swiftgen</a> to generate boilerplate code to safely access Storyboards views, Localizable strings and resources stored in the Asset Catalog. A run script is always run if a list of input files is not specified, the list of inputs changes or the output files are missing.
The following run script is only executed in case <code class="highlighter-rouge">carthage update</code> is run and the frameworks are re-built, otherwise it’s skipped saving precious time in your builds.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/run-script-carthage.png" alt="Run Script Carthage" />
<em>A common run script required when using Carthage.</em></p>

<p>The following run script invokes <code class="highlighter-rouge">swiftgen</code> every time the projects builds since no input or output files are specified.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/run-script-swiftgen.png" alt="Run Script Swiftgen" />
<em>A custom run script that invokes an external tool to generate source code.</em></p>

<p>As you may have noticed from these screenshots, Xcode 10 has a new option to specify an input and output file lists. In case you have many files to list, you can do so by simply creating a <code class="highlighter-rouge">.xcfilelist</code> file and specify all the directories in it. You could for example set up a script to automatically update a <code class="highlighter-rouge">Carthage.xcfilelist</code> every time you add a new dependency in order to avoid forgetting to add a new input and output file. The format of the file is pretty straightforward:</p>

<pre>
<code>
$(SRCROOT)/Carthage/Build/iOS/Presentr.framework
$(SRCROOT)/Carthage/Build/iOS/ValueStepper.framework
$(SRCROOT)/Carthage/Build/iOS/Whisper.framework
$(SRCROOT)/Carthage/Build/iOS/Kingfisher.framework
</code>
</pre>

<p>Xcode 10 got much better in diagnosing dependency cycles in your project by giving detailed errors in the build log. A <a href="https://help.apple.com/xcode/mac/10.0/#/dev621201fb0">new guide</a> has also been published online to learn how to troubleshoot and fix a cycle.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/dependency-cycle.png" alt="Dependency Cycle" />
<em>A new error message is displayed if your build presents cycles.</em></p>

<p>Apple also released <a href="https://help.apple.com/xcode/mac/10.0/#/devc8c930575">more documentation</a> about these features and a lot of other details related to the Xcode build process (such as a <a href="https://help.apple.com/xcode/mac/10.0/#/itcaec37c2a6">build settings reference page</a> for example).</p>

<h2 id="measuring-your-build-time">Measuring your build time</h2>

<p>Xcode 10 brings some new features to identify how long each component of your project is taking to compile. In previous versions, there was no official way to know how long each file took to compile, except some third-party tools or undocumented compiler flags. Xcode now shows directly in the build log how long each file took to compile as shown in the following image.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/build-log.png" alt="Build Log" />
<em>The build now displays the compilation time for each file.</em></p>

<p>There’s also a new feature that allows you to debug and see how long each step of the build process is taking. This enables to quickly see if a run script phase is configured properly to run only when necessary. Select <code class="highlighter-rouge">Product -&gt; Perform Action -&gt; Build With Timing Summary</code> to build and see the timing summary at the end of the build log. You can also set the <code class="highlighter-rouge">-showBuildTimingSummary</code> parameter if you’re using <code class="highlighter-rouge">xcodebuild</code>.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/build-timing-summary.png" alt="Build Timing Summary" />
<em>The Build Timing Summary is a quick way to see the overall time distribution.</em></p>

<h2 id="dealing-with-complex-swift-expressions">Dealing with complex Swift expressions</h2>

<p>You may remember from your researches on how to improve the Swift compilation time about the “Compilation Mode” build setting. In some projects, setting the “Compilation Mode” to “Whole Module” resulted in faster build times with previous versions of the compiler. The Swift compiler has been now updated to be more efficient in incremental builds so this workaround is not applicable anymore. It may slow down your builds since it turns off incremental builds. Make sure to select the setting in your Xcode project and press “delete” to set it back to the default value “Incremental”.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/compilation-mode.png" alt="Compilation Mode" />
<em>The debug and release Compilation Mode build setting.</em></p>

<p>Another source of slowdown in the compilation of your Swift source code is the evaluation of complex expressions. The following is an extreme example of what you should avoid doing in your code. If you really have to write code like this, try to break it up into multiple expressions and specify the return types or local variables types manually. Including complex expressions in the ternary operator, or using very generic operators such as <code class="highlighter-rouge">+=</code> instead of <code class="highlighter-rouge">append</code> on <code class="highlighter-rouge">Array</code> are other examples of possible slow-downs to be aware of.</p>

<pre>
<code>
<span class="keyword">func</span> sumNonOptional(i: <span class="type">Int</span>?, j: <span class="type">Int</span>?, k: <span class="type">Int</span>?) -&gt; <span class="type">Int</span>? {
    <span class="keyword">return</span> [i, j, k].<span class="call">reduce</span>(<span class="number">0</span>) { soFar, next <span class="keyword">in</span>
        soFar != <span class="keyword">nil</span> &amp;&amp; next != <span class="keyword">nil</span> ? soFar! + next! : (soFar != <span class="keyword">nil</span> ? soFar! : (next != <span class="keyword">nil</span> ? next! : <span class="keyword">nil</span>))
    }
}
</code>
</pre>

<h2 id="understanding-dependencies-in-swift">Understanding dependencies in Swift</h2>

<p>Swift doesn’t have header files like Objective-C, therefore it’s important to understand how the Swift compiler recognizes which files to recompile when a change is made. Swift supports multiple objects in the same source code file so you could define all your project’s entities in a single file if you really wanted (please don’t). The compiler tracks files and not single entities such as different <code class="highlighter-rouge">struct</code>, <code class="highlighter-rouge">enum</code> or <code class="highlighter-rouge">class</code>. If you happen to have a single file with 10 different entities defined in it such as a <code class="highlighter-rouge">protocol</code>, <code class="highlighter-rouge">enum</code>, <code class="highlighter-rouge">struct</code> and <code class="highlighter-rouge">class</code>, adding or removing entities in the same file or simply changing source code outside the function bodies will trigger a re-compilation of the whole file. Let’s see an example to better understand this concept.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/swift-dependencies.png" alt="Swift Dependencies" />
<em>A very simple example that shows why Swift re-compiles both files.</em></p>

<p>The file on the left defines a <code class="highlighter-rouge">Point</code> struct. The file on the right instead, simply defines two top-level properties which invoke the <code class="highlighter-rouge">Point</code> initializer. Adding the new <code class="highlighter-rouge">PathSegment</code> struct to the same file where <code class="highlighter-rouge">Point</code> is defined, will cause the Swift compiler to conservatively rebuild both files. This wouldn’t happen if the <code class="highlighter-rouge">point</code> constant on the right file was defined inside a function, but it’s still something to keep in mind. The Swift compiler is only able to avoid recompiling other files if your changes are confined to the function bodies. Changes to a method implementation obviously don’t affect the file’s interface but in all other cases, the compiler will trigger a recompilation of all the files that depend on it. To reduce this behavior, you should try to split up your entities in separate files. Creating a new file for each entity will not only make your incremental builds shorter but also make it even easier to find what you’re looking for in your project.</p>

<h2 id="limiting-your-objective-cswift-interface">Limiting your Objective-C/Swift interface</h2>

<p>Let’s now see how the previous concept of code dependency plays in a mixed-source target written in both Swift and Objective-C.</p>

<p>There are two types of headers:</p>
<ul>
  <li>Bridging Header: collects the Objective-C interfaces that should be exposed to Swift.</li>
  <li>Generated Header: collects the Swift interfaces that should be exposed to Objective-C.</li>
</ul>

<p>These files are used in order to figure out the dependencies between Swift and Objective-C. If the following Swift class is changed, it will require a recompilation of all Objective-C files that reference it for example.</p>

<pre>
<code>
<span class="keyword">class</span> EmptyStateViewController: <span class="type">UIViewController</span> {
    <span class="keyword">@IBOutlet</span> <span class="keyword">var</span> messageLabel: <span class="type">UILabel</span>!
}
</code>
</pre>

<p>It is a good idea to define properties or functions which are exposed to Objective-C by default as <code class="highlighter-rouge">private</code>. This also benefits the encapsulation of your code since no other object in the same module will be able to modify the <code class="highlighter-rouge">messageLabel</code> by mistake.</p>

<p>One last build setting to check in your target is the “Swift 3 @objc Inference”. You may not even know about this build setting at all because it was created automatically during the Swift 4 migration performed by Xcode. This behavior caused every property in an <code class="highlighter-rouge">NSObject</code> subclass to be exposed to Objective-C in the Generated Header. You should now set the build setting to the default value by pressing “delete” on it. If your project fails to compile since Objective-C can’t find a method defined in Swift, simply add <code class="highlighter-rouge">@objc</code> to the function declaration in order to comply with the new Swift 4 behavior.</p>

<p><img src="/assets/blog/improving-your-build-time-in-xcode-10/objc-inference.png" alt="Objective-C Inference" /></p>

<p>I hope this post was useful and will save some time to your Mac’s CPU with the upcoming Xcode 10 update.</p>

<p>Feel free to <a href="https://twitter.com/BalestraPatrick">tweet me</a> with any questions or comment. 👍</p>

<p>P.s: all Swift snippets in this post have been generated with <a href="https://github.com/johnsundell/Splash">Splash</a>, a new Swift syntax highlighter just open-sourced by my friend John Sundell. Check it out!</p>

    



<div class="post-tags">
  
</div>
  </div>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
    
      
        
        <li>
          <h3>
            <a href="/blog/2018/11/12/contributing-to-the-swift-benchmark-suite.html">
              Contributing to the Swift Benchmark Suite
              <small>12 Nov 2018</small>
            </a>
          </h3>
        </li>
        
      
    
      
        
        <li>
          <h3>
            <a href="/blog/2018/08/06/my-tech-interviews-experience.html">
              My Tech Interviews Experience&#58 Failures, Successes and Tips for you
              <small>06 Aug 2018</small>
            </a>
          </h3>
        </li>
        
      
    
      
        
        <li>
          <h3>
            <a href="/blog/2017/06/11/wwdc-2017-organizational-thoughts.html">
              WWDC 2017 Organizational Thoughts
              <small>11 Jun 2017</small>
            </a>
          </h3>
        </li>
        
          
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
